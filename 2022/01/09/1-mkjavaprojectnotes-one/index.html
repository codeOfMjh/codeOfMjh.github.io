<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>单体项目开发部署 | No weal without woe!</title><meta name="keywords" content="HTML,CSS,JavaScript,JQuery,React,Vue.js"><meta name="author" content="mjh"><meta name="copyright" content="mjh"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="单体项目开发部署 笔记架构图   项目git仓库地址 https:&#x2F;&#x2F;gitee.com&#x2F;codeofmjh&#x2F;shopping-mall   1.1 项目基础搭建1.1.1 大型互联网系统架构演变历程1.1.2 大型网站的九大特点 高并发  高可用  大数据  迭代周期短  用户量庞大  可持续发展  安全级别高  可弹性、可伸缩 吞吐量高，响应速度快  1.1.3 大型网站演变进程 基础形式">
<meta property="og:type" content="article">
<meta property="og:title" content="单体项目开发部署">
<meta property="og:url" content="https://codeofmjh.github.com/2022/01/09/1-mkjavaprojectnotes-one/index.html">
<meta property="og:site_name" content="No weal without woe!">
<meta property="og:description" content="单体项目开发部署 笔记架构图   项目git仓库地址 https:&#x2F;&#x2F;gitee.com&#x2F;codeofmjh&#x2F;shopping-mall   1.1 项目基础搭建1.1.1 大型互联网系统架构演变历程1.1.2 大型网站的九大特点 高并发  高可用  大数据  迭代周期短  用户量庞大  可持续发展  安全级别高  可弹性、可伸缩 吞吐量高，响应速度快  1.1.3 大型网站演变进程 基础形式">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-01-09T03:24:37.000Z">
<meta property="article:modified_time" content="2022-02-09T13:22:46.279Z">
<meta property="article:author" content="mjh">
<meta property="article:tag" content="HTML">
<meta property="article:tag" content="CSS">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="JQuery">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Vue.js">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://codeofmjh.github.com/2022/01/09/1-mkjavaprojectnotes-one/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '单体项目开发部署',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-02-09 21:22:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="No weal without woe!" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">No weal without woe!</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">单体项目开发部署</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-09T03:24:37.000Z" title="发表于 2022-01-09 11:24:37">2022-01-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-09T13:22:46.279Z" title="更新于 2022-02-09 21:22:46">2022-02-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="单体项目开发部署"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="单体项目开发部署"><a href="#单体项目开发部署" class="headerlink" title="单体项目开发部署"></a>单体项目开发部署</h1><ul>
<li><p>笔记架构图</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/01.%E7%AC%94%E8%AE%B0%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="笔记架构图"></p>
</li>
<li><p>项目git仓库地址</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/codeofmjh/shopping-mall">https://gitee.com/codeofmjh/shopping-mall</a></p>
</li>
</ul>
<h2 id="1-1-项目基础搭建"><a href="#1-1-项目基础搭建" class="headerlink" title="1.1 项目基础搭建"></a>1.1 项目基础搭建</h2><h3 id="1-1-1-大型互联网系统架构演变历程"><a href="#1-1-1-大型互联网系统架构演变历程" class="headerlink" title="1.1.1 大型互联网系统架构演变历程"></a>1.1.1 大型互联网系统架构演变历程</h3><h3 id="1-1-2-大型网站的九大特点"><a href="#1-1-2-大型网站的九大特点" class="headerlink" title="1.1.2 大型网站的九大特点"></a>1.1.2 大型网站的九大特点</h3><ol>
<li>高并发 </li>
<li>高可用 </li>
<li>大数据 </li>
<li>迭代周期短 </li>
<li>用户量庞大 </li>
<li>可持续发展 </li>
<li>安全级别高 </li>
<li>可弹性、可伸缩</li>
<li>吞吐量高，响应速度快</li>
</ol>
<h3 id="1-1-3-大型网站演变进程"><a href="#1-1-3-大型网站演变进程" class="headerlink" title="1.1.3 大型网站演变进程"></a>1.1.3 大型网站演变进程</h3><ol>
<li><p>基础形式</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/02.%E5%9F%BA%E7%A1%80%E5%BD%A2%E5%BC%8F.png" alt="基础形式"></p>
</li>
<li><p>进阶形式</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/03.%E8%BF%9B%E9%98%B6%E5%BD%A2%E5%BC%8F.png" alt="进阶形式"></p>
</li>
<li><p>单体架构</p>
<ol>
<li><p>特点：多个资源部署在同一台服务器上</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/2022/01/09/1-mkjavaprojectnotes-one/githubblog\source_posts\notes\0004.单体架构.png" alt="单体架构"></p>
<ol>
<li>优点<ol>
<li>部署方便，开发周期短</li>
</ol>
</li>
<li>缺点<ol>
<li>容灾性低</li>
<li>并发数少</li>
</ol>
</li>
</ol>
</li>
<li><p>可以通过添加中间件来提高网站性能</p>
<ul>
<li>用户—–》中间件——-》服务器</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="1-1-4-负载均衡"><a href="#1-1-4-负载均衡" class="headerlink" title="1.1.4 负载均衡"></a>1.1.4 负载均衡</h3><ol>
<li><p>数据的主从分离架构</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/05.%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%88%86%E7%A6%BB%E6%9E%B6%E6%9E%84.png" alt="数据的主从分离架构"></p>
</li>
<li><p>基于主从复制模式的集群架构</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/06.%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84.png" alt="主从复制模式的集群架构"></p>
</li>
<li><p>分布式文件系统和数据库</p>
<ol>
<li>文件服务器(集群—分布式)<pre><code>       1. 特点：多个服务器之间联合存储文件数据</code></pre>
</li>
<li>数据库(集群—分布式)<ol>
<li>特点：多个服务器之间联合存储用户数据</li>
<li>要注意使用全局唯一的主键，分布式主键</li>
<li>工商银行建议数据量达到500万的时候进行分表，最差建议700-800万条进行分表操作</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="1-1-5-Java架构师需要具备的技术栈与能力"><a href="#1-1-5-Java架构师需要具备的技术栈与能力" class="headerlink" title="1.1.5 Java架构师需要具备的技术栈与能力"></a>1.1.5 Java架构师需要具备的技术栈与能力</h3><ol>
<li><p>前端技术</p>
<ol>
<li><code>H5</code>，<code>C3</code>，<code>JS</code>，<code>TS</code>，小程序，<code>React</code></li>
</ol>
</li>
<li><p>后端技术</p>
<ol>
<li><code>nginx</code>代理服务器</li>
<li>微服务(模块服务集群)</li>
<li>消息队列</li>
<li>分布式文件系统</li>
<li><code>Redis</code>缓存集群</li>
<li>海量数据搜索</li>
<li>日志收集</li>
</ol>
</li>
</ol>
<h3 id="1-1-6-项目演示与单体架构技术选型"><a href="#1-1-6-项目演示与单体架构技术选型" class="headerlink" title="1.1.6  项目演示与单体架构技术选型"></a>1.1.6  项目演示与单体架构技术选型</h3><ol>
<li>前端技术<ol>
<li>javascript，h5，css3，jquery，vue</li>
</ol>
</li>
<li>后端技术<ol>
<li>SpringMVC是框架，SpringBoot是工具</li>
<li>SpringBoot2.x实现单体架构设计与准备</li>
<li>SpringBoot是零配置(yml)，集成了Tomcat等多样化的中间件</li>
</ol>
</li>
</ol>
<h3 id="1-1-7-前后端分离开发模式与项目分层设计原则"><a href="#1-1-7-前后端分离开发模式与项目分层设计原则" class="headerlink" title="1.1.7  前后端分离开发模式与项目分层设计原则"></a>1.1.7  前后端分离开发模式与项目分层设计原则</h3><ol>
<li><p>MVVM模式</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/07.MVVM%E6%A8%A1%E5%BC%8F.png" alt="MVVM模式"></p>
</li>
<li><p>聚合工程构建与SpringBoot2.1.x结合</p>
<ol>
<li><p>Maven管理示意图</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/08.Maven%E7%AE%A1%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="Maven管理示意图"></p>
<ol>
<li>聚合工程分为顶级项目(顶级工程，父工程)与子工程，两者之间为继承关系，子工程在maven里称之为模块，模块之间是平级的，可以相互依赖。</li>
<li>子模块可以使用顶级工程里所有的资源(依赖)，子模块之间如果要使用相互资源，必须构建依赖(构建关系)</li>
<li>一个顶级工程是可以由多个不同的子工程组合而成</li>
</ol>
</li>
<li><p>项目依赖关系</p>
<ul>
<li>API(controller)——》service—-》mapper(dao)—-》pojo——》common</li>
</ul>
</li>
</ol>
</li>
<li><p>基于PDMan工具为数据库建模</p>
<ol>
<li><p>PDMan是一个数据库建模工具</p>
</li>
<li><p>注意设置为增量模式，全量模式为先删除数据后在新建表创建字段</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/09.PDMan%E5%B7%A5%E5%85%B7.png" alt="PDMan工具"></p>
</li>
</ol>
</li>
<li><p>数据库物理外键</p>
<ol>
<li>优点<ol>
<li>数据库的数据完整性</li>
<li>强调数据的强一致性</li>
</ol>
</li>
<li>缺点<ol>
<li>降低数据库性能</li>
<li>不能进行热更新</li>
<li>耦合度高</li>
<li>不方便分库分表</li>
</ol>
</li>
<li>小结：传统，小型项目物理外键可以存在；但大型项目必须弃用物理外键</li>
</ol>
</li>
</ol>
<h3 id="1-1-8-SpringBoot项目配置"><a href="#1-1-8-SpringBoot项目配置" class="headerlink" title="1.1.8  SpringBoot项目配置"></a>1.1.8  SpringBoot项目配置</h3><ol>
<li><p>引入SpringBoot的父级依赖</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--表示项目是一个SpringBoot项目--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.5.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>配置项目配置环境</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--项目编码方式--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--JDK版本号--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>引入项目依赖</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--SpringBoot启动插件--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!--排除自带的依赖日志插件--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--SpringBoot的web模块，表明该项目是一个web项目--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--SpringBoot配置文件解析，默认解析yml格式的；这个依赖作用是解析其他格式(xml,properties)的配置文件--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>SpringBoot的启动流程</p>
<ol>
<li><p>启动类注解<code>@SpringBootApplication</code></p>
</li>
<li><p>主线程main中调用SpringApplication的run()方法加载当前类的字节码文件</p>
</li>
<li><p>run()方法接收项目启动类的字节码文件返回一个SpringBoot上下文对象</p>
</li>
<li><p>核心注解</p>
<ul>
<li><p><code>@SpringBootConfiguration</code></p>
<blockquote>
<p>是一个接口，主要注解是@Configuration，是一个容器</p>
</blockquote>
</li>
<li><p><code>@EnableAutoConfiguration</code></p>
<blockquote>
<p>用于开启自动装配，导入的是一个一个的Configuration，导入一个个的容器</p>
</blockquote>
</li>
<li><p><code>@ComponentScan</code></p>
<blockquote>
<p>默认扫描当前包及其子包的所有的类</p>
</blockquote>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="1-1-9-整合HikariCP与MyBatis"><a href="#1-1-9-整合HikariCP与MyBatis" class="headerlink" title="1.1.9 整合HikariCP与MyBatis"></a>1.1.9 整合HikariCP与MyBatis</h3><ol>
<li><p>官方库文档</p>
<p>   <code>https://github.com/brettwooldridge/HikariCP/wiki/Down-the-Rabbit-Hole</code></p>
</li>
<li><p>引入依赖</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--mysql驱动--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">&lt;!--mybatis--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>配置数据源信息</p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true">############################################################</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># web访问端口号  约定：8088</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true">############################################################</span>
<span class="token attr-name">server</span><span class="token punctuation">:</span>
<span class="token attr-name">  port</span><span class="token punctuation">:</span> <span class="token attr-value">8088</span>
<span class="token attr-name">  tomcat</span><span class="token punctuation">:</span>
<span class="token attr-name">    uri-encoding</span><span class="token punctuation">:</span> <span class="token attr-value">utf-8         #uri编码方式</span>
<span class="token attr-name">  max-http-header-size</span><span class="token punctuation">:</span> <span class="token attr-value">80KB    #请求头大小</span>
<span class="token comment" spellcheck="true">############################################################</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># 配置数据源信息</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true">############################################################</span>
<span class="token attr-name">spring</span><span class="token punctuation">:</span>
<span class="token attr-name">  datasource</span><span class="token punctuation">:</span>                           <span class="token attr-value"># 数据源的相关配置</span>
<span class="token attr-name">  type</span><span class="token punctuation">:</span> <span class="token attr-value">com.zaxxer.hikari.HikariDataSource  # 数据源类型：HikariCP</span>
<span class="token attr-name">  driver-class-name</span><span class="token punctuation">:</span> <span class="token attr-value">com.mysql.jdbc.Driver  # mysql驱动</span>
<span class="token attr-name">  url</span><span class="token punctuation">:</span> <span class="token attr-value">jdbc:mysql://localhost:3306/foodie-shop-dev?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=UTC</span>
<span class="token attr-name">  username</span><span class="token punctuation">:</span> <span class="token attr-value">root</span>
<span class="token attr-name">  password</span><span class="token punctuation">:</span> <span class="token attr-value">root</span>
<span class="token attr-name">  hikari</span><span class="token punctuation">:</span>
<span class="token attr-name">    connection-timeout</span><span class="token punctuation">:</span> <span class="token attr-value">30000         # 等待连接池分配连接的最大时长（毫秒），超过这个时长还没可用的连接则发生SQ</span>
<span class="token attr-name">    minimum-idle</span><span class="token punctuation">:</span> <span class="token attr-value">5                   # 最小连接数,没有默认值，等同于10;一般设置为5-10</span>
<span class="token attr-name">    maximum-pool-size</span><span class="token punctuation">:</span> <span class="token attr-value">20             # 最大连接数,默认值是10;一般设置为20</span>
<span class="token comment" spellcheck="true">    # 官方建议将最大值和最小值设置一致</span>
<span class="token attr-name">    auto-commit</span><span class="token punctuation">:</span> <span class="token attr-value">true                 # 自动提交</span>
<span class="token attr-name">    idle-timeout</span><span class="token punctuation">:</span> <span class="token attr-value">600000              # 连接超时的最大时长（毫秒），超时则被释放（retired），默认:10分钟</span>
<span class="token attr-name">    pool-name</span><span class="token punctuation">:</span> <span class="token attr-value">DateSourceHikariCP     # 连接池名字</span>
<span class="token attr-name">    max-lifetime</span><span class="token punctuation">:</span> <span class="token attr-value">1800000             # 连接的生命时长（毫秒），超时而且没被使用则被释放（retired），默认:30分钟</span>
<span class="token attr-name">    connection-test-query</span><span class="token punctuation">:</span> <span class="token attr-value">SELECT 1   # 指定连接的时候的测试sql语句</span>
<span class="token comment" spellcheck="true">############################################################</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># mybatis 配置</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true">############################################################</span>
<span class="token attr-name">mybatis</span><span class="token punctuation">:</span>
<span class="token attr-name">  type-aliases-package</span><span class="token punctuation">:</span> <span class="token attr-value">com.mjh.pojo        # 所有POJO类所在包路径</span>
<span class="token attr-name">  mapper-locations</span><span class="token punctuation">:</span> <span class="token attr-value">classpath:mapper/*.xml  # mapper映射文件，数据层的资源目录下文件</span>
<span class="token attr-name">  configuration</span><span class="token punctuation">:</span>
<span class="token attr-name">    log-impl</span><span class="token punctuation">:</span> <span class="token attr-value">org.apache.ibatis.logging.stdout.StdOutImpl # 开启控制台日志打印</span></code></pre>
</li>
<li><p>MyBatis数据库逆向生成</p>
<ol>
<li><p>mybatis-generator-集成了myMapper插件(引入依赖)—pom文件中引入依赖</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--通用Mapper逆向工具--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mapper-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>在api模块中添加配置</p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true">############################################################</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># mybatis mapper 配置</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true">############################################################</span>
<span class="token comment" spellcheck="true"># 通用 Mapper 配置</span>
<span class="token attr-name">mapper</span><span class="token punctuation">:</span>
<span class="token attr-name">  mappers</span><span class="token punctuation">:</span> <span class="token attr-value">com.mjh.my.mapper.MyMapper</span>
<span class="token attr-name">  not-empty</span><span class="token punctuation">:</span> <span class="token attr-value">false        #在进行数据库操作的时候，判断表达式</span>
<span class="token comment" spellcheck="true">                            #username != null,是否追加username != ''</span>
<span class="token attr-name">  identity</span><span class="token punctuation">:</span> <span class="token attr-value">MYSQL         #数据库方言</span></code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="1-1-10-结合通用Mapper，编写Restful风格Api"><a href="#1-1-10-结合通用Mapper，编写Restful风格Api" class="headerlink" title="1.1.10 结合通用Mapper，编写Restful风格Api"></a>1.1.10 结合通用Mapper，编写Restful风格Api</h3><blockquote>
<p>是一种通信方式，用于信息传递；是一种无状态的，独立的。</p>
</blockquote>
<ol>
<li><p>设计规范</p>
<ol>
<li><code>get</code>：查询资源,URL格式：<code>/order/&#123;id&#125;</code></li>
<li><code>post</code>：保存信息，更新资源,URL格式：<code>/order</code></li>
<li><code>put</code>：更新资源,URL格式：<code>/order/&#123;id&#125;</code></li>
<li><code>delete</code>：删除资源,URL格式：<code>/order/&#123;id&#125;</code></li>
</ol>
</li>
<li><p>示例</p>
<p>   <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/10.Restful%E9%A3%8E%E6%A0%BC.png" alt="Restful风格"></p>
</li>
</ol>
<h3 id="1-1-11-事务传播详解"><a href="#1-1-11-事务传播详解" class="headerlink" title="1.1.11 事务传播详解"></a>1.1.11 事务传播详解</h3><ol>
<li><p>单机版事务传播(<code>propagation</code>)</p>
<ol>
<li><code>require</code>：使用当前的事务，如果当前没有事务，则自己新建一个事物，子方法必须是运行在一个事物中的；如果当前存在事务，则加入这个事务，成为一个整体。</li>
<li><code>supports</code>：如果当前有事务，则使用事务；如果当前没有事务，则不使用事务。</li>
<li><code>mandatory</code>：该传播属性强制必须存在一个事物，如果不存在，就抛出异常。</li>
<li><code>requires_new</code>：如果当前有事务，则挂起该事务，并且为自己创建一个新事物使用；如果当前没有事务，作用和<code>require</code>相同</li>
<li><code>not_supported</code>：如果当前有事务，则把事务挂起，以一种不使用事务的方式去操作数据库</li>
<li><code>never</code>：如果当前有事务存在，则抛出异常</li>
<li><code>nested</code>：如果当前有事务，则开启事务(嵌套事务)，嵌套事务是独立提交或者回滚的；如果当前没有事务，作用和<code>require</code>相同；但是如果主事务提交，会携带子事务一起提交，如果主事务回滚，则子事务也一起回滚；但子事务异常，主事务可以回滚或不回滚。</li>
</ol>
</li>
<li><p>SpringBoot项目不使用<code>@EnableTransactionManagement</code>注解，就能使用事务的原因分析</p>
<ul>
<li><p><code>SpringBootApplication</code>内置<code>EnableTransactionManagement</code>事务注解源码跟踪</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/11.EnableTransactionManagement%E6%B3%A8%E8%A7%A3.png" alt="EnableTransactionManagement注解"></p>
</li>
</ul>
</li>
</ol>
<h3 id="1-1-12-用户注册-登录流程详解与功能开发"><a href="#1-1-12-用户注册-登录流程详解与功能开发" class="headerlink" title="1.1.12 用户注册/登录流程详解与功能开发"></a>1.1.12 用户注册/登录流程详解与功能开发</h3><ol>
<li><p>项目核心功能描述</p>
<ol>
<li>用户的注册与登录<ol>
<li>Cookie和Session</li>
</ol>
</li>
<li>集成Swagger2 生成api文档</li>
<li>分类设计与实现</li>
<li>首页商品推荐</li>
<li>商品的搜索和分页</li>
<li>商品的详情与评论渲染</li>
<li>购物车与订单</li>
<li>微信支付与支付宝支付</li>
</ol>
</li>
<li><p>用户的注册和登录</p>
<ol>
<li><p>注册流程</p>
<ol>
<li><p>一般流程图示</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/12.%E4%B8%80%E8%88%AC%E6%B5%81%E7%A8%8B%E5%9B%BE%E7%A4%BA.png" alt="一般流程图"></p>
</li>
<li><p>邮箱注册流程</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/13.%E9%82%AE%E7%AE%B1%E6%B3%A8%E5%86%8C%E6%B5%81%E7%A8%8B.png" alt="邮箱注册流程"></p>
</li>
<li><p>手机号注册登录</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/14.%E6%89%8B%E6%9C%BA%E5%8F%B7%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95.png" alt="手机号注册登录"></p>
</li>
</ol>
</li>
</ol>
</li>
<li><p>用户名校验模块</p>
<ol>
<li><p>数据访问层注意要点</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.mapper.UsersMapper<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.pojo.Users<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre>
<ol>
<li>注意namespace的路径是数据访问层接口所在包路径</li>
<li>注意type类型是需要封装的实体类所在包路径</li>
<li>注意id是全局唯一的，在使用mybatis生成工具时候要注意修改id使得全局唯一</li>
</ol>
</li>
<li><p>业务逻辑层注意要点</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> UsersMapper usersMapper<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//校验用户名是否存在</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">queryUsernameIsExist</span><span class="token punctuation">(</span>String username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//1. 创建用户表在mybatis中的example实例对象</span>
    Example userExample <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>Users<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//2. 创建实例对象的条件集合</span>
    Example<span class="token punctuation">.</span>Criteria userExampleCriteria <span class="token operator">=</span> userExample<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//3. 选取对应方法进行操作</span>
    userExampleCriteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//4. 调用数据层的通用Mapper方法</span>
    Users user <span class="token operator">=</span> usersMapper<span class="token punctuation">.</span><span class="token function">selectOneByExample</span><span class="token punctuation">(</span>userExample<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//5. 返回查询状态</span>
    <span class="token keyword">return</span> user <span class="token operator">==</span> null <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user <span class="token operator">!=</span> null<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<ol>
<li>一定要对数据访问层进行注入</li>
<li>Example的使用</li>
</ol>
</li>
<li><p>表现层注意要点</p>
<ol>
<li>一定要对业务逻辑层进行注入</li>
<li>注意方法和类路径的<code>/</code>，以免访问出错</li>
<li>@RequestParam：表示该参数是一个请求类型的参数</li>
</ol>
</li>
<li><p>app启动类注意要点</p>
<ol>
<li><p>一定要添加MapperScan进行数据访问层包扫描</p>
<p>a. <code>@MapperScan(basePackages = &quot;com.mjh.mapper&quot;)</code></p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="1-1-13-整合与优化Swagger2文档Api"><a href="#1-1-13-整合与优化Swagger2文档Api" class="headerlink" title="1.1.13 整合与优化Swagger2文档Api"></a>1.1.13 整合与优化Swagger2文档Api</h3><ol>
<li><p>父工程引入依赖坐标</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- swagger2 配置 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">&lt;!--官方UI依赖--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">&lt;!--第三方UI依赖--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.github.xiaoymin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>swagger-bootstrap-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>创建Swagger2核心配置类</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//表示该类是一个Spring的配置类</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token comment" spellcheck="true">//开启Swagger2配置</span>
<span class="token annotation punctuation">@EnableSwagger2</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Swagger2</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// http://localhost:8088/swagger-ui.html 官方API文档访问链接</span>
    <span class="token comment" spellcheck="true">// http://localhost:8088/doc.html 第三方API文档访问链接</span>

    <span class="token annotation punctuation">@Bean</span> <span class="token comment" spellcheck="true">// 表示是一个Spring的Bean实例</span>
    <span class="token comment" spellcheck="true">//配置Swagger2核心配置，docket</span>
    <span class="token keyword">public</span> Docket <span class="token function">createRestApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span>DocumentationType<span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 用于指定api类型为Swagger2</span>
            <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 用于定义api文档汇总信息</span>
            <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">apis</span><span class="token punctuation">(</span>RequestHandlerSelectors
                  <span class="token punctuation">.</span><span class="token function">basePackage</span><span class="token punctuation">(</span><span class="token string">"com.mjh.controller"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 指定Controller所在包路径</span>
            <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span>PathSelectors<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 所有Controller</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> ApiInfo <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"欢乐商城 平台接口API"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">contact</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token string">"mjh"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 文档页标题</span>
                                 <span class="token string">"http://www.mjhcode.com"</span><span class="token punctuation">,</span>
                                 <span class="token string">"mjh@aliyun.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 联系人信息</span>
            <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"专为码农提供的api文档"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 详细信息</span>
            <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"1.0.1"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 文档版本号</span>
            <span class="token punctuation">.</span><span class="token function">termsOfServiceUrl</span><span class="token punctuation">(</span><span class="token string">"http://www.mjhcode.com"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 网站网址</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-1-14-API文档生成工具Swagger2"><a href="#1-1-14-API文档生成工具Swagger2" class="headerlink" title="1.1.14 API文档生成工具Swagger2"></a>1.1.14 API文档生成工具Swagger2</h3><table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
<th>常用属性</th>
</tr>
</thead>
<tbody><tr>
<td><code>@ApiIgnore</code></td>
<td>在使用Swagger2生成API文档时忽略该接口</td>
<td>无</td>
</tr>
<tr>
<td><code>@Api</code></td>
<td>用于生成api文档说明，一般作用于类上</td>
<td><code>value</code>和<code>tags</code></td>
</tr>
<tr>
<td><code>@ApiOperation</code></td>
<td>用于为当前方法生成API文档描述</td>
<td><code>value</code>，<code>notes</code>和<code>httpMethod</code></td>
</tr>
<tr>
<td><code>@ApiModel</code></td>
<td>为该类生成的API文档添加描述(一般用于实体类中)</td>
<td><code>value</code>和<code>description</code></td>
</tr>
<tr>
<td><code>@ApiModelProperty</code></td>
<td>用于当前属性生成API文档描述(一般用于实体类中)</td>
<td><code>value</code>，<code>name</code>，<code>example</code>和<code>required</code></td>
</tr>
</tbody></table>
<h3 id="1-1-15-设置跨域配置实现前后端联调"><a href="#1-1-15-设置跨域配置实现前后端联调" class="headerlink" title="1.1.15 设置跨域配置实现前后端联调"></a>1.1.15 设置跨域配置实现前后端联调</h3><ol>
<li><p>修改前端项目中js目录下的开发环境路径，修改接口服务地址路径为：<code>serviceUrl: &quot;http://localhost:8080&quot;</code></p>
</li>
<li><p>创建跨域资源访问配置类</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token function">CorsConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// 空参构造</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> CorsFilter <span class="token function">corsFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 1. 添加cors配置信息</span>
        CorsConfiguration configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorsConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">addAllowedOrigin</span><span class="token punctuation">(</span><span class="token string">"http://39.100.28.3:8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2. 设置是否发送cookie信息</span>
        configuration<span class="token punctuation">.</span><span class="token function">setAllowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 3. 设置允许请求的方式</span>
        configuration<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 4. 设置允许的header</span>
        configuration<span class="token punctuation">.</span><span class="token function">addAllowedHeader</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 5. 为url添加映射路径</span>
        UrlBasedCorsConfigurationSource source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlBasedCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        source<span class="token punctuation">.</span><span class="token function">registerCorsConfiguration</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">,</span> configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 6. 返回新的source</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CorsFilter</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-1-16-用户登录实现"><a href="#1-1-16-用户登录实现" class="headerlink" title="1.1.16 用户登录实现"></a>1.1.16 用户登录实现</h3><ol>
<li><p>编写service</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于登录</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> Users <span class="token function">queryUserForLogin</span><span class="token punctuation">(</span>String username<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//1. 创建用户表在mybatis中的example实例对象</span>
    Example userExample <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>Users<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//2. 创建实例对象的条件集合</span>
    Example<span class="token punctuation">.</span>Criteria userExampleCriteria <span class="token operator">=</span> userExample<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//3. 选取对应方法进行操作</span>
    userExampleCriteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    userExampleCriteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//4. 调用数据层的通用Mapper方法</span>
    Users user <span class="token operator">=</span> usersMapper<span class="token punctuation">.</span><span class="token function">selectOneByExample</span><span class="token punctuation">(</span>userExample<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写Controller</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户登录"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户登录"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span><span class="token comment" spellcheck="true">/*将前端传递的json数据接收映射为Java类*/</span> UserBO userBO<span class="token punctuation">,</span>
                           HttpServletRequest request<span class="token punctuation">,</span>
                           HttpServletResponse response
    <span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//1. 获取用户信息</span>
        String username <span class="token operator">=</span> userBO<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String password <span class="token operator">=</span> userBO<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//2. 用户名密码进行非空校验</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">||</span> StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"用户名或密码不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">//4. 对前端密码进行加密，因为数据库密码是密文形式，所以加密后进行比对</span>
        String md5Password <span class="token operator">=</span> MD5Utils<span class="token punctuation">.</span><span class="token function">getMD5Str</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//5. 实现登录登录校验</span>
        Users user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">queryUserForLogin</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> md5Password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//6. 进行返回值校验</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"用户不存在或者密码输入错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// 7. 将用户关键信息置为null，以免cookie劫持；真实场景要进行加密</span>
        user <span class="token operator">=</span> <span class="token function">setUserProperty</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 8. 将用户信息写入cookie中，用于数据回显</span>
        CookieUtils<span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">,</span> JsonUtils<span class="token punctuation">.</span><span class="token function">objectToJson</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-1-17-Cookie和Session"><a href="#1-1-17-Cookie和Session" class="headerlink" title="1.1.17 Cookie和Session"></a>1.1.17 Cookie和Session</h3><ol>
<li>Cookie<ol>
<li>以键值对的形式存储信息在浏览器中，有大小限制，为4kb</li>
<li>不能进行跨域，在当前及其父级域名可以取值</li>
<li>可以设置有效期</li>
<li>可以设置path</li>
</ol>
</li>
<li>Session<ol>
<li>基于服务器内存的缓存(非持久化 )，能保存请求会话</li>
<li>每个session通过sessionid(即调试面板的JSessionid)来区分不同请求</li>
<li>session可以设置过期时间</li>
<li>session也可以是键值对形式存在的</li>
</ol>
</li>
</ol>
<h3 id="1-1-18-整合Log4j打印日志"><a href="#1-1-18-整合Log4j打印日志" class="headerlink" title="1.1.18 整合Log4j打印日志"></a>1.1.18 整合Log4j打印日志</h3><ol>
<li><p>基于SpringAOP实现</p>
</li>
<li><p>实现</p>
<ol>
<li><p>引入AOP依赖</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--aspect实现的AOP依赖--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--去除原有的日志依赖--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">&lt;!--引入日志依赖--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.7.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.7.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>在API接口资源目录下添加日志配置文件</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG,stdout,file</span>
<span class="token attr-name">log4j.additivity.org.apache</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

<span class="token attr-name">log4j.appender.stdout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.ConsoleAppender</span>
<span class="token comment" spellcheck="true"># 日志级别</span>
<span class="token attr-name">log4j.appender.stdout.threshold</span><span class="token punctuation">=</span><span class="token attr-value">INFO</span>
<span class="token attr-name">log4j.appender.stdout.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span>
<span class="token attr-name">log4j.appender.stdout.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">%-5p %c{1}:%L - %m%n</span>

<span class="token attr-name">log4j.appender.file</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.DailyRollingFileAppender</span>
<span class="token attr-name">log4j.appender.file.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span>
<span class="token attr-name">log4j.appender.file.DatePattern</span><span class="token punctuation">=</span><span class="token attr-value">'.'yyyy-MM-dd-HH-mm</span>
<span class="token attr-name">log4j.appender.file.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1}:%L - %m%n</span>
<span class="token attr-name">log4j.appender.file.Threshold</span><span class="token punctuation">=</span><span class="token attr-value">INFO</span>
<span class="token attr-name">log4j.appender.file.append</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">log4j.appender.file.File</span><span class="token punctuation">=</span><span class="token attr-value">/workspaces/logs/foodie-api/mylog.log</span></code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="1-1-19-通过日志监控Service执行时间"><a href="#1-1-19-通过日志监控Service执行时间" class="headerlink" title="1.1.19 通过日志监控Service执行时间"></a>1.1.19 通过日志监控Service执行时间</h3><ol>
<li><p>在启动引导类中新增切面类实现</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Aspect</span> <span class="token comment" spellcheck="true">// 声明为Spring的切面类</span>
<span class="token annotation punctuation">@Component</span> <span class="token comment" spellcheck="true">// 表示该类是一个Spring的组件类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceLogAspect</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 全局日志标签</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Logger Log <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>ServiceLogAspect<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/*
     * AOP通知类型：
     * 1. 前置通知：在方法调用之前执行
     * 2. 后置通知：在方法**正常**调用之后执行
     * 3. 环绕通知：在方法调用之前和之后都能执行
     * 4. 异常通知：如果在方法调用过程中发生异常，则通知
     * 5. 最终通知：在方法调用之后执行
     * */</span>

    <span class="token comment" spellcheck="true">/*
     * @Description // 切面表达式
     * 第一处 * 代表方法的返回类型， * 代表所有类型
     * 第二处 包名代表AOP监控的类所在的包
     * 第三处 .. 代表该包及其子包下的所有类及其方法
     * 第四处 * 代表类名，*代表所有类
     * 第五处 *(..) 代表类中的所有方法和任意参数；
     *        *代表类中的所有方法，..代表方法中的任何参数
     * @Param [joinPoint]
     * @return java.lang.Object
     **/</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"execution(* com.mjh.service.impl..*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> Object <span class="token function">recordTimeLog</span><span class="token punctuation">(</span>ProceedingJoinPoint joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"==== 开始执行 {}.{} ===="</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 方法开始执行的时间点</span>
        <span class="token keyword">long</span> begin <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 开始执行目标方法</span>
        Object result <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 方法结束执行的时间点</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 执行方法耗时</span>
        <span class="token keyword">long</span> takeTime <span class="token operator">=</span> end <span class="token operator">-</span> begin<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 进行日志级别输出</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>takeTime <span class="token operator">></span> <span class="token number">3000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"===== 执行结束，耗时：{} 毫秒 ===="</span><span class="token punctuation">,</span> takeTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>takeTime <span class="token operator">></span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"===== 执行结束，耗时：{} 毫秒 ===="</span><span class="token punctuation">,</span> takeTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            Log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"===== 执行结束，耗时：{} 毫秒 ===="</span><span class="token punctuation">,</span> takeTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// 返回方法对象</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-1-20-用户退出登录清空Cookie"><a href="#1-1-20-用户退出登录清空Cookie" class="headerlink" title="1.1.20 用户退出登录清空Cookie"></a>1.1.20 用户退出登录清空Cookie</h3><ol>
<li><p>在PortController的logout方法中添加移除Cookie的方法</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 退出登录</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户退出登录"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户退出登录"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">logout</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
                            HttpServletRequest request<span class="token punctuation">,</span>
                            HttpServletResponse response<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 清除用户信息的相关Cookie</span>
    CookieUtils<span class="token punctuation">.</span><span class="token function">deleteCookie</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">,</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// todo 用户退出登录需要清空购物车</span>
    <span class="token comment" spellcheck="true">// todo 分布式会话中需要清除用户数据</span>

    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-1-21-开启MyBatis日志Sql打印"><a href="#1-1-21-开启MyBatis日志Sql打印" class="headerlink" title="1.1.21 开启MyBatis日志Sql打印"></a>1.1.21 开启MyBatis日志Sql打印</h3><ol>
<li><p>在API接口资源目录下添加如下配置</p>
<pre class=" language-yml"><code class="language-yml">mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # 开启控制台日志打印</code></pre>
</li>
</ol>
<h2 id="1-2-商品分类搜索购物车模块实现"><a href="#1-2-商品分类搜索购物车模块实现" class="headerlink" title="1.2 商品分类搜索购物车模块实现"></a>1.2 商品分类搜索购物车模块实现</h2><h3 id="1-2-1-电商首页轮播图功能开发"><a href="#1-2-1-电商首页轮播图功能开发" class="headerlink" title="1.2.1 电商首页轮播图功能开发"></a>1.2.1 电商首页轮播图功能开发</h3><ol>
<li><p>数据库表结构</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/15.%E8%BD%AE%E6%92%AD%E5%9B%BE%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="轮播图表结构"></p>
<ol>
<li>sort字段代表轮播图顺序</li>
</ol>
</li>
<li><p>业务逻辑层书写</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 注入数据访问层</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> CarouselMapper carouselMapper<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 查询所有轮播图</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>Carousel<span class="token operator">></span> <span class="token function">queryAllCarousel</span><span class="token punctuation">(</span>Integer isShow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 构造Carousel的查询对象</span>
    Example example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>Carousel<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 1.1 为轮播图排序;倒序排列</span>
    example<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">"sort"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 创建查询条件</span>
    Example<span class="token punctuation">.</span>Criteria criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 添加查询条件</span>
    criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"isShow"</span><span class="token punctuation">,</span> isShow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 4. 执行查询</span>
    List<span class="token operator">&lt;</span>Carousel<span class="token operator">></span> carouselList <span class="token operator">=</span> carouselMapper<span class="token punctuation">.</span><span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> carouselList<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>视图展示层书写</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>  <span class="token comment" spellcheck="true">//首页展示相关</span>
<span class="token keyword">private</span> CarouselService carouselService<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"轮播图查询"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"轮播图集合"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/carousel"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">carousel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//1. 查询所有轮播图列表</span>
    List<span class="token operator">&lt;</span>Carousel<span class="token operator">></span> carouselList <span class="token operator">=</span> carouselService<span class="token punctuation">.</span><span class="token function">queryAllCarousel</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>YES<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//2. 返回查询结果</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>carouselList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-2-2-首页分类需求分析"><a href="#1-2-2-首页分类需求分析" class="headerlink" title="1.2.2 首页分类需求分析"></a>1.2.2 首页分类需求分析</h3><ol>
<li>第一次刷新主页查询根分类，渲染展示到首页。</li>
<li>鼠标移动到跟分类，则加载根分类对应的子分类及其内容；如果子分类已经存在就不需要加载(懒加载)。</li>
</ol>
<h4 id="1-2-2-1-分类实现-加载与渲染大分类"><a href="#1-2-2-1-分类实现-加载与渲染大分类" class="headerlink" title="1.2.2.1 分类实现 - 加载与渲染大分类"></a>1.2.2.1 分类实现 - 加载与渲染大分类</h4><ol>
<li><p>数据库表结构</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/16.%E5%88%86%E7%B1%BB%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="分类表结构"></p>
<ol>
<li>type字段为分类标识符</li>
</ol>
</li>
<li><p>业务逻辑层编写</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> CategoryMapper categoryMapper<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 查询所有一级分类</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>Category<span class="token operator">></span> <span class="token function">queryAllCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 构造Category的查询对象</span>
    Example example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>Category<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 创建查询条件</span>
    Example<span class="token punctuation">.</span>Criteria criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 添加查询条件 // todo 补充categoryType枚举类</span>
    criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span> CategoryLevel<span class="token punctuation">.</span>ONELEVEL<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 4. 执行查询</span>
    List<span class="token operator">&lt;</span>Category<span class="token operator">></span> categoryList <span class="token operator">=</span> categoryMapper<span class="token punctuation">.</span><span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> categoryList<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>视图展示层编写</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>  <span class="token comment" spellcheck="true">//分类列表相关</span>
<span class="token keyword">private</span> CategoryService categoryService<span class="token punctuation">;</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"获取商品分类(一级分类)"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"获取商品分类(一级分类)"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/cats"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">category</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    List<span class="token operator">&lt;</span>Category<span class="token operator">></span> categoryList <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">queryAllCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>categoryList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-2-2-2-分类实现-自连接查询子分类"><a href="#1-2-2-2-分类实现-自连接查询子分类" class="headerlink" title="1.2.2.2 分类实现 - 自连接查询子分类"></a>1.2.2.2 分类实现 - 自连接查询子分类</h4><ol>
<li><p>sql编写</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 根据一级分类查询子分类</span>
<span class="token keyword">select</span>
  <span class="token number">f</span><span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">as</span> id<span class="token punctuation">,</span>
  <span class="token number">f</span><span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">as</span> name<span class="token punctuation">,</span>
  <span class="token number">f</span><span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">type</span><span class="token punctuation">`</span> <span class="token keyword">as</span> <span class="token keyword">type</span><span class="token punctuation">,</span>
  <span class="token number">f</span><span class="token punctuation">.</span><span class="token punctuation">`</span>father_id<span class="token punctuation">`</span> <span class="token keyword">as</span> fatherId<span class="token punctuation">,</span>
  <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">as</span> subId<span class="token punctuation">,</span>
  <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">as</span> subName<span class="token punctuation">,</span>
  <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">type</span><span class="token punctuation">`</span> <span class="token keyword">as</span> subType<span class="token punctuation">,</span>
  <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span>father_id<span class="token punctuation">`</span> <span class="token keyword">as</span> subFatherId
<span class="token keyword">from</span>
  category <span class="token number">f</span>
<span class="token keyword">left</span> <span class="token keyword">join</span> 
  category <span class="token number">c</span>
<span class="token keyword">on</span> <span class="token number">f</span><span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span>father_id<span class="token punctuation">`</span>
<span class="token keyword">where</span> <span class="token number">f</span><span class="token punctuation">.</span><span class="token punctuation">`</span>father_id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">1</span></code></pre>
</li>
</ol>
<h4 id="1-2-2-3-分类实现-自定义Mapper实现懒加载子分类展示"><a href="#1-2-2-3-分类实现-自定义Mapper实现懒加载子分类展示" class="headerlink" title="1.2.2.3 分类实现 - 自定义Mapper实现懒加载子分类展示"></a>1.2.2.3 分类实现 - 自定义Mapper实现懒加载子分类展示</h4><ol>
<li><p>数据访问层编写</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--自定义Mapper文件编写--></span>
<span class="token comment" spellcheck="true">&lt;!--namespace是自定义Mapper的全路径类名--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.mapper.CategoryMapperCustom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--id属性值和sql中的resultMap值对应
        type为查询结果封装类型
        Collection为查询类型中的集合类型            
    --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CategoryVO<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.pojo.vo.CategoryVO<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>type<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>type<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fatherId<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fatherId<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!--Collection 标签：用于定义关联的list集合类型
            property：对应三级分类的list属性名和前端调用的参数名相同
            ofType：集合的类型，三级分类的VO
        --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subCatList<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.pojo.vo.SubCategoryVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subId<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subId<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subName<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subName<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subType<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subType<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subFatherId<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subFatherId<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!--id值和自定义Mapper的方法名相同--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>getSubCatList<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CategoryVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        select
          f.`id` as id,
          f.`name` as name,
          f.`type` as type,
          f.`father_id` as fatherId,
          c.`id` as subId,
          c.`name` as subName,
          c.`type` as subType,
          c.`father_id` as subFatherId
        from
          category f
        left join
          category c
        on
          f.`id` = c.`father_id`
        where
          f.`father_id` = #{rootCatId}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre>
<ol>
<li><p>注意</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/2022/01/09/1-mkjavaprojectnotes-one/Java慕课笔记\assets\17.分类注意.png" alt="分类注意"></p>
<p>cat是二级分类数组，subCatList必须和Java类的属性名保持一致，否则前端拿不到值</p>
</li>
</ol>
</li>
<li><p>业务逻辑层编写</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> CategoryMapperCustom categoryMapperCustom<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//查询二级分类及其子分类</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>CategoryVO<span class="token operator">></span> <span class="token function">getSubCateList</span><span class="token punctuation">(</span>Integer rootCatId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    List subCatList <span class="token operator">=</span> categoryMapperCustom<span class="token punctuation">.</span><span class="token function">getSubCatList</span><span class="token punctuation">(</span>rootCatId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> subCatList<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>视图展示层编写</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询二级分类及其子分类"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询二级分类及其子分类"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/subCat/{rootCatId}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getSubCateList</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"rootCatId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"一级分类Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PathVariable</span> Integer rootCatId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rootCatId <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"分类不存在"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    List<span class="token operator">&lt;</span>CategoryVO<span class="token operator">></span> subCateList <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getSubCateList</span><span class="token punctuation">(</span>rootCatId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>subCateList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-2-3-商品推荐-需求分析与Sql查询"><a href="#1-2-3-商品推荐-需求分析与Sql查询" class="headerlink" title="1.2.3 商品推荐 - 需求分析与Sql查询"></a>1.2.3 商品推荐 - 需求分析与Sql查询</h3><ol>
<li><p>sql编写</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>
  <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> rootCatId<span class="token punctuation">,</span>
  <span class="token number">c</span><span class="token punctuation">.</span>name rootCatName<span class="token punctuation">,</span>
  <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span>slogan<span class="token punctuation">`</span> slogan<span class="token punctuation">,</span>
  <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span>cat_image<span class="token punctuation">`</span> catImage<span class="token punctuation">,</span>
  <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span>bg_color<span class="token punctuation">`</span> bgColor<span class="token punctuation">,</span>
  i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> itemId<span class="token punctuation">,</span>
  i<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> itemName<span class="token punctuation">,</span>
  ii<span class="token punctuation">.</span><span class="token punctuation">`</span>url<span class="token punctuation">`</span> itemUrl<span class="token punctuation">,</span>
  i<span class="token punctuation">.</span><span class="token punctuation">`</span>created_time<span class="token punctuation">`</span> createTime
<span class="token keyword">from</span>
  category <span class="token number">c</span>
<span class="token keyword">left</span> <span class="token keyword">join</span> items i
  <span class="token keyword">on</span> <span class="token number">c</span><span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>root_cat_id<span class="token punctuation">`</span>
<span class="token keyword">left</span> <span class="token keyword">join</span> items_img ii
  <span class="token keyword">on</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> ii<span class="token punctuation">.</span><span class="token punctuation">`</span>item_id<span class="token punctuation">`</span>
<span class="token keyword">where</span> 
  <span class="token number">c</span><span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token operator">and</span> 
  i<span class="token punctuation">.</span><span class="token punctuation">`</span>root_cat_id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">7</span>
<span class="token operator">and</span> 
  ii<span class="token punctuation">.</span><span class="token punctuation">`</span>is_main<span class="token punctuation">`</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>created_time<span class="token punctuation">`</span> 
<span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span></code></pre>
</li>
<li><p>减少表的关联查询，以优化性能</p>
</li>
</ol>
<h4 id="1-2-3-1-商品推荐实现与联调"><a href="#1-2-3-1-商品推荐实现与联调" class="headerlink" title="1.2.3.1 商品推荐实现与联调"></a>1.2.3.1 商品推荐实现与联调</h4><ol>
<li><p>映射注意点</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/18.%E5%95%86%E5%93%81%E6%8E%A8%E8%8D%90%E6%98%A0%E5%B0%84%E6%B3%A8%E6%84%8F%E7%82%B9.png" alt="商品推荐映射注意点"></p>
<p>封装类的属性值务必和前端调用的属性值保持一致，否则前端拿不到数据</p>
</li>
<li><p>两个封装类核心属性</p>
<pre class=" language-java"><code class="language-java">NewItemsVO <span class="token punctuation">{</span>
<span class="token keyword">private</span> Integer rootCatId<span class="token punctuation">;</span>
<span class="token keyword">private</span> String rootCatName<span class="token punctuation">;</span>
<span class="token keyword">private</span> String slogan<span class="token punctuation">;</span>
<span class="token keyword">private</span> String catImage<span class="token punctuation">;</span>
<span class="token keyword">private</span> String bgColor<span class="token punctuation">;</span>
<span class="token keyword">private</span> List<span class="token operator">&lt;</span>SimpleItemVO<span class="token operator">></span> simpleItemList<span class="token punctuation">;</span><span class="token punctuation">}</span>
SimpleItemVO <span class="token punctuation">{</span>
<span class="token keyword">private</span> String itemId<span class="token punctuation">;</span>
<span class="token keyword">private</span> String itemName<span class="token punctuation">;</span>
<span class="token keyword">private</span> String itemUrl<span class="token punctuation">;</span>
<span class="token keyword">private</span> String createTime<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//这些属性在这里怎么写，前端就必须data.[这里对应的属性名]</span></code></pre>
</li>
<li><p>业务逻辑层编写</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//根据一级分类Id查询6条最新商品数据</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>NewItemsVO<span class="token operator">></span> <span class="token function">getSixNewItemsLazy</span><span class="token punctuation">(</span>Integer rootCatId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"rootCatId"</span><span class="token punctuation">,</span> rootCatId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>NewItemsVO<span class="token operator">></span> newItemsLazy <span class="token operator">=</span> categoryMapperCustom<span class="token punctuation">.</span><span class="token function">getSixNewItemsLazy</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newItemsLazy<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>视图展示层编写</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询一级分类下的最新6条数据"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询一级分类下的最新6条数据"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/sixNewItems/{rootCatId}"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//注意前端请求的路径必须和这里一致</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getSixNewItemsLazy</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"rootCatId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"一级分类Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PathVariable</span> Integer rootCatId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rootCatId <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"分类不存在"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    List<span class="token operator">&lt;</span>NewItemsVO<span class="token operator">></span> subCateList <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getSixNewItemsLazy</span><span class="token punctuation">(</span>rootCatId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>subCateList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-2-3-2-商品详情实现与联调"><a href="#1-2-3-2-商品详情实现与联调" class="headerlink" title="1.2.3.2 商品详情实现与联调"></a>1.2.3.2 商品详情实现与联调</h4><ol>
<li><p>需求分析</p>
<ol>
<li><p>商品规格展示</p>
</li>
<li><p>商品详情展示</p>
</li>
<li><p>点击商品进入详情展示页面只向后端发送一次请求</p>
</li>
<li><p>数据库表结构展示</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/19.%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E7%9B%B8%E5%85%B3%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="1606648182512"></p>
</li>
</ol>
</li>
<li><p>注意要点</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/20.%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85VO%E6%98%A0%E5%B0%84%E6%B3%A8%E6%84%8F.png" alt="商品详情VO映射注意"></p>
</li>
</ol>
<h3 id="1-2-4-商品评价-数据库设计"><a href="#1-2-4-商品评价-数据库设计" class="headerlink" title="1.2.4 商品评价 - 数据库设计"></a>1.2.4 商品评价 - 数据库设计</h3><ol>
<li><p>商品评论展示注意用户信息脱敏</p>
<ol>
<li>脱敏一般用于手机号，用户名，昵称，用户地址(用户私有属性)</li>
</ol>
</li>
<li><p>商品评价表结构</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/21.%E5%95%86%E5%93%81%E8%AF%84%E4%BB%B7%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="商品评价表结构"></p>
</li>
<li><p>业务逻辑层编写</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//评论Mapper</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> ItemsCommentsMapper itemsCommentsMapper<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//根据商品Id查询商品评论信息</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> CommentLevelVO <span class="token function">queryCommentCounts</span><span class="token punctuation">(</span>String itemId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 分别查询出每类评价的数据，并计算总数</span>
    Integer goodCounts <span class="token operator">=</span> <span class="token function">getComments</span><span class="token punctuation">(</span>itemId<span class="token punctuation">,</span> CommentLevel<span class="token punctuation">.</span>GOOD<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Integer normalCounts <span class="token operator">=</span> <span class="token function">getComments</span><span class="token punctuation">(</span>itemId<span class="token punctuation">,</span> CommentLevel<span class="token punctuation">.</span>NORMAL<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Integer badCounts <span class="token operator">=</span> <span class="token function">getComments</span><span class="token punctuation">(</span>itemId<span class="token punctuation">,</span> CommentLevel<span class="token punctuation">.</span>BAD<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Integer totalCounts <span class="token operator">=</span> goodCounts <span class="token operator">+</span> normalCounts <span class="token operator">+</span> badCounts<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 2. 创建封装评论总数的对象</span>
    CommentLevelVO commentLevelVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommentLevelVO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    commentLevelVO<span class="token punctuation">.</span><span class="token function">setTotalCounts</span><span class="token punctuation">(</span>totalCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    commentLevelVO<span class="token punctuation">.</span><span class="token function">setGoodCounts</span><span class="token punctuation">(</span>goodCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    commentLevelVO<span class="token punctuation">.</span><span class="token function">setNormalCounts</span><span class="token punctuation">(</span>normalCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    commentLevelVO<span class="token punctuation">.</span><span class="token function">setBadCounts</span><span class="token punctuation">(</span>badCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 3. 返回封装好的数据</span>
    <span class="token keyword">return</span> commentLevelVO<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 获取评论总数</span>
<span class="token keyword">private</span> Integer <span class="token function">getComments</span><span class="token punctuation">(</span>String itemId<span class="token punctuation">,</span> Integer level<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ItemsComments itemsComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ItemsComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    itemsComments<span class="token punctuation">.</span><span class="token function">setItemId</span><span class="token punctuation">(</span>itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        itemsComments<span class="token punctuation">.</span><span class="token function">setCommentLevel</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> itemsCommentsMapper<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span>itemsComments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>视图展示层编写</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询商品评价等级"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询商品评价等级"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/commentLevel"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getCommentLevel</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"itemId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"商品Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">//这里的itemId必须和前端的路径参数保持一致，否则获取不到前端的参数</span>
    <span class="token annotation punctuation">@RequestParam</span> String itemId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>itemId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    CommentLevelVO commentCounts <span class="token operator">=</span> itemService<span class="token punctuation">.</span><span class="token function">queryCommentCounts</span><span class="token punctuation">(</span>itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>commentCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-2-4-1-商品评价-评论详情展示"><a href="#1-2-4-1-商品评价-评论详情展示" class="headerlink" title="1.2.4.1 商品评价 - 评论详情展示"></a>1.2.4.1 商品评价 - 评论详情展示</h4><ol>
<li><p>注意评论数据映射</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/22.%E8%AF%84%E8%AE%BA%E6%95%B0%E6%8D%AE%E6%98%A0%E5%B0%84.png" alt="评论数据映射"></p>
</li>
<li><p>编写Mapper映射文件</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--namespace是数据访问层接口的全路径类名--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.mapper.ItemsMapperCustom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--
        id是数据访问层接口定义的方法名
        resultType是用于向前端返回数据的类
    --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>queryItemComments<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.pojo.vo.ItemCommentVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        select
          ics.`comment_level` commentLevel,
          ics.`content` content,
          ics.`sepc_name` specName,
          ics.`created_time` createdTime,
          u.`face` userFace,
          u.`nickname` nickname
        from
          items_comments ics
          left join
          users u
        on
          ics.`user_id` = u.`id`
        where
          ics.`item_id` = #{paramsMap.itemId}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paramsMap.level !<span class="token punctuation">=</span> null and paramsMap.level !<span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            and ics.`comment_level` = #{paramsMap.level}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//根据商品Id和评价等级查询评论详情</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>ItemCommentVO<span class="token operator">></span> <span class="token function">queryPagedComments</span><span class="token punctuation">(</span>String itemId<span class="token punctuation">,</span> Integer level<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"itemId"</span><span class="token punctuation">,</span> itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"level"</span><span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>ItemCommentVO<span class="token operator">></span> itemComments <span class="token operator">=</span> itemsMapperCustom<span class="token punctuation">.</span><span class="token function">queryItemComments</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> itemComments<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-2-4-2-商品评价-评论分页实现"><a href="#1-2-4-2-商品评价-评论分页实现" class="headerlink" title="1.2.4.2 商品评价 - 评论分页实现"></a>1.2.4.2 商品评价 - 评论分页实现</h4><ol>
<li><p>集成分页的插件(<code>mybatis-PageHelper</code>)</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.github.pagehelper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>pagehelper-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>引入配置信息</p>
<pre class=" language-yml"><code class="language-yml"># 分页插件配置
pagehelper:
  helper-dialect: mysql
  support-methods-arguments: true</code></pre>
</li>
<li><p>改写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> PagedGridResult <span class="token function">queryPagedComments</span><span class="token punctuation">(</span>String itemId<span class="token punctuation">,</span> Integer level<span class="token punctuation">,</span> Integer page<span class="token punctuation">,</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"itemId"</span><span class="token punctuation">,</span> itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"level"</span><span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 查询之前使用PageHelper进行分页；Page-页数，PageSize-每页显示条数</span>
    PageHelper<span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>ItemCommentVO<span class="token operator">></span> itemComments <span class="token operator">=</span> itemsMapperCustom<span class="token punctuation">.</span><span class="token function">queryItemComments</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 调用分页的方法</span>
    PagedGridResult gridResult <span class="token operator">=</span> <span class="token function">getPagedGrid</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> itemComments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 返回分页后的数据</span>
    <span class="token keyword">return</span> gridResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// 进行分页</span>
<span class="token keyword">private</span> PagedGridResult <span class="token function">getPagedGrid</span><span class="token punctuation">(</span>Integer page<span class="token punctuation">,</span> List list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    PageInfo<span class="token operator">&lt;</span>ItemCommentVO<span class="token operator">></span> commentPageInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageInfo</span><span class="token operator">&lt;</span>ItemCommentVO<span class="token operator">></span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    PagedGridResult gridResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PagedGridResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gridResult<span class="token punctuation">.</span><span class="token function">setPage</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gridResult<span class="token punctuation">.</span><span class="token function">setRows</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gridResult<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>commentPageInfo<span class="token punctuation">.</span><span class="token function">getPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gridResult<span class="token punctuation">.</span><span class="token function">setRecords</span><span class="token punctuation">(</span>commentPageInfo<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> gridResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询商品评价详情"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询商品评价详情"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/comments"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getCommentDetails</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"itemId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"商品Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String itemId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"level"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"评论等级"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer level<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"当前页数"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer page<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"pageSize"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"每页显示记录数"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>itemId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 为page和pageSize赋初值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> null <span class="token operator">||</span> pageSize <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    PagedGridResult gridResult <span class="token operator">=</span> itemService<span class="token punctuation">.</span><span class="token function">queryPagedComments</span><span class="token punctuation">(</span>itemId<span class="token punctuation">,</span> level<span class="token punctuation">,</span> page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>gridResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-2-5-商品评价-信息脱敏"><a href="#1-2-5-商品评价-信息脱敏" class="headerlink" title="1.2.5 商品评价 - 信息脱敏"></a>1.2.5 商品评价 - 信息脱敏</h3><ol>
<li><p>进行信息脱敏</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 进行用户昵称脱敏</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>ItemCommentVO itemComment <span class="token operator">:</span> itemComments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 获取从数据库查询的用户昵称</span>
    String nickname <span class="token operator">=</span> itemComment<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 对昵称进行脱敏</span>
    String name <span class="token operator">=</span> DesensitizationUtil<span class="token punctuation">.</span><span class="token function">commonDisplay</span><span class="token punctuation">(</span>nickname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 设置脱敏后的昵称</span>
    itemComment<span class="token punctuation">.</span><span class="token function">setNickname</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-2-6-搜索商品-功能详述与Sql编写"><a href="#1-2-6-搜索商品-功能详述与Sql编写" class="headerlink" title="1.2.6 搜索商品 - 功能详述与Sql编写"></a>1.2.6 搜索商品 - 功能详述与Sql编写</h3><ol>
<li><p>需求分析</p>
<ol>
<li>根据搜素框内容进行模糊匹配</li>
<li>需要展示商品(item)图片，名称，销量，价格属性(从数据库查询)</li>
<li>商品展示默认根据名称排序，可选按销量排序，按价格升序排序</li>
</ol>
</li>
<li><p>表关系图</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/19.%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E7%9B%B8%E5%85%B3%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="商品详情相关表结构"></p>
</li>
</ol>
<h4 id="1-2-6-1-搜索商品-商品搜索功能实现"><a href="#1-2-6-1-搜索商品-商品搜索功能实现" class="headerlink" title="1.2.6.1 搜索商品 - 商品搜索功能实现"></a>1.2.6.1 搜索商品 - 商品搜索功能实现</h4><ol>
<li><p>主要要点</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/23.%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E5%AD%97%E6%B3%A8%E6%84%8F%E7%82%B9.png" alt="搜索关键字注意点"></p>
<ol>
<li>如果采用普通引号，不使用转义符会出现如上错误</li>
</ol>
</li>
<li><p>sql编写</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 价格降序排列sql</span>
<span class="token keyword">SELECT</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> itemId<span class="token punctuation">,</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> itemName<span class="token punctuation">,</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>sell_counts<span class="token punctuation">`</span> sellCounts<span class="token punctuation">,</span>
    ii<span class="token punctuation">.</span><span class="token punctuation">`</span>url<span class="token punctuation">`</span> imgUrl<span class="token punctuation">,</span>
    t<span class="token punctuation">.</span>price_discount price 
<span class="token keyword">FROM</span>
    items i
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> items_img ii <span class="token keyword">ON</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> ii<span class="token punctuation">.</span><span class="token punctuation">`</span>item_id<span class="token punctuation">`</span>
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> item_id<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span> price_discount <span class="token punctuation">)</span> price_discount <span class="token keyword">FROM</span> items_spec <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> item_id <span class="token punctuation">)</span> t <span class="token keyword">ON</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> t<span class="token punctuation">.</span>item_id 
<span class="token keyword">WHERE</span>
    ii<span class="token punctuation">.</span><span class="token punctuation">`</span>is_main<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">1</span> 
    <span class="token operator">AND</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">'%好吃%'</span> 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>sell_counts<span class="token punctuation">`</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">-- 商品单价升序排列sql</span>
<span class="token keyword">SELECT</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> itemId<span class="token punctuation">,</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> itemName<span class="token punctuation">,</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>sell_counts<span class="token punctuation">`</span> sellCounts<span class="token punctuation">,</span>
    ii<span class="token punctuation">.</span><span class="token punctuation">`</span>url<span class="token punctuation">`</span> imgUrl<span class="token punctuation">,</span>
    t<span class="token punctuation">.</span>price_discount price 
<span class="token keyword">FROM</span>
    items i
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> items_img ii <span class="token keyword">ON</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> ii<span class="token punctuation">.</span><span class="token punctuation">`</span>item_id<span class="token punctuation">`</span>
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> item_id<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span> price_discount <span class="token punctuation">)</span> price_discount <span class="token keyword">FROM</span> items_spec <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> item_id <span class="token punctuation">)</span> t <span class="token keyword">ON</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> t<span class="token punctuation">.</span>item_id 
<span class="token keyword">WHERE</span>
    ii<span class="token punctuation">.</span><span class="token punctuation">`</span>is_main<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">1</span> 
    <span class="token operator">AND</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">'%好吃%'</span> 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    t<span class="token punctuation">.</span>price_discount <span class="token keyword">ASC</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">-- 商品名称字母顺序排列</span>
<span class="token keyword">SELECT</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> itemId<span class="token punctuation">,</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> itemName<span class="token punctuation">,</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>sell_counts<span class="token punctuation">`</span> sellCounts<span class="token punctuation">,</span>
    ii<span class="token punctuation">.</span><span class="token punctuation">`</span>url<span class="token punctuation">`</span> imgUrl<span class="token punctuation">,</span>
    t<span class="token punctuation">.</span>price_discount price 
<span class="token keyword">FROM</span>
    items i
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> items_img ii <span class="token keyword">ON</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> ii<span class="token punctuation">.</span><span class="token punctuation">`</span>item_id<span class="token punctuation">`</span>
    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> item_id<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span> price_discount <span class="token punctuation">)</span> price_discount <span class="token keyword">FROM</span> items_spec <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> item_id <span class="token punctuation">)</span> t <span class="token keyword">ON</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> t<span class="token punctuation">.</span>item_id 
<span class="token keyword">WHERE</span>
    ii<span class="token punctuation">.</span><span class="token punctuation">`</span>is_main<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">1</span> 
    <span class="token operator">AND</span> i<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">'%好吃%'</span> 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
    i<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> <span class="token keyword">ASC</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>编写数据访问层</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--namespace是数据访问层接口的全路径类名--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.mapper.ItemsMapperCustom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--实现商品搜索展示--></span>
    <span class="token comment" spellcheck="true">&lt;!--
        id是数据访问层接口定义的方法名
        resultType是用于向前端返回数据的类
    --></span>
    <span class="token comment" spellcheck="true">&lt;!--
        1.k是默认排序，即按照名称排序—keyword
        2.c是按照销量排序—counts
        3.p是按照价格排序—price
    --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>searchItems<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.pojo.vo.SearchItemsVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        select
          i.`id` itemId,
          i.`item_name` itemName,
          i.`sell_counts` sellCounts,
          ii.`url` imgUrl,
          t.price_discount price
        from
          items i
          left join items_img ii
            on i.`id` = ii.`item_id`
          left join
            (select
              item_id,
              min(price_discount) price_discount
            from
              items_spec
            group by item_id) t
            on i.`id` = t.item_id
        where ii.`is_main` = 1
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paramsMap.keywords !<span class="token punctuation">=</span> null and paramsMap.keywords !<span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            and i.`item_name` like '%${paramsMap.keywords}%'
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>
        order by
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>choose</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paramsMap.sort <span class="token punctuation">=</span><span class="token punctuation">=</span> &amp;quot;c&amp;quot;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                i.`sell_counts` desc
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paramsMap.sort <span class="token punctuation">=</span><span class="token punctuation">=</span> &amp;quot;p&amp;quot;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                t.price_discount asc
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>otherwise</span><span class="token punctuation">></span></span>
                i.`item_name` asc
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>otherwise</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>choose</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> ItemsMapperCustom itemsMapperCustom<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 根据搜索关键字查询商品，并按指定规则进行排序</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> PagedGridResult <span class="token function">queryPagedSearchItems</span><span class="token punctuation">(</span>String keyWords<span class="token punctuation">,</span> String sortRule<span class="token punctuation">,</span> Integer page<span class="token punctuation">,</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"keywords"</span><span class="token punctuation">,</span> keyWords<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sort"</span><span class="token punctuation">,</span> sortRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 查询之前使用PageHelper进行分页；Page-页数，PageSize-每页显示条数</span>
    PageHelper<span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>SearchItemsVO<span class="token operator">></span> searchItems <span class="token operator">=</span> itemsMapperCustom<span class="token punctuation">.</span><span class="token function">searchItems</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    PagedGridResult pagedGrid <span class="token operator">=</span> <span class="token function">getPagedGrid</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> searchItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pagedGrid<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"搜索商品列表"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"搜索商品列表"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/search"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getSearchItems</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"keywords"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"搜索关键字"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String keywords<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"sort"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"排序方式"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String sort<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"当前页数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer page<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"pageSize"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"每页显示记录数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>keywords<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 为page和pageSize赋初值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> null <span class="token operator">||</span> pageSize <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>PAGE_NUMBER<span class="token punctuation">;</span>
        pageSize <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>PAGE_SIZE_COUNTS<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    PagedGridResult gridResult <span class="token operator">=</span> itemService<span class="token punctuation">.</span><span class="token function">queryPagedSearchItems</span><span class="token punctuation">(</span>keywords<span class="token punctuation">,</span> sort<span class="token punctuation">,</span> page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>gridResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-2-6-2-搜索商品-前端业务与分类搜索查询"><a href="#1-2-6-2-搜索商品-前端业务与分类搜索查询" class="headerlink" title="1.2.6.2 搜索商品 - 前端业务与分类搜索查询"></a>1.2.6.2 搜索商品 - 前端业务与分类搜索查询</h4><ol>
<li><p>需求分析</p>
<ol>
<li>通过三级菜单项来检索查询相关商品信息(和普通搜索原理一致)</li>
</ol>
</li>
</ol>
<h4 id="1-2-6-3-搜索商品-分类搜索商品查询实现"><a href="#1-2-6-3-搜索商品-分类搜索商品查询实现" class="headerlink" title="1.2.6.3 搜索商品 - 分类搜索商品查询实现"></a>1.2.6.3 搜索商品 - 分类搜索商品查询实现</h4><ol>
<li><p>编写数据访问层</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--根据三级分类名称查询商品详情--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>searchItemsByThirdCategory<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.pojo.vo.SearchItemsVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    select
      i.`id` itemId,
      i.`item_name` itemName,
      i.`sell_counts` sellCounts,
      ii.`url` imgUrl,
      t.price_discount price
    from
      items i
    left join 
      items_img ii
    on 
      i.`id` = ii.`item_id`
    left join
      (select
      item_id,
      min(price_discount) price_discount
    from
      items_spec
    group by 
      item_id) t
    on 
      i.`id` = t.item_id
    where 
      ii.`is_main` = 1
    and 
      i.cat_id = #{paramsMap.catId}
    order by
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>choose</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paramsMap.sort <span class="token punctuation">=</span><span class="token punctuation">=</span> &amp;quot;c&amp;quot;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            i.`sell_counts` desc
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paramsMap.sort <span class="token punctuation">=</span><span class="token punctuation">=</span> &amp;quot;p&amp;quot;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            t.price_discount asc
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>otherwise</span><span class="token punctuation">></span></span>
            i.`item_name` asc
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>otherwise</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>choose</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 根据三级分类名查询商品信息，并按指定规则进行排序</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> PagedGridResult <span class="token function">queryPagedSeachItems</span><span class="token punctuation">(</span>Integer catId<span class="token punctuation">,</span> String sortRule<span class="token punctuation">,</span> Integer page<span class="token punctuation">,</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"catId"</span><span class="token punctuation">,</span> catId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sort"</span><span class="token punctuation">,</span> sortRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 查询之前使用PageHelper进行分页；Page-页数，PageSize-每页显示条数</span>
    PageHelper<span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>SearchItemsVO<span class="token operator">></span> searchItems <span class="token operator">=</span> itemsMapperCustom<span class="token punctuation">.</span><span class="token function">searchItemsByThirdCategory</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    PagedGridResult pagedGrid <span class="token operator">=</span> <span class="token function">getPagedGrid</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> searchItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pagedGrid<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"根据三级Id搜索商品列表"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"根据三级Id搜索商品列表"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/catItems"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getSearchItemsByCatId</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"catId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"三级分类Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer catId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"sort"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"排序方式"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String sort<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"当前页数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer page<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"pageSize"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"每页显示记录数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>catId <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 为page和pageSize赋初值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> null <span class="token operator">||</span> pageSize <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>PAGE_NUMBER<span class="token punctuation">;</span>
        pageSize <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>PAGE_SIZE_COUNTS<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    PagedGridResult gridResult <span class="token operator">=</span> itemService<span class="token punctuation">.</span><span class="token function">queryPagedSeachItems</span><span class="token punctuation">(</span>catId<span class="token punctuation">,</span> sort<span class="token punctuation">,</span> page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>gridResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-2-7-购物车-购物车存储形式"><a href="#1-2-7-购物车-购物车存储形式" class="headerlink" title="1.2.7 购物车 - 购物车存储形式"></a>1.2.7 购物车 - 购物车存储形式</h3><ol>
<li><p>需求分析</p>
<ol>
<li>实现不同商品添加购物车功能进行统一结算</li>
<li>同一商品不同规格分条展示</li>
<li>同一商品相同规格展示一条记录并增加数量</li>
</ol>
</li>
<li><p>存储方式</p>
<ol>
<li><p><code>cookie</code>形式</p>
<blockquote>
<p>无须登录，无须后端交互；将数据保存在浏览器中</p>
</blockquote>
<ol>
<li>优点：性能好，访问快</li>
<li>缺点：<ol>
<li>有大小(<code>4KB</code>)限制</li>
<li>数据会随着<code>cookie</code>过期而丢失</li>
<li><code>cookie</code>易被他人获取</li>
</ol>
</li>
</ol>
</li>
<li><p><code>Session</code>方式</p>
<blockquote>
<p>用户必须登录才能使用，将数据存储到Session中</p>
</blockquote>
<ol>
<li>优点：初期性能好，访问快</li>
<li>缺点：<ol>
<li>Session基于内存实现，不适用大用户量情况</li>
<li>只能存在于当前会话，不适用集群和分布式系统(不能保证Session相同)</li>
</ol>
</li>
</ol>
</li>
<li><p>数据库</p>
<blockquote>
<p>用户登录后将购物车数据写入数据库</p>
</blockquote>
<ol>
<li>优点：数据持久化，可以在任何地点进行访问</li>
<li>缺点：频繁读写数据库，造成数据库性能压力</li>
</ol>
</li>
<li><p><code>redis</code>方式</p>
<blockquote>
<p>分布式缓存中间件，用户登录以后将购物车数据写入缓存</p>
</blockquote>
<ol>
<li>优点：<ol>
<li>数据可持久化，在任何地点都可访问</li>
<li>频繁的读写只基于缓存，不会造成数据库访问压力</li>
<li>适用于集群与分布式系统，可扩展性强</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="1-2-7-1-购物车-未登录已登录加入购物车业务代码讲解"><a href="#1-2-7-1-购物车-未登录已登录加入购物车业务代码讲解" class="headerlink" title="1.2.7.1 购物车 - 未登录已登录加入购物车业务代码讲解"></a>1.2.7.1 购物车 - 未登录已登录加入购物车业务代码讲解</h4><ol>
<li><p>需求分析</p>
<blockquote>
<p>使用cookie进行数据存储；用户登录将购物车数据发送给服务器</p>
</blockquote>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"添加购物车数据"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"购物车数据"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/add"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">addCart</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
                             <span class="token annotation punctuation">@RequestBody</span> ShopCartBO shopCartBO<span class="token punctuation">,</span>
                             HttpServletRequest request<span class="token punctuation">,</span>
                             HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"用户Id不能为null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// todo 前端用户在登录情况下，添加商品到购物车；会同时在后端同步购物车到redis缓存</span>

    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-2-7-2-购物车-渲染-刷新-购物车"><a href="#1-2-7-2-购物车-渲染-刷新-购物车" class="headerlink" title="1.2.7.2 购物车 - 渲染(刷新)购物车"></a>1.2.7.2 购物车 - 渲染(刷新)购物车</h4><ol>
<li><p>需求分析</p>
<blockquote>
<p>根据用户Id查询用户购物实时最新数据返回给前端</p>
</blockquote>
</li>
<li><p>编写数据访问层</p>
<ol>
<li><p>映射注意点</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/24.%E8%B4%AD%E7%89%A9%E8%BD%A6%E6%98%A0%E5%B0%84%E6%95%B0%E6%8D%AE%E6%B3%A8%E6%84%8F%E7%82%B9.png" alt="购物车映射数据注意点"></p>
</li>
</ol>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--根据用户Id返回最新购物车数据--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>queryItemsBySpecIds<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.pojo.vo.ShopCartVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    select
      i.`id` itemId,
      ii.`url` itemImgUrl,
      i.`item_name` itemName,
      isp.`id` specId,
      isp.`name` specName,
      isp.`price_discount` priceDiscount,
      isp.`price_normal`  priceNormal
    from
      items_spec isp
    left join 
      items i
    on 
      i.`id` = isp.`item_id`
    left join 
      items_img ii
    on 
      i.`id` = ii.`item_id`
    where 
      ii.`is_main` = 1
    and 
      isp.`id`in
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paramList<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>specId<span class="token punctuation">"</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        #{specId}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 根据商品Id列表查询对应商品信息</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>ShopCartVO<span class="token operator">></span> <span class="token function">queryItemsBySpecIds</span><span class="token punctuation">(</span>String specIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 获取Id集合</span>
    String<span class="token punctuation">[</span><span class="token punctuation">]</span> Ids <span class="token operator">=</span> specIds<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 创建目标集合</span>
    List<span class="token operator">&lt;</span>String<span class="token operator">></span> specIdsList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 使用工具类对目标集合进行元素添加</span>
    Collections<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>specIdsList<span class="token punctuation">,</span> Ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>ShopCartVO<span class="token operator">></span> shopCarts <span class="token operator">=</span> itemsMapperCustom<span class="token punctuation">.</span><span class="token function">queryItemsBySpecIds</span><span class="token punctuation">(</span>specIdsList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> shopCarts<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"根据商品规格Ids查询商品最新信息"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"根据商品规格Ids查询商品最新信息"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/refresh"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getItemsBySpecIds</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"itemSpecIds"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"商品规格数组"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"1,2,3"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String itemSpecIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>itemSpecIds<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    List<span class="token operator">&lt;</span>ShopCartVO<span class="token operator">></span> shopCarts <span class="token operator">=</span> itemService<span class="token punctuation">.</span><span class="token function">queryItemsBySpecIds</span><span class="token punctuation">(</span>itemSpecIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>shopCarts<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-2-7-3-购物车-删除商品业务讲解"><a href="#1-2-7-3-购物车-删除商品业务讲解" class="headerlink" title="1.2.7.3 购物车 - 删除商品业务讲解"></a>1.2.7.3 购物车 - 删除商品业务讲解</h4><ol>
<li><p>需求分析</p>
<ol>
<li>当用户未登录时，仅在前端cookie中进行删除</li>
<li>当用户已登录时，进行后端资源访问，对商品进行删除</li>
</ol>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"删除购物车数据"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"删除购物车数据"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/del"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">delCart</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
                             <span class="token annotation punctuation">@RequestParam</span> String itemSpecId<span class="token punctuation">,</span>
                             HttpServletRequest request<span class="token punctuation">,</span>
                             HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token operator">||</span> StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>itemSpecId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"用户Id不能为null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// todo 前端用户在登录情况下，从购物车删除商品；会同时在后端同步购物车到redis缓存</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-2-7-4-购物车-结算商品业务讲解"><a href="#1-2-7-4-购物车-结算商品业务讲解" class="headerlink" title="1.2.7.4 购物车 - 结算商品业务讲解"></a>1.2.7.4 购物车 - 结算商品业务讲解</h4><ol>
<li>需求分析<ol>
<li>当用户未登录时不允许进行结算操作</li>
<li>当用户未选中商品时不允许进行结算操作</li>
<li>只有当用户登录且选中商品才允许结算</li>
<li>点击结算按钮跳转确认结算页面进入订单流程</li>
</ol>
</li>
<li>该操作只涉及前端操作</li>
</ol>
<h2 id="1-3-地址，订单，支付模块开发"><a href="#1-3-地址，订单，支付模块开发" class="headerlink" title="1.3 地址，订单，支付模块开发"></a>1.3 地址，订单，支付模块开发</h2><h3 id="1-3-1-收货地址-需求分析与表设计"><a href="#1-3-1-收货地址-需求分析与表设计" class="headerlink" title="1.3.1 收货地址 - 需求分析与表设计"></a>1.3.1 收货地址 - 需求分析与表设计</h3><ol>
<li><p>需求分析</p>
<ol>
<li>查询数据库所有地址信息列表</li>
<li>并且默认地址由独立字段标识</li>
<li>可以将任意地址设为默认地址</li>
<li>可以编辑任何地址地址信息</li>
<li>可以删除任何地址信息</li>
<li>前端传递的表单信息需要封装一个BO对象</li>
</ol>
</li>
<li><p>数据库表字段信息</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/25.%E5%9C%B0%E5%9D%80%E8%A1%A8%E5%AD%97%E6%AE%B5%E4%BF%A1%E6%81%AF.png" alt="地址表字段信息"></p>
<ol>
<li>0为非默认地址，1为默认地址</li>
</ol>
</li>
</ol>
<h4 id="1-3-1-1-收货地址-增删改查功能开发"><a href="#1-3-1-1-收货地址-增删改查功能开发" class="headerlink" title="1.3.1.1 收货地址 - 增删改查功能开发"></a>1.3.1.1 收货地址 - 增删改查功能开发</h4><ol>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 注入数据访问层</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> UserAddressMapper userAddressMapper<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 注入Id算法</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> Sid sid<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 查询用户所有地址信息列表</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>UserAddress<span class="token operator">></span> <span class="token function">queryAllUserAddress</span><span class="token punctuation">(</span>String userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 创建用户地址对象</span>
    UserAddress userAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 为用户地址对象设置Id</span>
    userAddress<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 根据用户Id数据库检索用户地址信息列表返回</span>
    <span class="token keyword">return</span> userAddressMapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>userAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 添加用户地址信息列表</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addNewUserAddress</span><span class="token punctuation">(</span>AddressBO addressBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 判断当前用户是否存在地址，如果没有，则新增为‘默认地址’；初始化默认地址标签为1</span>
    Integer isDefault <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 获取默认地址列表信息</span>
    List<span class="token operator">&lt;</span>UserAddress<span class="token operator">></span> addressList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">queryAllUserAddress</span><span class="token punctuation">(</span>addressBO<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>addressList <span class="token operator">==</span> null <span class="token operator">||</span> addressList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> addressList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 3. 将新设地址默认字段置为1</span>
        isDefault <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 4. 获取默认地址Id值</span>
    String addressId <span class="token operator">=</span> sid<span class="token punctuation">.</span><span class="token function">nextShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 5. 保存地址到数据库</span>
    <span class="token comment" spellcheck="true">// 5.1 创建用于封装地址信息的对象</span>
    UserAddress newAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 5.2 将前端传递的BO对象转为地址对象的实例对象</span>
    BeanUtils<span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>addressBO<span class="token punctuation">,</span> newAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 5.3 封装地址信息</span>
    newAddress<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>addressId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newAddress<span class="token punctuation">.</span><span class="token function">setIsDefault</span><span class="token punctuation">(</span>isDefault<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newAddress<span class="token punctuation">.</span><span class="token function">setCreatedTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newAddress<span class="token punctuation">.</span><span class="token function">setUpdatedTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 6. 向数据库添加默认地址信息</span>
    userAddressMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>newAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 修改用户地址信息列表</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUserAddress</span><span class="token punctuation">(</span>AddressBO addressBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//1. 获取用户地址信息Id</span>
    String addressId <span class="token operator">=</span> addressBO<span class="token punctuation">.</span><span class="token function">getAddressId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//2. 创建用户地址信息对象</span>
    UserAddress pendingAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//3. 将接收的对象转为用户地址信息对象</span>
    BeanUtils<span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>addressBO<span class="token punctuation">,</span> pendingAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//4. 为用户地址信息对象进行参数封装</span>
    pendingAddress<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>addressId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pendingAddress<span class="token punctuation">.</span><span class="token function">setUpdatedTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//5. 更新用户地址信息</span>
    userAddressMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>pendingAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 删除用户地址信息列表</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUserAddress</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> String addressId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    UserAddress address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 1. 设置用户Id</span>
    address<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>addressId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 设置地址Id</span>
    address<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 删除指定Id的地址信息</span>
    userAddressMapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 查询指定用户的指定地址信息</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> UserAddress <span class="token function">queryUserAddres</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> String addressId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 创建地址信息对象</span>
    UserAddress singleAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 为地址信息对象设置地址Id</span>
    singleAddress<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>addressId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 为地址信息对象设置用户Id</span>
    singleAddress<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 4. 返回查询对应地址对象</span>
    <span class="token keyword">return</span> userAddressMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>singleAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 注入业务层</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> UserAddressService userAddressService<span class="token punctuation">;</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"根据用户id查询收货地址列表"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"根据用户id查询收货地址列表"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">list</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    List<span class="token operator">&lt;</span>UserAddress<span class="token operator">></span> list <span class="token operator">=</span> userAddressService<span class="token punctuation">.</span><span class="token function">queryAllUserAddress</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户新增地址"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户新增地址"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/add"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> AddressBO addressBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    MJHJSONResult checkRes <span class="token operator">=</span> <span class="token function">checkAddress</span><span class="token punctuation">(</span>addressBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>checkRes<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> checkRes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    userAddressService<span class="token punctuation">.</span><span class="token function">addNewUserAddress</span><span class="token punctuation">(</span>addressBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户修改地址"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户修改地址"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/update"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> AddressBO addressBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>addressBO<span class="token punctuation">.</span><span class="token function">getAddressId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"修改地址错误：addressId不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    MJHJSONResult checkRes <span class="token operator">=</span> <span class="token function">checkAddress</span><span class="token punctuation">(</span>addressBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>checkRes<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> checkRes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    userAddressService<span class="token punctuation">.</span><span class="token function">updateUserAddress</span><span class="token punctuation">(</span>addressBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户删除地址"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户删除地址"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">delete</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@RequestParam</span> String addressId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token operator">||</span> StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>addressId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    userAddressService<span class="token punctuation">.</span><span class="token function">deleteUserAddress</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> addressId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 对用户地址信息对象进行健壮性判断返回正常的地址信息对象</span>
<span class="token keyword">private</span> MJHJSONResult <span class="token function">checkAddress</span><span class="token punctuation">(</span>AddressBO addressBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    String receiver <span class="token operator">=</span> addressBO<span class="token punctuation">.</span><span class="token function">getReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"收货人不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>receiver<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"收货人姓名不能太长"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    String mobile <span class="token operator">=</span> addressBO<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>mobile<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"收货人手机号不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mobile<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"收货人手机号长度不正确"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">boolean</span> isMobileOk <span class="token operator">=</span> MobileEmailUtils<span class="token punctuation">.</span><span class="token function">checkMobileIsOk</span><span class="token punctuation">(</span>mobile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMobileOk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"收货人手机号格式不正确"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    String province <span class="token operator">=</span> addressBO<span class="token punctuation">.</span><span class="token function">getProvince</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String city <span class="token operator">=</span> addressBO<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String district <span class="token operator">=</span> addressBO<span class="token punctuation">.</span><span class="token function">getDistrict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String detail <span class="token operator">=</span> addressBO<span class="token punctuation">.</span><span class="token function">getDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>province<span class="token punctuation">)</span> <span class="token operator">||</span>
        StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token operator">||</span>
        StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>district<span class="token punctuation">)</span> <span class="token operator">||</span>
        StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>detail<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"收货地址信息不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-3-1-2-收货地址-默认收货地址设置"><a href="#1-3-1-2-收货地址-默认收货地址设置" class="headerlink" title="1.3.1.2 收货地址 - 默认收货地址设置"></a>1.3.1.2 收货地址 - 默认收货地址设置</h4><ol>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 设置用户默认地址信息</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUserAddressToBeDefault</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> String addressId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 查找默认地址，设置为不默认</span>
    UserAddress queryAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 设置用户Id</span>
    queryAddress<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 设置为默认地址</span>
    queryAddress<span class="token punctuation">.</span><span class="token function">setIsDefault</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>YES<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 4. 获取到默认地址列表</span>
    List<span class="token operator">&lt;</span>UserAddress<span class="token operator">></span> list <span class="token operator">=</span> userAddressMapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>queryAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 5. 遍历默认地址列表</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>UserAddress ua <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 5.1 将默认地址的默认字段值修改为NO-0</span>
        ua<span class="token punctuation">.</span><span class="token function">setIsDefault</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>NO<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 5.2 为默认地址更新默认字段值</span>
        userAddressMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 6. 根据地址id修改为默认的地址</span>
    UserAddress defaultAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 7. 设置默认地址Id</span>
    defaultAddress<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>addressId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 8. 设置默认地址对应的用户Id</span>
    defaultAddress<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 9. 设置默认地址对应的默认字段</span>
    defaultAddress<span class="token punctuation">.</span><span class="token function">setIsDefault</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>YES<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 10. 更新默认地址信息</span>
    userAddressMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>defaultAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户设置默认地址"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户设置默认地址"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/setDefalut"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">setDefalut</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@RequestParam</span> String addressId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token operator">||</span> StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>addressId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    userAddressService<span class="token punctuation">.</span><span class="token function">updateUserAddressToBeDefault</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> addressId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-3-2-确认订单-订单流程梳理与订单状态"><a href="#1-3-2-确认订单-订单流程梳理与订单状态" class="headerlink" title="1.3.2 确认订单 - 订单流程梳理与订单状态"></a>1.3.2 确认订单 - 订单流程梳理与订单状态</h3><ol>
<li><p>订单流程</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/26.%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98%E6%B5%81%E7%A8%8B.png" alt="订单支付流程"></p>
</li>
<li><p>订单状态变化</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/27.%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96%E5%B1%95%E7%A4%BA.png" alt="订单状态变化展示"></p>
</li>
</ol>
<h4 id="1-3-2-1-确认订单-订单表设计"><a href="#1-3-2-1-确认订单-订单表设计" class="headerlink" title="1.3.2.1 确认订单 - 订单表设计"></a>1.3.2.1 确认订单 - 订单表设计</h4><ol>
<li><p>订单表详情</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterOne/28.%E8%AE%A2%E5%8D%95%E8%A1%A8%E4%BF%A1%E6%81%AF.png" alt="订单表信息"></p>
</li>
<li><p>订单商品表详情</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/2022/01/09/1-mkjavaprojectnotes-one/githubblog\source_posts\MKProjectImage\ChapterOne\0029.订单商品表详情.png" alt="订单商品表详情"></p>
</li>
<li><p>订单状态表详情</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/2022/01/09/1-mkjavaprojectnotes-one/githubblog\source_posts\MKProjectImage\ChapterOne\0030.订单状态表详情.png" alt="订单状态表详情"></p>
</li>
<li><p>注意</p>
<ol>
<li>订单表和订单商品表是一对多的关系</li>
<li>订单表和订单状态表是一对一的关系</li>
<li>订单有两种状态关联到订单状态表</li>
</ol>
</li>
</ol>
<h4 id="1-3-2-2-确认订单-聚合支付中心作用"><a href="#1-3-2-2-确认订单-聚合支付中心作用" class="headerlink" title="1.3.2.2 确认订单 - 聚合支付中心作用"></a>1.3.2.2 确认订单 - 聚合支付中心作用</h4><ol>
<li>流程图示<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/2022/01/09/1-mkjavaprojectnotes-one/githubblog\source_posts\MKProjectImage\ChapterOne\0031.支付流程图示.png" alt="支付流程图示"></li>
</ol>
<h4 id="1-3-2-3-确认订单-提交并且接受订单信息"><a href="#1-3-2-3-确认订单-提交并且接受订单信息" class="headerlink" title="1.3.2.3 确认订单 - 提交并且接受订单信息"></a>1.3.2.3 确认订单 - 提交并且接受订单信息</h4><ol>
<li><p>需求分析</p>
<blockquote>
<p>提交页面的订单数据</p>
</blockquote>
</li>
<li><p>实现要点</p>
<ol>
<li>创建订单</li>
<li>创建订单以后，移除购物车中已结算(已提交)的商品</li>
<li>向支付中心发送当前订单，保存支付中心的订单数据</li>
</ol>
</li>
</ol>
<h3 id="1-3-3-创建订单"><a href="#1-3-3-创建订单" class="headerlink" title="1.3.3 创建订单"></a>1.3.3 创建订单</h3><ol>
<li><p>需求分析</p>
<ol>
<li>新订单数据保存</li>
<li>循环保存到订单商品信息表</li>
<li>保存订单状态表</li>
</ol>
</li>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> String <span class="token function">createOrder</span><span class="token punctuation">(</span>SubmitOrderBO submitOrderBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 获取订单信息，用户id，地址id，商品规格id，支付方式，留言</span>
    String userId <span class="token operator">=</span> submitOrderBO<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String addressId <span class="token operator">=</span> submitOrderBO<span class="token punctuation">.</span><span class="token function">getAddressId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String itemSpecIds <span class="token operator">=</span> submitOrderBO<span class="token punctuation">.</span><span class="token function">getItemSpecIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Integer payMethod <span class="token operator">=</span> submitOrderBO<span class="token punctuation">.</span><span class="token function">getPayMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String leftMsg <span class="token operator">=</span> submitOrderBO<span class="token punctuation">.</span><span class="token function">getLeftMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 默认包邮</span>
    Integer postAmount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 生成本次订单ID</span>
    String orderId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sid<span class="token punctuation">.</span><span class="token function">nextShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 根据用户ID和地址ID获取具体地址信息</span>
    UserAddress userAddress <span class="token operator">=</span> userAddressService<span class="token punctuation">.</span><span class="token function">queryUserAddres</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> addressId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 拼接地址</span>
    String address <span class="token operator">=</span> userAddress<span class="token punctuation">.</span><span class="token function">getProvince</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> userAddress<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span>
        <span class="token operator">+</span> userAddress<span class="token punctuation">.</span><span class="token function">getDistrict</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> userAddress<span class="token punctuation">.</span><span class="token function">getDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 1. 封装新订单数据保存</span>
    Orders newOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Orders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setReceiverName</span><span class="token punctuation">(</span>userAddress<span class="token punctuation">.</span><span class="token function">getReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setReceiverMobile</span><span class="token punctuation">(</span>userAddress<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setReceiverAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setPostAmount</span><span class="token punctuation">(</span>postAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setPayMethod</span><span class="token punctuation">(</span>payMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setLeftMsg</span><span class="token punctuation">(</span>leftMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setIsComment</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>NO<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setIsDelete</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>NO<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setCreatedTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setUpdatedTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 根据itemSpecIds循环保存订单商品信息表</span>
    String<span class="token punctuation">[</span><span class="token punctuation">]</span> itemSpecIdArr <span class="token operator">=</span> itemSpecIds<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Integer totalAmount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    Integer realPayAmount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>String itemSpaecId <span class="token operator">:</span> itemSpecIdArr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// todo 整合Redis后，商品购买的数量重新从Redis中获取</span>
        <span class="token keyword">int</span> buyCounts <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.1 根据规格Id，查询规格信息，获取商品价格</span>
        ItemsSpec itemsSpec <span class="token operator">=</span> itemService<span class="token punctuation">.</span><span class="token function">queryItemSpecById</span><span class="token punctuation">(</span>itemSpaecId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        totalAmount <span class="token operator">+=</span> itemsSpec<span class="token punctuation">.</span><span class="token function">getPriceNormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> buyCounts<span class="token punctuation">;</span>
        realPayAmount <span class="token operator">+=</span> itemsSpec<span class="token punctuation">.</span><span class="token function">getPriceDiscount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> buyCounts<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.2 根据商品Id，查询商品信息以及图片</span>
        String itemId <span class="token operator">=</span> itemsSpec<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Items item <span class="token operator">=</span> itemService<span class="token punctuation">.</span><span class="token function">queryItemById</span><span class="token punctuation">(</span>itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String imgUrl <span class="token operator">=</span> itemService<span class="token punctuation">.</span><span class="token function">queryItemMainImgById</span><span class="token punctuation">(</span>itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.3 循环保存(封装)子订单到数据库</span>
        String subOrderId <span class="token operator">=</span> sid<span class="token punctuation">.</span><span class="token function">nextShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        OrderItems subOrderItems <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subOrderItems<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>subOrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        subOrderItems<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        subOrderItems<span class="token punctuation">.</span><span class="token function">setItemId</span><span class="token punctuation">(</span>itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        subOrderItems<span class="token punctuation">.</span><span class="token function">setItemName</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getItemName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subOrderItems<span class="token punctuation">.</span><span class="token function">setItemImg</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        subOrderItems<span class="token punctuation">.</span><span class="token function">setBuyCounts</span><span class="token punctuation">(</span>buyCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
        subOrderItems<span class="token punctuation">.</span><span class="token function">setItemSpecId</span><span class="token punctuation">(</span>itemSpaecId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        subOrderItems<span class="token punctuation">.</span><span class="token function">setItemSpecName</span><span class="token punctuation">(</span>itemsSpec<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subOrderItems<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>itemsSpec<span class="token punctuation">.</span><span class="token function">getPriceDiscount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderItemsMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>subOrderItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.4 用户提交订单以后，规格表中需要扣除库存数量</span>
        itemService<span class="token punctuation">.</span><span class="token function">decreaseItemSpecStock</span><span class="token punctuation">(</span>itemSpaecId<span class="token punctuation">,</span> buyCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>totalAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newOrder<span class="token punctuation">.</span><span class="token function">setRealPayAmount</span><span class="token punctuation">(</span>realPayAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ordersMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>newOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 保存(封装)订单状态表</span>
    OrderStatus waitPayOrderStatus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    waitPayOrderStatus<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    waitPayOrderStatus<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span>OrderStatusEnum<span class="token punctuation">.</span>WAIT_PAY<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    waitPayOrderStatus<span class="token punctuation">.</span><span class="token function">setCreatedTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatusMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>waitPayOrderStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> orderId<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户下单"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户下单"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/create"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> SubmitOrderBO submitOrderBO<span class="token punctuation">,</span>
                                 HttpServletRequest request<span class="token punctuation">,</span>
                                 HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>submitOrderBO<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 1. 创建订单</span>
    String orderId <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">createOrder</span><span class="token punctuation">(</span>submitOrderBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 创建订单以后，移除购物车中已结算(已提交)的商品</span>
    <span class="token comment" spellcheck="true">// todo 整合订单以后，完善购物车中的已结算商品清除，并且同步前端cookie中</span>
    <span class="token comment" spellcheck="true">// CookieUtils.setCookie(request, response, ProjectConstant.FOODIE_SHORTCART, "", true);</span>
    <span class="token comment" spellcheck="true">// 3. 向支付中心发送当前订单，保存支付中心的订单数据</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>涉及其他业务逻辑层方法(新增)</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 查询指定用户的指定地址信息</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> UserAddress <span class="token function">queryUserAddres</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> String addressId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 创建地址信息对象</span>
    UserAddress singleAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 为地址信息对象设置地址Id</span>
    singleAddress<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>addressId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 为地址信息对象设置用户Id</span>
    singleAddress<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 4. 返回查询对应地址对象</span>
    <span class="token keyword">return</span> userAddressMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>singleAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 根据商品规格ID获取规格对象信息</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> ItemsSpec <span class="token function">queryItemSpecById</span><span class="token punctuation">(</span>String specId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> itemsSpecMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>specId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 根据商品ID获取商品主图的URL</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">queryItemMainImgById</span><span class="token punctuation">(</span>String itemId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 根据商品Id构造查询对象</span>
    ItemsImg itemsImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ItemsImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    itemsImg<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    itemsImg<span class="token punctuation">.</span><span class="token function">setIsMain</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>YES<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 使用构造对象查询主图URL</span>
    ItemsImg itemMainImg <span class="token operator">=</span> itemsImgMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>itemsImg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> itemMainImg <span class="token operator">!=</span> null <span class="token operator">?</span> itemMainImg<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 减少库存</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decreaseItemSpecStock</span><span class="token punctuation">(</span>String specId<span class="token punctuation">,</span> <span class="token keyword">int</span> buyCounts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
      * @Description // TODO 超卖问题处理
      * @Date 17:44 2022/1/20
      * @Param [specId, buyCounts]
      * @return java.lang.String
      * synchronized 不推荐使用，集群环境下失效，性能低下
      * 锁数据库，导致数据库性能低下，不使用
      * 分布式锁，zookeeper，Redis
      **/</span>
    <span class="token keyword">int</span> stock <span class="token operator">=</span> itemsMapperCustom<span class="token punctuation">.</span><span class="token function">decreaseItemSpecStock</span><span class="token punctuation">(</span>specId<span class="token punctuation">,</span> buyCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stock <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"库存不足，订单创建失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-3-4-订单支付"><a href="#1-3-4-订单支付" class="headerlink" title="1.3.4 订单支付"></a>1.3.4 订单支付</h3><ol>
<li><p>需求分析</p>
<ol>
<li><p>支付中心数据库表结构</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/2022/01/09/1-mkjavaprojectnotes-one/githubblog\source_posts\MKProjectImage\ChapterOne\0032.支付中心数据库表结构.png" alt="支付中心数据库表结构"></p>
</li>
</ol>
</li>
</ol>
<h4 id="1-3-4-1-微信支付业务流程"><a href="#1-3-4-1-微信支付业务流程" class="headerlink" title="1.3.4.1 微信支付业务流程"></a>1.3.4.1 微信支付业务流程</h4><ol>
<li><p>微信支付时序图，业务流程时序图，来自链接<code>https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=6_5&amp;index=3</code></p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://pay.weixin.qq.com/wiki/doc/apiv3/assets/img/pay/wechatpay/5_0.png" alt="微信支付时序流程图"></p>
</li>
<li><p>业务流程说明</p>
<ol>
<li>商户后台系统根据用户选购的商品生成订单。</li>
<li>用户确认支付后调用微信支付【统一下单API】生成预支付交易；</li>
<li>微信支付系统收到请求后生成预支付交易单，并返回交易会话的二维码链接code_url。</li>
<li>商户后台系统根据返回的code_url生成二维码。</li>
<li>用户打开微信“扫一扫”扫描二维码，微信客户端将扫码内容发送到微信支付系统。</li>
<li>微信支付系统收到客户端请求，验证链接有效性后发起用户支付，要求用户授权。</li>
<li>用户在微信客户端输入密码，确认支付后，微信客户端提交授权。</li>
<li>微信支付系统根据用户授权完成支付交易。</li>
<li>微信支付系统完成支付交易后给微信客户端返回交易结果，并将交易结果通过短信、微信消息提示用户。微信客户端展示支付交易结果页面。</li>
<li>微信支付系统通过发送异步消息通知商户后台系统支付结果。商户后台系统需回复接收情况，通知微信后台系统不再发送该单的支付通知。</li>
<li>未收到支付通知的情况，商户后台系统调用【查询订单API】（查单实现可参考：支付回调和查单实现指引）。</li>
<li>商户确认订单已支付后给用户发货。</li>
<li>微信异步通知频率15/15/30/180/1800/1800/1800/1800/3600，单位：秒</li>
</ol>
</li>
</ol>
<h4 id="1-3-4-2-微信支付实现"><a href="#1-3-4-2-微信支付实现" class="headerlink" title="1.3.4.2  微信支付实现"></a>1.3.4.2  微信支付实现</h4><ol>
<li><p>补充知识-Postman跨域访问配置</p>
<ol>
<li><p>获取到浏览器中postman插件id</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/2022/01/09/1-mkjavaprojectnotes-one/githubblog\source_posts\MKProjectImage\ChapterOne\0033.获取浏览器中postman插件id.png" alt="获取浏览器中postman插件id"></p>
</li>
<li><p>将上面的id字符替换掉postman\5.5.5_0\js下文件<code>requester.js</code>和<code>runner.js</code>中的id值</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/2022/01/09/1-mkjavaprojectnotes-one/githubblog\source_posts\MKProjectImage\ChapterOne\0034.修改postman的id值.png" alt="修改postman的id值"></p>
</li>
</ol>
</li>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于创建订单相关信息</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> OrderVO <span class="token function">createOrder</span><span class="token punctuation">(</span>SubmitOrderBO submitOrderBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 4. 构建商户订单，用于传给支付中心</span>
    MerchantOrdersVO merchantOrdersVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MerchantOrdersVO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    merchantOrdersVO<span class="token punctuation">.</span><span class="token function">setMerchantOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    merchantOrdersVO<span class="token punctuation">.</span><span class="token function">setMerchantUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    merchantOrdersVO<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span>realPayAmount <span class="token operator">+</span> postAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    merchantOrdersVO<span class="token punctuation">.</span><span class="token function">setPayMethod</span><span class="token punctuation">(</span>payMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
    merchantOrdersVO<span class="token punctuation">.</span><span class="token function">setReturnUrl</span><span class="token punctuation">(</span>ProjectConstant<span class="token punctuation">.</span>PAY_RETURN_URL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 5. 构建自定义订单VO</span>
    OrderVO orderVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderVO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderVO<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderVO<span class="token punctuation">.</span><span class="token function">setMerchantOrdersVO</span><span class="token punctuation">(</span>merchantOrdersVO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> orderVO<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 修改订单状态</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">updateOrderStatus</span><span class="token punctuation">(</span>String orderId<span class="token punctuation">,</span> Integer orderStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    OrderStatus paidStatus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    paidStatus<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    paidStatus<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span>orderStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    paidStatus<span class="token punctuation">.</span><span class="token function">setPayTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatusMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>paidStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> null<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> OrderStatus <span class="token function">queryOrderStatusInfo</span><span class="token punctuation">(</span>String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> orderStatusMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户下单"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户下单"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/create"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> SubmitOrderBO submitOrderBO<span class="token punctuation">,</span>
                                 HttpServletRequest request<span class="token punctuation">,</span>
                                 HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>submitOrderBO<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 1. 创建订单</span>
    OrderVO order <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">createOrder</span><span class="token punctuation">(</span>submitOrderBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    String orderId <span class="token operator">=</span> order<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 创建订单以后，移除购物车中已结算(已提交)的商品</span>
    <span class="token comment" spellcheck="true">// todo 整合订单以后，完善购物车中的已结算商品清除，并且同步前端cookie中</span>
    <span class="token comment" spellcheck="true">// CookieUtils.setCookie(request, response, ProjectConstant.FOODIE_SHORTCART, "", true);</span>
    <span class="token comment" spellcheck="true">// 3. 向支付中心发送当前订单，保存支付中心的订单数据</span>
    MerchantOrdersVO merchantOrdersVO <span class="token operator">=</span> order<span class="token punctuation">.</span><span class="token function">getMerchantOrdersVO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 为了方便测试，项目提交的支付金额统一设置为1分钱</span>
    merchantOrdersVO<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    HttpHeaders httpHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpHeaders<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>MediaType<span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpHeaders<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">,</span><span class="token string">"mjh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpHeaders<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    HttpEntity<span class="token operator">&lt;</span>MerchantOrdersVO<span class="token operator">></span> httpEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpEntity</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>merchantOrdersVO<span class="token punctuation">,</span> httpHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ResponseEntity<span class="token operator">&lt;</span>MJHJSONResult<span class="token operator">></span> responseEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForEntity</span><span class="token punctuation">(</span>ProjectConstant<span class="token punctuation">.</span>PAY_MENT_URL<span class="token punctuation">,</span> httpEntity<span class="token punctuation">,</span> MJHJSONResult<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    MJHJSONResult body <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"订单创建失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 只有在支付成功后才会调用，流程微信调用支付中心提供的接口，该接口获取支付状态，根据该状态做处理，然后更新商品的购买状态信息等</span>
<span class="token comment" spellcheck="true">// 支付中心通过merchantOrdersVO.getReturnUrl来访问这个资源，修改数据库订单的状态，更新为已支付</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户付款待发货"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户付款待发货"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/notifyMerchantOrderPaid"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> Integer <span class="token function">notifyMerchantOrderPaid</span><span class="token punctuation">(</span>String merchantOrderId<span class="token punctuation">)</span><span class="token punctuation">{</span>
    orderService<span class="token punctuation">.</span><span class="token function">updateOrderStatus</span><span class="token punctuation">(</span>merchantOrderId<span class="token punctuation">,</span> OrderStatusEnum<span class="token punctuation">.</span>WAIT_DELIVER<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> HttpStatus<span class="token punctuation">.</span>OK<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询订单状态信息"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询订单状态信息"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/getPaidOrderInfo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getPaidOrderInfo</span><span class="token punctuation">(</span>String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    OrderStatus orderStatus <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">queryOrderStatusInfo</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>orderStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-3-4-3-支付宝支付业务流程"><a href="#1-3-4-3-支付宝支付业务流程" class="headerlink" title="1.3.4.3 支付宝支付业务流程"></a>1.3.4.3 支付宝支付业务流程</h4><ol>
<li><p>业务流程时序图</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/2022/01/09/1-mkjavaprojectnotes-one/githubblog\source_posts\MKProjectImage\ChapterOne\0035.支付宝时序图.png" alt="支付宝时序图"></p>
</li>
<li><p>业务流程说明</p>
<ol>
<li>商户系统调用 alipay.trade.page.pay（统一收单下单并支付页面接口）向支付宝发起支付请求，支付宝对商户请求参数进行校验，而后重新定向至用户登录页面。</li>
<li>用户确认支付后，支付宝通过 get 请求 returnUrl（商户入参传入），返回同步返回参数。</li>
<li>交易成功后，支付宝通过 post 请求 notifyUrl（商户入参传入），返回异步通知参数。</li>
<li>若由于网络等原因，导致商户系统没有收到异步通知，商户可自行调用 alipay.trade.query（统一收单线下交易查询）接口查询交易以及支付信息（商户也可以直接调用该查询接口，不需要依赖异步通知）。</li>
</ol>
</li>
<li><p>注意</p>
<ol>
<li>由于同步返回的不可靠性，支付结果必须以异步通知或查询接口返回为准，不能依赖同步跳转。</li>
<li>商户系统接收到异步通知以后，必须通过验签（验证通知中的 sign 参数）来确保支付通知是由支付宝发送的。详细验签规则请参见 异步通知验签。</li>
<li>接收到异步通知并验签通过后，请务必核对通知中的 app_id、out_trade_no、total_amount 等参数值是否与请求中的一致，并根据 trade_status 进行后续业务处理。</li>
<li>在支付宝端，partnerId 与 out_trade_no 唯一对应一笔单据，商户端保证不同次支付 out_trade_no 不可重复；若重复，支付宝会关联到原单据，基本信息一致的情况下会以原单据为准进行支付。</li>
</ol>
</li>
</ol>
<h4 id="1-3-4-4-支付宝支付实现"><a href="#1-3-4-4-支付宝支付实现" class="headerlink" title="1.3.4.4 支付宝支付实现"></a>1.3.4.4 支付宝支付实现</h4><blockquote>
<p>代码逻辑同微信支付，传递支付成功跳转链接，由支付中心进行支付方式的区分</p>
</blockquote>
<h3 id="1-3-6-定时任务-定时关闭超期未支付订单"><a href="#1-3-6-定时任务-定时关闭超期未支付订单" class="headerlink" title="1.3.6 定时任务 - 定时关闭超期未支付订单"></a>1.3.6 定时任务 - 定时关闭超期未支付订单</h3><ol>
<li><p>为当前项目添加定时任务</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 创建配置类OrderJob 要添加@Component 声明为Spring组件Bean</span>
<span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 0 0/1 * * ?"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 每隔1小时执行一次</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">autoCloseOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    orderService<span class="token punctuation">.</span><span class="token function">closeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行定时任务，当前时间是"</span> <span class="token operator">+</span> DateUtil<span class="token punctuation">.</span><span class="token function">getCurrentDateString</span><span class="token punctuation">(</span>DateUtil<span class="token punctuation">.</span>DATETIME_PATTERN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写关闭订单业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 关闭超时未支付订单</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 查询所有未付款订单，判断时间是否超过(1天)，超时则关闭订单</span>
    OrderStatus orderStatus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatus<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span>OrderStatusEnum<span class="token punctuation">.</span>WAIT_PAY<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>OrderStatus<span class="token operator">></span> statusList <span class="token operator">=</span> orderStatusMapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>orderStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>OrderStatus status <span class="token operator">:</span> statusList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 获得订单创建时间</span>
        Date createdTime <span class="token operator">=</span> status<span class="token punctuation">.</span><span class="token function">getCreatedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 计算订单创建时间和当前时间差</span>
        <span class="token keyword">int</span> diff <span class="token operator">=</span> DateUtil<span class="token punctuation">.</span><span class="token function">daysBetween</span><span class="token punctuation">(</span>createdTime<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>diff <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 超过1天关闭订单</span>
            OrderStatus overTimeOrderStatus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            overTimeOrderStatus<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            overTimeOrderStatus<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span>OrderStatusEnum<span class="token punctuation">.</span>CLOSE<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
            overTimeOrderStatus<span class="token punctuation">.</span><span class="token function">setCloseTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStatusMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>overTimeOrderStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-3-6-1-定时任务-定时任务弊端与优化方案"><a href="#1-3-6-1-定时任务-定时任务弊端与优化方案" class="headerlink" title="1.3.6.1 定时任务 - 定时任务弊端与优化方案"></a>1.3.6.1 定时任务 - 定时任务弊端与优化方案</h4><ol>
<li>使用定时任务的弊端<ol>
<li>会有时间差 10:00 下单，11:00 检查不足1小时，12点检查，超过1小时</li>
<li>不支持集群 单机可使用，使用集群后，会有多个定时任务</li>
<li>会对数据库进行全表检索，极其影响数据库性能：select * from orders where orderStatus = 10;</li>
</ol>
</li>
<li>解决方案<ol>
<li>使用消息队列的延迟任务(队列)  10:00 下单，11:00 检查，如果状态是未支付，则直接关闭订单</li>
<li>只使用一台计算机节点，单独用来运行所有的定时任务</li>
</ol>
</li>
</ol>
<h2 id="1-4-用户中心，订单-评价管理开发"><a href="#1-4-用户中心，订单-评价管理开发" class="headerlink" title="1.4 用户中心，订单/评价管理开发"></a>1.4 用户中心，订单/评价管理开发</h2><h3 id="1-4-1-用户中心-查询，修改用户信息"><a href="#1-4-1-用户中心-查询，修改用户信息" class="headerlink" title="1.4.1 用户中心 - 查询，修改用户信息"></a>1.4.1 用户中心 - 查询，修改用户信息</h3><ol>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 根据用户Id查询用户信息</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> Users <span class="token function">queryUserInfo</span><span class="token punctuation">(</span>String userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Users users <span class="token operator">=</span> usersMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    users<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> users<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 修改用户信息</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> Users <span class="token function">updateUserInfo</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> CenterUserBO centerUserBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Users user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    BeanUtils<span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>centerUserBO<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUpdatedTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    usersMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">queryUserInfo</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"获取用户信息"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"获取用户信息"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/userInfo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getUserInfo</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Users users <span class="token operator">=</span> userCenterService<span class="token punctuation">.</span><span class="token function">queryUserInfo</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"修改用户信息"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"修改用户信息"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/update"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getUserInfo</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"前端返回的用户对象"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"封装了前端表单信息的用户对象"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Valid</span> CenterUserBO centerUserBO<span class="token punctuation">,</span>
    BindingResult result<span class="token punctuation">,</span>
    HttpServletRequest request<span class="token punctuation">,</span>
    HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 判断BindingResult是否有错误信息，如果有，则返回错误信息</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> errorsInfo <span class="token operator">=</span> <span class="token function">getErrorsInfo</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMap</span><span class="token punctuation">(</span>errorsInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Users users <span class="token operator">=</span> userCenterService<span class="token punctuation">.</span><span class="token function">updateUserInfo</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> centerUserBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    users <span class="token operator">=</span> UsersUlits<span class="token punctuation">.</span><span class="token function">setUserProperty</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    CookieUtils<span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">,</span> JsonUtils<span class="token punctuation">.</span><span class="token function">objectToJson</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// TODO 后续要改，增加token，整合到Redis中，适应分布式</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-4-1-1-用户中心-使用Hibernate验证用户信息"><a href="#1-4-1-1-用户中心-使用Hibernate验证用户信息" class="headerlink" title="1.4.1.1 用户中心 - 使用Hibernate验证用户信息"></a>1.4.1.1 用户中心 - 使用Hibernate验证用户信息</h4><ol>
<li><p>调整CenterUserBO，添加校验注解</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"用户昵称不能为空"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Length</span><span class="token punctuation">(</span>max <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"用户昵称不能超过12位"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"用户昵称"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"nickname"</span><span class="token punctuation">,</span> example<span class="token operator">=</span><span class="token string">"杰森"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> String nickname<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">"^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\\d{8})$"</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"手机号格式不正确"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"手机号"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"mobile"</span><span class="token punctuation">,</span> example<span class="token operator">=</span><span class="token string">"13999999999"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> String mobile<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Email</span>
<span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"邮箱地址"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"email"</span><span class="token punctuation">,</span> example<span class="token operator">=</span><span class="token string">"imooc@imooc.com"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> String email<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Min</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"性别选择不正确"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Max</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"性别选择不正确"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 这里如果前端传递的数字是[0,2]之间的小数，会强制转换为正数，方式直接取整，0,1,2</span>
<span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"性别"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"sex"</span><span class="token punctuation">,</span> example<span class="token operator">=</span><span class="token string">"0:女 1:男 2:保密"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> Integer sex<span class="token punctuation">;</span></code></pre>
</li>
<li><p>修改视图展示层逻辑</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"修改用户信息"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"修改用户信息"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/update"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">updateUserInfo</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"前端返回的用户对象"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"封装了前端表单信息的用户对象"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Valid</span> CenterUserBO centerUserBO<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"后端校验参数"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"包含对前端表单校验的信息"</span><span class="token punctuation">)</span>
    BindingResult result<span class="token punctuation">,</span>
    HttpServletRequest request<span class="token punctuation">,</span>
    HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 判断BindingResult是否有错误信息，如果有，则返回错误信息</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> errorsInfo <span class="token operator">=</span> <span class="token function">getErrorsInfo</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMap</span><span class="token punctuation">(</span>errorsInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 获取错误信息</span>
<span class="token keyword">private</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> <span class="token function">getErrorsInfo</span><span class="token punctuation">(</span>BindingResult result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> errorsInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>FieldError<span class="token operator">></span> errors <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getFieldErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>FieldError error <span class="token operator">:</span> errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 发生验证错误对应的某一个属性</span>
        String field <span class="token operator">=</span> error<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 验证错误信息</span>
        String message <span class="token operator">=</span> error<span class="token punctuation">.</span><span class="token function">getDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errorsInfo<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> errorsInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-4-2-上传头像-定义文件保存位置"><a href="#1-4-2-上传头像-定义文件保存位置" class="headerlink" title="1.4.2 上传头像 - 定义文件保存位置"></a>1.4.2 上传头像 - 定义文件保存位置</h3><ol>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 更新用户图像</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> Users <span class="token function">updateUserFace</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> String faceUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Users user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setFace</span><span class="token punctuation">(</span>faceUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUpdatedTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    usersMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">queryUserInfo</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写资源文件</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name"> file.imageUserFaceLocation</span><span class="token punctuation">=</span><span class="token attr-value">\\workspaces\\images\\foodie\\faces</span>
<span class="token attr-name"> file.imageServerUrlPrefix</span><span class="token punctuation">=</span><span class="token attr-value">http://localhost:8088\\foodie\\faces\\</span></code></pre>
</li>
<li><p>编写资源文件映射类</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"file"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:file-upload-dev.properties"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUpload</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String imageUserFaceLocation<span class="token punctuation">;</span>

    <span class="token keyword">private</span> String imageServerUrlPrefix<span class="token punctuation">;</span>

    <span class="token keyword">public</span> String <span class="token function">getImageUserFaceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> imageUserFaceLocation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setImageUserFaceLocation</span><span class="token punctuation">(</span>String imageUserFaceLocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>imageUserFaceLocation <span class="token operator">=</span> imageUserFaceLocation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getImageServerUrlPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> imageServerUrlPrefix<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setImageServerUrlPrefix</span><span class="token punctuation">(</span>String imageServerUrlPrefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>imageServerUrlPrefix <span class="token operator">=</span> imageServerUrlPrefix<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>实现静态资源映射</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 实现静态资源映射</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span>ResourceHandlerRegistry registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">/</span> 设置浏览器访问规则，这里允许任意规则，
        <span class="token operator">/</span><span class="token operator">/</span> <span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/upload/**"</span><span class="token punctuation">)</span> 表示必须以upload作为访问路径
        <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"file:/workspaces/images/"</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">/</span> 映射本地资源目录
        <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"classpath:/META_INF/resources/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> 映射swagger2
    <span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>
         <span class="token operator">*</span> <span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"file:/workspaces/images/"</span><span class="token punctuation">)</span>里面的参数必须要写成<span class="token string">"file:+路径"</span>的形式，
         <span class="token operator">*</span> 该路径一直到你上传图片的位置
         <span class="token operator">*</span> <span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"file:/workspaces/images/"</span><span class="token punctuation">)</span>路径最后面的斜杠必须加，
         <span class="token operator">*</span> 要不可以测试一下，是不会成功的
         <span class="token operator">*</span> 上传图片的位置不可以是<span class="token keyword">static</span>，要在<span class="token keyword">static</span>下重新创建一个文件夹upload来存放你的图片
         <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"上传用户图像"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"上传用户图像"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/uploadFace"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">uploadFace</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"file"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户头像"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">// 注意MultipartFile值为空，@RequestParam(value = "file")的value值和前端展示</span>
    <span class="token comment" spellcheck="true">// 的&lt;input type="file">里面的字符保持一致</span>
    <span class="token comment" spellcheck="true">// 否则会导致multipartFile为null</span>
    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"file"</span><span class="token punctuation">)</span> MultipartFile multipartFile<span class="token punctuation">,</span>
    HttpServletRequest request<span class="token punctuation">,</span>
    HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 用户上传头像的位置</span>
    <span class="token comment" spellcheck="true">// String filePath = ProjectConstant.IMAGE_USER_FACE_LOCATION;</span>
    String filePath <span class="token operator">=</span> fileUpload<span class="token punctuation">.</span><span class="token function">getImageUserFaceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 用户上传图像位置前缀，用于区分不同用户</span>
    String filePathPrefix <span class="token operator">=</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> userId<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 开始文件上传</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>multipartFile <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 获取上传的文件名</span>
        String filename <span class="token operator">=</span> multipartFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 文件重命名 imooc-face.png -> ["imooc-face","png"]</span>
        String<span class="token punctuation">[</span><span class="token punctuation">]</span> splitFileNameArr <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\\."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 获取文件的后缀名</span>
        String suffix <span class="token operator">=</span> splitFileNameArr<span class="token punctuation">[</span>splitFileNameArr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 校验后缀名是否合法，#### 1.4.2.1 上传头像 - 图片格式限制以防后门</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>suffix<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"png"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token operator">!</span>suffix<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"jpg"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token operator">!</span>suffix<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"图片格式不正确"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// 文件名重组 face-{userid}.png 覆盖式上传；增量式上传，可以再拼接当前时间作为文件名后缀</span>
        String newFileName <span class="token operator">=</span> userId <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> suffix<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 上传的图像保存的最终位置</span>
        String finalFilePath <span class="token operator">=</span> filePath <span class="token operator">+</span> filePathPrefix <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> newFileName<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 用于提供给web服务访问的地址</span>
        filePathPrefix <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">"/"</span> <span class="token operator">+</span> newFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        File outFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>finalFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>outFile<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 创建文件夹</span>
            outFile<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// 文件输出保存到目录</span>
        FileOutputStream outputStream <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>outFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            InputStream inputStream1 <span class="token operator">=</span> multipartFile<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            IOUtils<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>inputStream1<span class="token punctuation">,</span> outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>outputStream <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    outputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"文件不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// 获取图片服务地址</span>
    String imageServerUrlPrefix <span class="token operator">=</span> fileUpload<span class="token punctuation">.</span><span class="token function">getImageServerUrlPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String finalUserFaceUrl <span class="token operator">=</span> imageServerUrlPrefix <span class="token operator">+</span> filePathPrefix<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 由于浏览器cookie作用，在这里需要加上时间戳保证数据实时更新</span>
    finalUserFaceUrl <span class="token operator">+=</span> <span class="token string">"?t="</span> <span class="token operator">+</span> DateUtil<span class="token punctuation">.</span><span class="token function">getCurrentDateString</span><span class="token punctuation">(</span>DateUtil<span class="token punctuation">.</span>DATE_PATTERN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 更新用户头像到数据库</span>
    Users users <span class="token operator">=</span> userCenterService<span class="token punctuation">.</span><span class="token function">updateUserFace</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> finalUserFaceUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 覆盖cookie</span>
    users <span class="token operator">=</span> UsersUlits<span class="token punctuation">.</span><span class="token function">setUserProperty</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    CookieUtils<span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">,</span> JsonUtils<span class="token punctuation">.</span><span class="token function">objectToJson</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// TODO 后续要改，增加token，整合到Redis中，适应分布式</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-4-2-2-上传头像-大小限制，以及自定义捕获异常"><a href="#1-4-2-2-上传头像-大小限制，以及自定义捕获异常" class="headerlink" title="1.4.2.2 上传头像 - 大小限制，以及自定义捕获异常"></a>1.4.2.2 上传头像 - 大小限制，以及自定义捕获异常</h4><ol>
<li><p>在项目配置文件中添加限制</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring</span><span class="token punctuation">:</span> <span class="token attr-value"> </span>
<span class="token attr-name">  servlet</span><span class="token punctuation">:</span>
<span class="token attr-name">      multipart</span><span class="token punctuation">:</span>
<span class="token attr-name">        max-file-size</span><span class="token punctuation">:</span> <span class="token attr-value">512000             # 文件上传大小限制为500kb</span>
<span class="token attr-name">        max-request-size</span><span class="token punctuation">:</span> <span class="token attr-value">512000          # 请求大小限制为500kb</span></code></pre>
</li>
<li><p>新增统一异常处理类</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomExceptionHandler</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 上传文件超过500kb，捕获异常MaxUploadSizeExceededException</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>MaxUploadSizeExceededException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> MJHJSONResult <span class="token function">handlerMaxUploadFile</span><span class="token punctuation">(</span>MaxUploadSizeExceededException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"文件大小超过500k，请重新上传"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-4-3-订单管理-查询我的订单Sql"><a href="#1-4-3-订单管理-查询我的订单Sql" class="headerlink" title="1.4.3 订单管理 - 查询我的订单Sql"></a>1.4.3 订单管理 - 查询我的订单Sql</h3><ol>
<li><p>查询Sql</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>
  o<span class="token punctuation">.</span>id orderId<span class="token punctuation">,</span>
  o<span class="token punctuation">.</span><span class="token punctuation">`</span>created_time<span class="token punctuation">`</span> createdTime<span class="token punctuation">,</span>
  o<span class="token punctuation">.</span><span class="token punctuation">`</span>pay_method<span class="token punctuation">`</span> payMethod<span class="token punctuation">,</span>
  o<span class="token punctuation">.</span><span class="token punctuation">`</span>real_pay_amount<span class="token punctuation">`</span> realPayAmount<span class="token punctuation">,</span>
  o<span class="token punctuation">.</span><span class="token punctuation">`</span>post_amount<span class="token punctuation">`</span> postAmount<span class="token punctuation">,</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_status<span class="token punctuation">`</span> orderSatus<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_id<span class="token punctuation">`</span> itemId<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> itemName<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_img<span class="token punctuation">`</span> itemImg<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_spec_id<span class="token punctuation">`</span> itemSpecId<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_spec_name<span class="token punctuation">`</span> itemSpecName<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>buy_counts<span class="token punctuation">`</span> buyCounts<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>price<span class="token punctuation">`</span> price
<span class="token keyword">from</span>
  orders o
  <span class="token keyword">left</span> <span class="token keyword">join</span> order_status os
    <span class="token keyword">on</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span>
  <span class="token keyword">left</span> <span class="token keyword">join</span> order_items oi
    <span class="token keyword">on</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> oi<span class="token punctuation">.</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span>
<span class="token keyword">where</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'210530G4H291FYY8'</span>
  <span class="token operator">and</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>is_delete<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>updated_time<span class="token punctuation">`</span> <span class="token keyword">asc</span></code></pre>
</li>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 查询用户订单列表</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> PagedGridResult <span class="token function">queryUserOrders</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> Integer orderStatus<span class="token punctuation">,</span> Integer page<span class="token punctuation">,</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 封装查询参数</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>orderStatus <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"orderStatus"</span><span class="token punctuation">,</span> orderStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// 分页开始</span>
    PageHelper<span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 获取当前用户的所有订单信息</span>
    List<span class="token operator">&lt;</span>UserOrdersVO<span class="token operator">></span> userOrders <span class="token operator">=</span> ordersMapperCustom<span class="token punctuation">.</span><span class="token function">queryUserOrders</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 返回分页结果</span>
    <span class="token keyword">return</span> PagedGridUtils<span class="token punctuation">.</span><span class="token function">getPagedGrid</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> userOrders<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 模拟商家发货接口，修改订单状态为已发货</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateDeliverOrderStatus</span><span class="token punctuation">(</span>String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    OrderStatus orderStatus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatus<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span>OrderStatusEnum<span class="token punctuation">.</span>WAIT_RECEIVE<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatus<span class="token punctuation">.</span><span class="token function">setDeliverTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Example example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>OrderStatus<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Example<span class="token punctuation">.</span>Criteria criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"orderId"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"orderStatus"</span><span class="token punctuation">,</span> OrderStatusEnum<span class="token punctuation">.</span>WAIT_DELIVER<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatusMapper<span class="token punctuation">.</span><span class="token function">updateByExampleSelective</span><span class="token punctuation">(</span>orderStatus<span class="token punctuation">,</span> example<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 查询用户订单</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> Orders <span class="token function">queryUserOrder</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Orders orders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Orders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orders<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orders<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orders<span class="token punctuation">.</span><span class="token function">setIsDelete</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>NO<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ordersMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>orders<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 确认收货</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> Boolean <span class="token function">updateReceiveOrderStatus</span><span class="token punctuation">(</span>String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    OrderStatus orderStatus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatus<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span>OrderStatusEnum<span class="token punctuation">.</span>SUCCESS<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatus<span class="token punctuation">.</span><span class="token function">setSuccessTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Example example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>OrderStatus<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Example<span class="token punctuation">.</span>Criteria criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"orderId"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"orderStatus"</span><span class="token punctuation">,</span> OrderStatusEnum<span class="token punctuation">.</span>WAIT_RECEIVE<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> flag <span class="token operator">=</span> orderStatusMapper<span class="token punctuation">.</span><span class="token function">updateByExampleSelective</span><span class="token punctuation">(</span>orderStatus<span class="token punctuation">,</span> example<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 删除订单</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> Boolean <span class="token function">deleteReceiveOrderStatus</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Orders order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Orders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setIsDelete</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>YES<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setUpdatedTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Example example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>Orders<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Example<span class="token punctuation">.</span>Criteria criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> flag <span class="token operator">=</span> ordersMapper<span class="token punctuation">.</span><span class="token function">updateByExampleSelective</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> example<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询用户订单列表详情"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询用户订单列表详情"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/query"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getUserOrdersDetails</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"orderStatus"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"订单状态"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer orderStatus<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"当前页数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer page<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"pageSize"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"每页显示记录数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 为page和pageSize赋初值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> null <span class="token operator">||</span> pageSize <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>PAGE_NUMBER<span class="token punctuation">;</span>
        pageSize <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>COMMON_PAGE_SIZE_COUNTS<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    PagedGridResult gridResult <span class="token operator">=</span> userOrdersService<span class="token punctuation">.</span><span class="token function">queryUserOrders</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> orderStatus<span class="token punctuation">,</span> page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>gridResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 模拟商家发货的后端接口</span>
<span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"商家发货"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"商家发货接口"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/deliver"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">updateDeliverOrderStatus</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"orderId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"订单Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"订单ID不能为null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    userOrdersService<span class="token punctuation">.</span><span class="token function">updateDeliverOrderStatus</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 用户确认收货</span>
<span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户确认收货"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户确认收货接口"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/confirmReceive"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">confirmReceive</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"orderId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"订单Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String orderId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MJHJSONResult result <span class="token operator">=</span> <span class="token function">checkUserOrder</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> HttpStatus<span class="token punctuation">.</span>OK<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Boolean flag <span class="token operator">=</span> userOrdersService<span class="token punctuation">.</span><span class="token function">updateReceiveOrderStatus</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"确认收货失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 用户删除订单</span>
<span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"用户删除订单"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"用户删除订单接口"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">deleteUserOrder</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"orderId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"订单Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String orderId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MJHJSONResult result <span class="token operator">=</span> <span class="token function">checkUserOrder</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> HttpStatus<span class="token punctuation">.</span>OK<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Boolean flag <span class="token operator">=</span> userOrdersService<span class="token punctuation">.</span><span class="token function">deleteReceiveOrderStatus</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"删除订单失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * @return com.mjh.utils.MJHJSONResult
 * @Description // 验证用户和订单之间的关系是否存在，有关系就返回ok
 * @Date 15:44 2022/1/23
 * @Param [userId, orderId]
 **/</span>
<span class="token keyword">private</span> MJHJSONResult <span class="token function">checkUserOrder</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Orders order <span class="token operator">=</span> userOrdersService<span class="token punctuation">.</span><span class="token function">queryUserOrder</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"订单不存在"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h4 id="1-4-3-1-订单管理-嵌套查询分页Bug解决方案"><a href="#1-4-3-1-订单管理-嵌套查询分页Bug解决方案" class="headerlink" title="1.4.3.1 订单管理 - 嵌套查询分页Bug解决方案"></a>1.4.3.1 订单管理 - 嵌套查询分页Bug解决方案</h4><ol>
<li><p>采用上面的sql进行查询会查到冗余数据，导致页面分页异常</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 使用两次查询sql来替代上面的一次查询语句</span>
<span class="token comment" spellcheck="true">-- 先查订单状态表和</span>
<span class="token keyword">select</span>
  o<span class="token punctuation">.</span>id orderId<span class="token punctuation">,</span>
  o<span class="token punctuation">.</span><span class="token punctuation">`</span>created_time<span class="token punctuation">`</span> createdTime<span class="token punctuation">,</span>
  o<span class="token punctuation">.</span><span class="token punctuation">`</span>pay_method<span class="token punctuation">`</span> payMethod<span class="token punctuation">,</span>
  o<span class="token punctuation">.</span><span class="token punctuation">`</span>real_pay_amount<span class="token punctuation">`</span> realPayAmount<span class="token punctuation">,</span>
  o<span class="token punctuation">.</span><span class="token punctuation">`</span>post_amount<span class="token punctuation">`</span> postAmount<span class="token punctuation">,</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_status<span class="token punctuation">`</span> orderSatus<span class="token punctuation">,</span>
<span class="token keyword">from</span>
  orders o
  <span class="token keyword">left</span> <span class="token keyword">join</span> order_status os
    <span class="token keyword">on</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span>
<span class="token keyword">where</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'210530G4H291FYY8'</span>
  <span class="token operator">and</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>is_delete<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>updated_time<span class="token punctuation">`</span> <span class="token keyword">asc</span>

<span class="token comment" spellcheck="true">-- 单独查询订单项表</span>
<span class="token keyword">select</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_id<span class="token punctuation">`</span> itemId<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> itemName<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_img<span class="token punctuation">`</span> itemImg<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_spec_id<span class="token punctuation">`</span> itemSpecId<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>item_spec_name<span class="token punctuation">`</span> itemSpecName<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>buy_counts<span class="token punctuation">`</span> buyCounts<span class="token punctuation">,</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>price<span class="token punctuation">`</span> price
<span class="token keyword">from</span>
  order_items oi
<span class="token keyword">where</span>
  oi<span class="token punctuation">.</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'2201227936ZS7P4H'</span></code></pre>
</li>
<li><p>重新编写数据访问层映射</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userOrdersVO<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.pojo.vo.UserOrdersVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>orderId<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>orderId<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>createdTime<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>createdTime<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>payMethod<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>payMethod<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>realPayAmount<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>realPayAmount<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postAmount<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postAmount<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>orderStatus<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>orderStatus<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    &lt;collection property="subOrderItemList"
                select="getSubItems" <span class="token comment" spellcheck="true">&lt;!--这里就是子查询的id名--></span>
                column="orderId"     <span class="token comment" spellcheck="true">&lt;!--这个就是父查询的结果id，根据这个id再去查找对应的子订单信息--></span>
                ofType="com.mjh.pojo.vo.UserSubOrderItemVO">
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemId<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemId<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemName<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemName<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemImg<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemImg<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemSpecId<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemSpecId<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemSpecName<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemSpecName<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>buyCounts<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>buyCounts<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>price<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>price<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>queryUserOrders<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userOrdersVO<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    select
      o.id orderId,
      o.`created_time` createdTime,
      o.`pay_method` payMethod,
      o.`real_pay_amount` realPayAmount,
      o.`post_amount` postAmount,
      os.`order_status` orderStatus
    from
      orders o
    left join order_status os
      on o.`id` = os.`order_id`
    where o.`user_id` = #{paramsMap.userId}
      and o.`is_delete` = 0
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paramsMap.orderStatus !<span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        and os.order_status = #{paramsMap.orderStatus}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>
      order by o.`updated_time` asc
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>getSubItems<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mjh.pojo.vo.UserSubOrderItemVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    select
      oi.`item_id` itemId,
      oi.`item_name` itemName,
      oi.`item_img` itemImg,
      oi.`item_spec_id` itemSpecId,
      oi.`item_spec_name` itemSpecName,
      oi.`buy_counts` buyCounts,
      oi.`price` price
    from
      order_items oi
    where
      oi.`order_id` = #{orderId}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre>
</li>
</ol>
<h3 id="1-4-4-评价管理-评价需求分析"><a href="#1-4-4-评价管理-评价需求分析" class="headerlink" title="1.4.4 评价管理 - 评价需求分析"></a>1.4.4 评价管理 - 评价需求分析</h3><ol>
<li><p>需求分析</p>
<ol>
<li>实现发表评论功能</li>
<li>分页实现已评论内容查询</li>
</ol>
</li>
<li><p>sql编写</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 添加评论信息</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> 
  items_comments
    <span class="token punctuation">(</span>
      id<span class="token punctuation">,</span>
      user_id<span class="token punctuation">,</span>
      item_id<span class="token punctuation">,</span>
      item_name<span class="token punctuation">,</span>
      item_spec_id<span class="token punctuation">,</span>
      spec_name<span class="token punctuation">,</span>
      comment_level<span class="token punctuation">,</span>
      content<span class="token punctuation">,</span>
      created_time<span class="token punctuation">,</span>
      updated_time
    <span class="token punctuation">)</span>
<span class="token keyword">values</span>
  <span class="token punctuation">(</span>
      <span class="token comment" spellcheck="true">#{item.commentId},</span>
      <span class="token comment" spellcheck="true">#{userId},</span>
      <span class="token comment" spellcheck="true">#{item.itemId},</span>
      <span class="token comment" spellcheck="true">#{item.itemName},</span>
      <span class="token comment" spellcheck="true">#{item.itemSpecId},</span>
      <span class="token comment" spellcheck="true">#{item.itemSpecName},</span>
      <span class="token comment" spellcheck="true">#{item.commentLevel},</span>
      <span class="token comment" spellcheck="true">#{item.content},</span>
      <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">-- 查询商品评论列表</span>
<span class="token keyword">select</span>
    ic<span class="token punctuation">.</span>id orderId<span class="token punctuation">,</span>
    ic<span class="token punctuation">.</span><span class="token punctuation">`</span>content<span class="token punctuation">`</span> content<span class="token punctuation">,</span>
    ic<span class="token punctuation">.</span><span class="token punctuation">`</span>created_time<span class="token punctuation">`</span> createdTime<span class="token punctuation">,</span>
    ic<span class="token punctuation">.</span><span class="token punctuation">`</span>item_id<span class="token punctuation">`</span> itemId<span class="token punctuation">,</span>
    ic<span class="token punctuation">.</span><span class="token punctuation">`</span>item_name<span class="token punctuation">`</span> itemName<span class="token punctuation">,</span>
    ic<span class="token punctuation">.</span><span class="token punctuation">`</span>spec_name<span class="token punctuation">`</span> specName<span class="token punctuation">,</span>
    ii<span class="token punctuation">.</span><span class="token punctuation">`</span>url<span class="token punctuation">`</span> itemImg
<span class="token keyword">from</span>
    items_comments ic
<span class="token keyword">left</span> <span class="token keyword">join</span> items_img ii
<span class="token keyword">on</span> ic<span class="token punctuation">.</span><span class="token punctuation">`</span>item_id<span class="token punctuation">`</span> <span class="token operator">=</span> ii<span class="token punctuation">.</span><span class="token punctuation">`</span>item_id<span class="token punctuation">`</span>
<span class="token keyword">where</span> ic<span class="token punctuation">.</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token comment" spellcheck="true">#{paramsMap.userId}</span>
<span class="token operator">and</span> ii<span class="token punctuation">.</span><span class="token punctuation">`</span>is_main<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> ic<span class="token punctuation">.</span><span class="token punctuation">`</span>created_time<span class="token punctuation">`</span> <span class="token keyword">desc</span></code></pre>
</li>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 根据订单Id查询关联的商品</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>OrderItems<span class="token operator">></span> <span class="token function">queryPendingComments</span><span class="token punctuation">(</span>String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    OrderItems orderItems <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderItems<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> orderItemsMapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>orderItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 保存用户的评论</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveComments</span><span class="token punctuation">(</span>String orderId<span class="token punctuation">,</span> String userId<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>OrderItemsCommentBO<span class="token operator">></span> itemsCommentBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1. 保存评价到items_comments表中</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>OrderItemsCommentBO commentBO <span class="token operator">:</span> itemsCommentBO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        commentBO<span class="token punctuation">.</span><span class="token function">setCommentId</span><span class="token punctuation">(</span>sid<span class="token punctuation">.</span><span class="token function">nextShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"commentList"</span><span class="token punctuation">,</span> itemsCommentBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    itemsCommentsMapperCustom<span class="token punctuation">.</span><span class="token function">saveComments</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 2. 修改订单状态为已评价</span>
    Orders orders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Orders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orders<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orders<span class="token punctuation">.</span><span class="token function">setIsComment</span><span class="token punctuation">(</span>YesOrNo<span class="token punctuation">.</span>YES<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ordersMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>orders<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 3. 修改订单状态表的留言时间</span>
    OrderStatus orderStatus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatus<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatus<span class="token punctuation">.</span><span class="token function">setCommentTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderStatusMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>orderStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 查询用户评价，分页</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> PagedGridResult <span class="token function">queryUserComments</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> Integer page<span class="token punctuation">,</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    PageHelper<span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>UserCommentVO<span class="token operator">></span> commentVOS <span class="token operator">=</span> itemsCommentsMapperCustom<span class="token punctuation">.</span><span class="token function">queryUserComments</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> PagedGridUtils<span class="token punctuation">.</span><span class="token function">getPagedGrid</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> commentVOS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询用户中心评价详情"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询用户中心评价详情"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/pending"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">getUserCommentsDetails</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"orderId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"订单状态"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 校验用户和订单的关系</span>
    MJHJSONResult result <span class="token operator">=</span> <span class="token function">checkUserOrder</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> HttpStatus<span class="token punctuation">.</span>OK<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// 如果订单已经评价就提示已评价过了</span>
    Orders order <span class="token operator">=</span> <span class="token punctuation">(</span>Orders<span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getIsComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> YesOrNo<span class="token punctuation">.</span>YES<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"该订单已经评价过"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// 没有评价则访问数据库修改评论状态</span>
    List<span class="token operator">&lt;</span>OrderItems<span class="token operator">></span> orderItems <span class="token operator">=</span> userCommentsService<span class="token punctuation">.</span><span class="token function">queryPendingComments</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>orderItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"保存用户中心评价详情"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"保存用户中心评价详情"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/saveList"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">saveCommentsList</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"orderId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"订单状态"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String orderId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@RequestBody</span> List<span class="token operator">&lt;</span>OrderItemsCommentBO<span class="token operator">></span> itemsCommentBOS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 校验用户和订单的关系</span>
    MJHJSONResult result <span class="token operator">=</span> <span class="token function">checkUserOrder</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> HttpStatus<span class="token punctuation">.</span>OK<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 评论内容校验</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>itemsCommentBOS <span class="token operator">==</span> null <span class="token operator">||</span> itemsCommentBOS<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"评论内容不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 保存评论内容</span>
    userCommentsService<span class="token punctuation">.</span><span class="token function">saveComments</span><span class="token punctuation">(</span>orderId<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> itemsCommentBOS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询用户评价列表详情"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询用户评价列表详情"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/query"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">queryCommentsList</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"当前页数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer page<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"pageSize"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"每页显示记录数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 为page和pageSize赋初值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> null <span class="token operator">||</span> pageSize <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>PAGE_NUMBER<span class="token punctuation">;</span>
        pageSize <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>COMMON_PAGE_SIZE_COUNTS<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    PagedGridResult pagedGridResult <span class="token operator">=</span> userCommentsService<span class="token punctuation">.</span><span class="token function">queryUserComments</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>pagedGridResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> MJHJSONResult <span class="token function">checkUserOrder</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> String orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Orders order <span class="token operator">=</span> userOrdersService<span class="token punctuation">.</span><span class="token function">queryUserOrder</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"订单不存在"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h3 id="1-4-5-中心首页-订单状态"><a href="#1-4-5-中心首页-订单状态" class="headerlink" title="1.4.5 中心首页 - 订单状态"></a>1.4.5 中心首页 - 订单状态</h3><ol>
<li><p>编写查询sql</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 查询订单记录数sql</span>
<span class="token keyword">select</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">from</span>
  orders o
  <span class="token keyword">left</span> <span class="token keyword">join</span> order_status os
    <span class="token keyword">on</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span>
<span class="token keyword">where</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'210530G4H291FYY8'</span>
  <span class="token operator">and</span> os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_status<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">10</span>
  <span class="token operator">and</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>is_comment<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">-- 查询订单状态分页sql</span>
<span class="token keyword">select</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span> orderId<span class="token punctuation">,</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_status<span class="token punctuation">`</span> orderStatus<span class="token punctuation">,</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>created_time<span class="token punctuation">`</span> createdTime<span class="token punctuation">,</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span> payTime<span class="token punctuation">,</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>deliver_time<span class="token punctuation">`</span> deliverTime<span class="token punctuation">,</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>success_time<span class="token punctuation">`</span> successTime<span class="token punctuation">,</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>close_time<span class="token punctuation">`</span> closeTime<span class="token punctuation">,</span>
  os<span class="token punctuation">.</span><span class="token punctuation">`</span>comment_time<span class="token punctuation">`</span> commentTime
<span class="token keyword">from</span>
  orders o
  <span class="token keyword">left</span> <span class="token keyword">join</span> order_status os
    <span class="token keyword">on</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span>
<span class="token keyword">where</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>is_delete<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token operator">and</span> o<span class="token punctuation">.</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'210530G4H291FYY8'</span>
  <span class="token operator">and</span> os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_status<span class="token punctuation">`</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> os<span class="token punctuation">.</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span> <span class="token keyword">desc</span></code></pre>
</li>
<li><p>编写业务逻辑层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 查询用户订单数</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> OrderStatusCountsVO <span class="token function">queryOrderStatusCounts</span><span class="token punctuation">(</span>String userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 封装查询参数</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"orderStatus"</span><span class="token punctuation">,</span> OrderStatusEnum<span class="token punctuation">.</span>WAIT_PAY<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> waitPayStatusCounts <span class="token operator">=</span> ordersMapperCustom<span class="token punctuation">.</span><span class="token function">queryUserOrdersStatusCounts</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"orderStatus"</span><span class="token punctuation">,</span> OrderStatusEnum<span class="token punctuation">.</span>WAIT_DELIVER<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> waitDeliverStatusCounts <span class="token operator">=</span> ordersMapperCustom<span class="token punctuation">.</span><span class="token function">queryUserOrdersStatusCounts</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"orderStatus"</span><span class="token punctuation">,</span> OrderStatusEnum<span class="token punctuation">.</span>WAIT_RECEIVE<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> waitReceiveStatusCounts <span class="token operator">=</span> ordersMapperCustom<span class="token punctuation">.</span><span class="token function">queryUserOrdersStatusCounts</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"orderStatus"</span><span class="token punctuation">,</span> OrderStatusEnum<span class="token punctuation">.</span>SUCCESS<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"isComment"</span><span class="token punctuation">,</span> YesOrNo<span class="token punctuation">.</span>NO<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> waitCommentStatusCounts <span class="token operator">=</span> ordersMapperCustom<span class="token punctuation">.</span><span class="token function">queryUserOrdersStatusCounts</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    OrderStatusCountsVO statusCountsVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStatusCountsVO</span><span class="token punctuation">(</span>
        waitPayStatusCounts<span class="token punctuation">,</span> waitDeliverStatusCounts<span class="token punctuation">,</span> waitReceiveStatusCounts<span class="token punctuation">,</span> waitCommentStatusCounts
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> statusCountsVO<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 查询用户订单动向，分页实现</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
<span class="token keyword">public</span> PagedGridResult <span class="token function">queryUserOrdersTrend</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> Integer page<span class="token punctuation">,</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 封装查询参数</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 分页开始</span>
    PageHelper<span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 获取当前用户的所有订单信息</span>
    List<span class="token operator">&lt;</span>OrderStatus<span class="token operator">></span> orderStatuses <span class="token operator">=</span> ordersMapperCustom<span class="token punctuation">.</span><span class="token function">queryUserOrdersTrend</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 返回分页结果</span>
    <span class="token keyword">return</span> PagedGridUtils<span class="token punctuation">.</span><span class="token function">getPagedGrid</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> orderStatuses<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>编写视图展示层</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 查询用户订单状态数</span>
<span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询用户订单状态数"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询用户订单状态数接口"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/statusCounts"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">queryStatusCounts</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">"用户id不能为null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    OrderStatusCountsVO statusCounts <span class="token operator">=</span> userOrdersService<span class="token punctuation">.</span><span class="token function">queryOrderStatusCounts</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>statusCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 用于为当前方法生成API文档注释</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询用户订单动向"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"查询用户订单动向"</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/trend"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> MJHJSONResult <span class="token function">queryUserOrdersTrend</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userId"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"用户Id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> String userId<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"当前页数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer page<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"pageSize"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"每页显示记录数"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestParam</span> Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 为page和pageSize赋初值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> null <span class="token operator">||</span> pageSize <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>PAGE_NUMBER<span class="token punctuation">;</span>
        pageSize <span class="token operator">=</span> ProjectConstant<span class="token punctuation">.</span>COMMON_PAGE_SIZE_COUNTS<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    PagedGridResult gridResult <span class="token operator">=</span> userOrdersService<span class="token punctuation">.</span><span class="token function">queryUserOrdersTrend</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MJHJSONResult<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>gridResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ol>
<h2 id="1-5-项目上线部署"><a href="#1-5-项目上线部署" class="headerlink" title="1.5 项目上线部署"></a>1.5 项目上线部署</h2><h3 id="1-5-1-云服务器购买及安装配置-JDK-Tomcat-MariaDB"><a href="#1-5-1-云服务器购买及安装配置-JDK-Tomcat-MariaDB" class="headerlink" title="1.5.1 云服务器购买及安装配置(JDK/Tomcat/MariaDB)"></a>1.5.1 云服务器购买及安装配置(JDK/Tomcat/MariaDB)</h3><h3 id="1-5-2-SpringBoot多环境部署profile-开发环境-生产环境"><a href="#1-5-2-SpringBoot多环境部署profile-开发环境-生产环境" class="headerlink" title="1.5.2 SpringBoot多环境部署profile(开发环境/生产环境)"></a>1.5.2 SpringBoot多环境部署profile(开发环境/生产环境)</h3><h3 id="1-5-3-SpringBoot项目打成war并发布到云服务器"><a href="#1-5-3-SpringBoot项目打成war并发布到云服务器" class="headerlink" title="1.5.3 SpringBoot项目打成war并发布到云服务器"></a>1.5.3 SpringBoot项目打成war并发布到云服务器</h3><h3 id="1-5-4-前端项目发布"><a href="#1-5-4-前端项目发布" class="headerlink" title="1.5.4 前端项目发布"></a>1.5.4 前端项目发布</h3><h3 id="1-5-5-解决Cookie异常，测试订单支付流程"><a href="#1-5-5-解决Cookie异常，测试订单支付流程" class="headerlink" title="1.5.5 解决Cookie异常，测试订单支付流程"></a>1.5.5 解决Cookie异常，测试订单支付流程</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">mjh</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://codeofmjh.github.com/2022/01/09/1-mkjavaprojectnotes-one/">https://codeofmjh.github.com/2022/01/09/1-mkjavaprojectnotes-one/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://codeOfMjh.github.com" target="_blank">No weal without woe!</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/01/09/1-mkjavaprojectnotes-two/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">集群式高可用</div></div></a></div><div class="next-post pull-right"><a href="/2022/01/07/zi-liao-bao/5.zhong-jian-jian/js-kua-yu-jie-jue-fang-an/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mjh</div><div class="author-info__description">这个人很懒</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2"><span class="toc-number">1.</span> <span class="toc-text">单体项目开发部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 项目基础搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-1-%E5%A4%A7%E5%9E%8B%E4%BA%92%E8%81%94%E7%BD%91%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E6%BC%94%E5%8F%98%E5%8E%86%E7%A8%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1.1 大型互联网系统架构演变历程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-2-%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%9A%84%E4%B9%9D%E5%A4%A7%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.1.2 大型网站的九大特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-3-%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E5%8F%98%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.1.3 大型网站演变进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-4-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.1.4 负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-5-Java%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9C%80%E8%A6%81%E5%85%B7%E5%A4%87%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B8%8E%E8%83%BD%E5%8A%9B"><span class="toc-number">1.1.5.</span> <span class="toc-text">1.1.5 Java架构师需要具备的技术栈与能力</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-6-%E9%A1%B9%E7%9B%AE%E6%BC%94%E7%A4%BA%E4%B8%8E%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">1.1.6.</span> <span class="toc-text">1.1.6  项目演示与单体架构技术选型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-7-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%A1%B9%E7%9B%AE%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.1.7.</span> <span class="toc-text">1.1.7  前后端分离开发模式与项目分层设计原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-8-SpringBoot%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.8.</span> <span class="toc-text">1.1.8  SpringBoot项目配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-9-%E6%95%B4%E5%90%88HikariCP%E4%B8%8EMyBatis"><span class="toc-number">1.1.9.</span> <span class="toc-text">1.1.9 整合HikariCP与MyBatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-10-%E7%BB%93%E5%90%88%E9%80%9A%E7%94%A8Mapper%EF%BC%8C%E7%BC%96%E5%86%99Restful%E9%A3%8E%E6%A0%BCApi"><span class="toc-number">1.1.10.</span> <span class="toc-text">1.1.10 结合通用Mapper，编写Restful风格Api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-11-%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.1.11.</span> <span class="toc-text">1.1.11 事务传播详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-12-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C-%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="toc-number">1.1.12.</span> <span class="toc-text">1.1.12 用户注册&#x2F;登录流程详解与功能开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-13-%E6%95%B4%E5%90%88%E4%B8%8E%E4%BC%98%E5%8C%96Swagger2%E6%96%87%E6%A1%A3Api"><span class="toc-number">1.1.13.</span> <span class="toc-text">1.1.13 整合与优化Swagger2文档Api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-14-API%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7Swagger2"><span class="toc-number">1.1.14.</span> <span class="toc-text">1.1.14 API文档生成工具Swagger2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-15-%E8%AE%BE%E7%BD%AE%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83"><span class="toc-number">1.1.15.</span> <span class="toc-text">1.1.15 设置跨域配置实现前后端联调</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-16-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.1.16.</span> <span class="toc-text">1.1.16 用户登录实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-17-Cookie%E5%92%8CSession"><span class="toc-number">1.1.17.</span> <span class="toc-text">1.1.17 Cookie和Session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-18-%E6%95%B4%E5%90%88Log4j%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97"><span class="toc-number">1.1.18.</span> <span class="toc-text">1.1.18 整合Log4j打印日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-19-%E9%80%9A%E8%BF%87%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7Service%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.19.</span> <span class="toc-text">1.1.19 通过日志监控Service执行时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-20-%E7%94%A8%E6%88%B7%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E6%B8%85%E7%A9%BACookie"><span class="toc-number">1.1.20.</span> <span class="toc-text">1.1.20 用户退出登录清空Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-21-%E5%BC%80%E5%90%AFMyBatis%E6%97%A5%E5%BF%97Sql%E6%89%93%E5%8D%B0"><span class="toc-number">1.1.21.</span> <span class="toc-text">1.1.21 开启MyBatis日志Sql打印</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%E6%90%9C%E7%B4%A2%E8%B4%AD%E7%89%A9%E8%BD%A6%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 商品分类搜索购物车模块实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E7%94%B5%E5%95%86%E9%A6%96%E9%A1%B5%E8%BD%AE%E6%92%AD%E5%9B%BE%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 电商首页轮播图功能开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-%E9%A6%96%E9%A1%B5%E5%88%86%E7%B1%BB%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 首页分类需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-1-%E5%88%86%E7%B1%BB%E5%AE%9E%E7%8E%B0-%E5%8A%A0%E8%BD%BD%E4%B8%8E%E6%B8%B2%E6%9F%93%E5%A4%A7%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">1.2.2.1 分类实现 - 加载与渲染大分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-2-%E5%88%86%E7%B1%BB%E5%AE%9E%E7%8E%B0-%E8%87%AA%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2%E5%AD%90%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">1.2.2.2 分类实现 - 自连接查询子分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-3-%E5%88%86%E7%B1%BB%E5%AE%9E%E7%8E%B0-%E8%87%AA%E5%AE%9A%E4%B9%89Mapper%E5%AE%9E%E7%8E%B0%E6%87%92%E5%8A%A0%E8%BD%BD%E5%AD%90%E5%88%86%E7%B1%BB%E5%B1%95%E7%A4%BA"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">1.2.2.3 分类实现 - 自定义Mapper实现懒加载子分类展示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-%E5%95%86%E5%93%81%E6%8E%A8%E8%8D%90-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8ESql%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 商品推荐 - 需求分析与Sql查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-1-%E5%95%86%E5%93%81%E6%8E%A8%E8%8D%90%E5%AE%9E%E7%8E%B0%E4%B8%8E%E8%81%94%E8%B0%83"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">1.2.3.1 商品推荐实现与联调</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-2-%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E5%AE%9E%E7%8E%B0%E4%B8%8E%E8%81%94%E8%B0%83"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">1.2.3.2 商品详情实现与联调</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-%E5%95%86%E5%93%81%E8%AF%84%E4%BB%B7-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 商品评价 - 数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-1-%E5%95%86%E5%93%81%E8%AF%84%E4%BB%B7-%E8%AF%84%E8%AE%BA%E8%AF%A6%E6%83%85%E5%B1%95%E7%A4%BA"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">1.2.4.1 商品评价 - 评论详情展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-2-%E5%95%86%E5%93%81%E8%AF%84%E4%BB%B7-%E8%AF%84%E8%AE%BA%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">1.2.4.2 商品评价 - 评论分页实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-%E5%95%86%E5%93%81%E8%AF%84%E4%BB%B7-%E4%BF%A1%E6%81%AF%E8%84%B1%E6%95%8F"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5 商品评价 - 信息脱敏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-6-%E6%90%9C%E7%B4%A2%E5%95%86%E5%93%81-%E5%8A%9F%E8%83%BD%E8%AF%A6%E8%BF%B0%E4%B8%8ESql%E7%BC%96%E5%86%99"><span class="toc-number">1.2.6.</span> <span class="toc-text">1.2.6 搜索商品 - 功能详述与Sql编写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-6-1-%E6%90%9C%E7%B4%A2%E5%95%86%E5%93%81-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">1.2.6.1 搜索商品 - 商品搜索功能实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-6-2-%E6%90%9C%E7%B4%A2%E5%95%86%E5%93%81-%E5%89%8D%E7%AB%AF%E4%B8%9A%E5%8A%A1%E4%B8%8E%E5%88%86%E7%B1%BB%E6%90%9C%E7%B4%A2%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">1.2.6.2 搜索商品 - 前端业务与分类搜索查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-6-3-%E6%90%9C%E7%B4%A2%E5%95%86%E5%93%81-%E5%88%86%E7%B1%BB%E6%90%9C%E7%B4%A2%E5%95%86%E5%93%81%E6%9F%A5%E8%AF%A2%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">1.2.6.3 搜索商品 - 分类搜索商品查询实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-7-%E8%B4%AD%E7%89%A9%E8%BD%A6-%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%AD%98%E5%82%A8%E5%BD%A2%E5%BC%8F"><span class="toc-number">1.2.7.</span> <span class="toc-text">1.2.7 购物车 - 购物车存储形式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-7-1-%E8%B4%AD%E7%89%A9%E8%BD%A6-%E6%9C%AA%E7%99%BB%E5%BD%95%E5%B7%B2%E7%99%BB%E5%BD%95%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">1.2.7.1 购物车 - 未登录已登录加入购物车业务代码讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-7-2-%E8%B4%AD%E7%89%A9%E8%BD%A6-%E6%B8%B2%E6%9F%93-%E5%88%B7%E6%96%B0-%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">1.2.7.2 购物车 - 渲染(刷新)购物车</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-7-3-%E8%B4%AD%E7%89%A9%E8%BD%A6-%E5%88%A0%E9%99%A4%E5%95%86%E5%93%81%E4%B8%9A%E5%8A%A1%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">1.2.7.3 购物车 - 删除商品业务讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-7-4-%E8%B4%AD%E7%89%A9%E8%BD%A6-%E7%BB%93%E7%AE%97%E5%95%86%E5%93%81%E4%B8%9A%E5%8A%A1%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.2.7.4.</span> <span class="toc-text">1.2.7.4 购物车 - 结算商品业务讲解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%AE%A2%E5%8D%95%EF%BC%8C%E6%94%AF%E4%BB%98%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 地址，订单，支付模块开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1 收货地址 - 需求分析与表设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-1-%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1.3.1.1 收货地址 - 增删改查功能开发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-2-%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E9%BB%98%E8%AE%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">1.3.1.2 收货地址 - 默认收货地址设置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-%E7%A1%AE%E8%AE%A4%E8%AE%A2%E5%8D%95-%E8%AE%A2%E5%8D%95%E6%B5%81%E7%A8%8B%E6%A2%B3%E7%90%86%E4%B8%8E%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2 确认订单 - 订单流程梳理与订单状态</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-1-%E7%A1%AE%E8%AE%A4%E8%AE%A2%E5%8D%95-%E8%AE%A2%E5%8D%95%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">1.3.2.1 确认订单 - 订单表设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-2-%E7%A1%AE%E8%AE%A4%E8%AE%A2%E5%8D%95-%E8%81%9A%E5%90%88%E6%94%AF%E4%BB%98%E4%B8%AD%E5%BF%83%E4%BD%9C%E7%94%A8"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">1.3.2.2 确认订单 - 聚合支付中心作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-3-%E7%A1%AE%E8%AE%A4%E8%AE%A2%E5%8D%95-%E6%8F%90%E4%BA%A4%E5%B9%B6%E4%B8%94%E6%8E%A5%E5%8F%97%E8%AE%A2%E5%8D%95%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">1.3.2.3 确认订单 - 提交并且接受订单信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3.3 创建订单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4-%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98"><span class="toc-number">1.3.4.</span> <span class="toc-text">1.3.4 订单支付</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-1-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">1.3.4.1 微信支付业务流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-2-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">1.3.4.2  微信支付实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-3-%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">1.3.4.3 支付宝支付业务流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-4-%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">1.3.4.4 支付宝支付实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-6-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1-%E5%AE%9A%E6%97%B6%E5%85%B3%E9%97%AD%E8%B6%85%E6%9C%9F%E6%9C%AA%E6%94%AF%E4%BB%98%E8%AE%A2%E5%8D%95"><span class="toc-number">1.3.5.</span> <span class="toc-text">1.3.6 定时任务 - 定时关闭超期未支付订单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-6-1-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%BC%8A%E7%AB%AF%E4%B8%8E%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">1.3.6.1 定时任务 - 定时任务弊端与优化方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83%EF%BC%8C%E8%AE%A2%E5%8D%95-%E8%AF%84%E4%BB%B7%E7%AE%A1%E7%90%86%E5%BC%80%E5%8F%91"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 用户中心，订单&#x2F;评价管理开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1-%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83-%E6%9F%A5%E8%AF%A2%EF%BC%8C%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.4.1 用户中心 - 查询，修改用户信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-1-1-%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83-%E4%BD%BF%E7%94%A8Hibernate%E9%AA%8C%E8%AF%81%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">1.4.1.1 用户中心 - 使用Hibernate验证用户信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2-%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F-%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.4.2 上传头像 - 定义文件保存位置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-2-2-%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F-%E5%A4%A7%E5%B0%8F%E9%99%90%E5%88%B6%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">1.4.2.2 上传头像 - 大小限制，以及自定义捕获异常</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-3-%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86-%E6%9F%A5%E8%AF%A2%E6%88%91%E7%9A%84%E8%AE%A2%E5%8D%95Sql"><span class="toc-number">1.4.3.</span> <span class="toc-text">1.4.3 订单管理 - 查询我的订单Sql</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-1-%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86-%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2%E5%88%86%E9%A1%B5Bug%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">1.4.3.1 订单管理 - 嵌套查询分页Bug解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-4-%E8%AF%84%E4%BB%B7%E7%AE%A1%E7%90%86-%E8%AF%84%E4%BB%B7%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.4.4.</span> <span class="toc-text">1.4.4 评价管理 - 评价需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-5-%E4%B8%AD%E5%BF%83%E9%A6%96%E9%A1%B5-%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81"><span class="toc-number">1.4.5.</span> <span class="toc-text">1.4.5 中心首页 - 订单状态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF%E9%83%A8%E7%BD%B2"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 项目上线部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-1-%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B4%AD%E4%B9%B0%E5%8F%8A%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-JDK-Tomcat-MariaDB"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.5.1 云服务器购买及安装配置(JDK&#x2F;Tomcat&#x2F;MariaDB)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-2-SpringBoot%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2profile-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83"><span class="toc-number">1.5.2.</span> <span class="toc-text">1.5.2 SpringBoot多环境部署profile(开发环境&#x2F;生产环境)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-3-SpringBoot%E9%A1%B9%E7%9B%AE%E6%89%93%E6%88%90war%E5%B9%B6%E5%8F%91%E5%B8%83%E5%88%B0%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.5.3.</span> <span class="toc-text">1.5.3 SpringBoot项目打成war并发布到云服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-4-%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%91%E5%B8%83"><span class="toc-number">1.5.4.</span> <span class="toc-text">1.5.4 前端项目发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-5-%E8%A7%A3%E5%86%B3Cookie%E5%BC%82%E5%B8%B8%EF%BC%8C%E6%B5%8B%E8%AF%95%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98%E6%B5%81%E7%A8%8B"><span class="toc-number">1.5.5.</span> <span class="toc-text">1.5.5 解决Cookie异常，测试订单支付流程</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/01/09/1-mkjavaprojectnotes-five/" title="容器化—docker&amp;K8S"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="容器化—docker&amp;K8S"/></a><div class="content"><a class="title" href="/2022/01/09/1-mkjavaprojectnotes-five/" title="容器化—docker&amp;K8S">容器化—docker&amp;K8S</a><time datetime="2022-01-09T03:24:37.000Z" title="发表于 2022-01-09 11:24:37">2022-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/09/1-mkjavaprojectnotes-four/" title="基于SpringCloud改造微服务"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于SpringCloud改造微服务"/></a><div class="content"><a class="title" href="/2022/01/09/1-mkjavaprojectnotes-four/" title="基于SpringCloud改造微服务">基于SpringCloud改造微服务</a><time datetime="2022-01-09T03:24:37.000Z" title="发表于 2022-01-09 11:24:37">2022-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/09/1-mkjavaprojectnotes-six/" title="网络通信和性能调优"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网络通信和性能调优"/></a><div class="content"><a class="title" href="/2022/01/09/1-mkjavaprojectnotes-six/" title="网络通信和性能调优">网络通信和性能调优</a><time datetime="2022-01-09T03:24:37.000Z" title="发表于 2022-01-09 11:24:37">2022-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/09/1-mkjavaprojectnotes-three/" title="分布式技术要点"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式技术要点"/></a><div class="content"><a class="title" href="/2022/01/09/1-mkjavaprojectnotes-three/" title="分布式技术要点">分布式技术要点</a><time datetime="2022-01-09T03:24:37.000Z" title="发表于 2022-01-09 11:24:37">2022-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/09/1-mkjavaprojectnotes-two/" title="集群式高可用"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="集群式高可用"/></a><div class="content"><a class="title" href="/2022/01/09/1-mkjavaprojectnotes-two/" title="集群式高可用">集群式高可用</a><time datetime="2022-01-09T03:24:37.000Z" title="发表于 2022-01-09 11:24:37">2022-01-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By mjh</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}i(),n.addEventListener("scroll",function(){var t,e;t=i,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>