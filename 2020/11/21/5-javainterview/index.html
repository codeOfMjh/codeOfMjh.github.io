<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="5.JavaInterview, HTML,CSS,JavaScript,JQuery,React,Vue.js">
    <meta name="description" content="С����·��">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>5.JavaInterview | No weal without woe!</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>
<meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">No weal without woe!</span>
                </a>
            </div>
            

<!-- 支持二级菜单特性  -->
<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right nav-menu">
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/" class="waves-effect waves-light">
              
                <i class="fa fas fa-home"></i>
              
              <span>首页</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/tags" class="waves-effect waves-light">
              
                <i class="fa fas fa-tags"></i>
              
              <span>标签</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
              <a href="/categories" class="waves-effect waves-light">
                
                  <i class="fa fas fa-bookmark"></i>
                
                <span>分类</span>
                <i class="fa fa-chevron-down" aria-hidden="true"></i>
              </a>

            <ul class="sub-nav menus_item_child ">
              
                <li> 
                  <a href="/categories/Java%E5%9F%BA%E7%A1%80" >
                    
                    <span>Java基础</span>
                  </a>
                </li>
              
                <li> 
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93" >
                    
                    <span>数据库基础</span>
                  </a>
                </li>
              
                <li> 
                  <a href="/categories/SSM%E6%A1%86%E6%9E%B6" >
                    
                    <span>SSM框架</span>
                  </a>
                </li>
              
                <li> 
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%BB%84%E4%BB%B6" >
                    
                    <span>分布式组件</span>
                  </a>
                </li>
              
                <li> 
                  <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E7%BD%91%E7%BB%9C" >
                    
                    <span>服务器网络相关</span>
                  </a>
                </li>
               
            </ul>
          
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/archives" class="waves-effect waves-light">
              
                <i class="fa fas fa-archive"></i>
              
              <span>归档</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/about" class="waves-effect waves-light">
              
                <i class="fa fas fa-user-circle"></i>
              
              <span>关于</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/contact" class="waves-effect waves-light">
              
                <i class="fa fas fa-comments"></i>
              
              <span>留言板</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/friends" class="waves-effect waves-light">
              
                <i class="fa fas fa-address-book"></i>
              
              <span>友情链接</span>
            </a>

            
      </li>
    

    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">No weal without woe!</div>
        <div class="logo-desc">
            
            С����·��
            
        </div>
    </div>

    

    <!-- 支持二级菜单特性 -->
	<ul class="menu-list mobile-menu-list">
		
			<li class="m-nav-item">
					
						<a href="/" class="waves-effect waves-light">
							
							<i class="fa fa-fw fas fa-home"></i>
							
							首页
						</a>
				
				</li>
			
			<li class="m-nav-item">
					
						<a href="/tags" class="waves-effect waves-light">
							
							<i class="fa fa-fw fas fa-tags"></i>
							
							标签
						</a>
				
				</li>
			
			<li class="m-nav-item">
					
						<a href="javascript:;">
								
								<i class="fa fa-fw fas fa-bookmark"></i>
								
								分类
								<span class="m-icon"><i class="fa fa-chevron-right"></i></span>
						</a>
					<ul>
					
						<li> 
						<a href="/categories/Java%E5%9F%BA%E7%A1%80" >
							
						<span>Java基础</span>
						</a>
						</li>
					
						<li> 
						<a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93" >
							
						<span>数据库基础</span>
						</a>
						</li>
					
						<li> 
						<a href="/categories/SSM%E6%A1%86%E6%9E%B6" >
							
						<span>SSM框架</span>
						</a>
						</li>
					
						<li> 
						<a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%BB%84%E4%BB%B6" >
							
						<span>分布式组件</span>
						</a>
						</li>
					
						<li> 
						<a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E7%BD%91%E7%BB%9C" >
							
						<span>服务器网络相关</span>
						</a>
						</li>
					 
					</ul>
				
				</li>
			
			<li class="m-nav-item">
					
						<a href="/archives" class="waves-effect waves-light">
							
							<i class="fa fa-fw fas fa-archive"></i>
							
							归档
						</a>
				
				</li>
			
			<li class="m-nav-item">
					
						<a href="/about" class="waves-effect waves-light">
							
							<i class="fa fa-fw fas fa-user-circle"></i>
							
							关于
						</a>
				
				</li>
			
			<li class="m-nav-item">
					
						<a href="/contact" class="waves-effect waves-light">
							
							<i class="fa fa-fw fas fa-comments"></i>
							
							留言板
						</a>
				
				</li>
			
			<li class="m-nav-item">
					
						<a href="/friends" class="waves-effect waves-light">
							
							<i class="fa fa-fw fas fa-address-book"></i>
							
							友情链接
						</a>
				
				</li>
			
	
			
	</ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/18.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">5.JavaInterview</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Java%E5%9F%BA%E7%A1%80/">
                                <span class="chip bg-color">Java基础</span>
                            </a>
                        
                            <a href="/tags/Java%E9%9D%A2%E8%AF%95/">
                                <span class="chip bg-color">Java面试</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E9%9D%A2%E8%AF%95/" class="post-category">
                                面试
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-11-21
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Java面试"><a href="#Java面试" class="headerlink" title="Java面试"></a>Java面试</h1><h2 id="1-Java基础"><a href="#1-Java基础" class="headerlink" title="1. Java基础"></a>1. Java基础</h2><ol>
<li>抽象类和接口的区别<ol>
<li>抽象类只能单继承，而接口可以多实现</li>
<li>接口的方法都是<code>public</code>修饰，而抽象类允许私有方法</li>
<li><code>jdk8</code>以前接口只能有抽象方法，而抽象类可以有普通和静态方法</li>
</ol>
</li>
<li><code>==</code>和<code>equals</code>的区别<ol>
<li><code>==</code>是值比较</li>
<li><code>equals</code>是比较对象内容是否相同</li>
<li>在比较自定义类是否相同需要重写<code>equals</code>方法，不然是值比较</li>
</ol>
</li>
<li><code>String</code><ol>
<li>由<code>final</code>修饰的不可改变的量</li>
<li><code>StingBuffer</code>：多线程环境下拼接效率高，有同步锁，所以线程安全</li>
<li><code>StringBuilder</code>：单线程环境下拼接效率高，没有同步锁，所以效率最高</li>
<li><code>new</code>字符串时首先会在常量池中找，没有就创建两个对象，一个在堆中，一个在常量池中；有就只在堆中创建一个对象</li>
</ol>
</li>
<li><code>final/finaly/finalize</code>区别<ol>
<li><code>final</code>修饰的量不可改变，修饰的方法不能重写，修饰的类不能被继承</li>
<li><code>finaly</code>是异常捕获用于兜底的操作，一般用于释放资源</li>
<li><code>finalize</code>是垃圾回收时，被回收对象调用执行的方法</li>
</ol>
</li>
<li><code>Servlet</code>生命周期<ol>
<li>初始化阶段，调用<code>init</code>方法</li>
<li>响应请求阶段，处理请求</li>
<li>终止销毁</li>
</ol>
</li>
<li><code>IO</code><ol>
<li><code>Block-IO</code><ol>
<li>字节流<ol>
<li><code>InputStream</code></li>
<li><code>OutputStream</code></li>
</ol>
</li>
<li>字符流<ol>
<li><code>Reader</code></li>
<li><code>Writer</code></li>
</ol>
</li>
<li>交互方式：同步阻塞式</li>
</ol>
</li>
<li><code>MonBlock-IO</code><ol>
<li>多路复用式的同步非阻塞式<code>IO</code></li>
<li>组成<ol>
<li><code>Channels</code><ol>
<li><code>FileChannel</code></li>
<li><code>DatagramChannel</code></li>
<li><code>SocketChannel</code></li>
<li><code>ServerSocketChannel</code></li>
</ol>
</li>
<li><code>Buffers</code><ol>
<li><code>ByteBuffer</code></li>
</ol>
</li>
<li><code>Selectors</code></li>
</ol>
</li>
<li><code>select</code>，<code>poll</code>，<code>epoll</code></li>
</ol>
</li>
<li><code>Asynchronous IO</code><ol>
<li>基于事件和回调机制的<code>IO</code></li>
<li>基于回调：实现<code>CompletionHandler</code>接口，调用时触发回调函数</li>
<li>返回<code>Future</code>：通过<code>isDone</code>方法检查是否准备好，通过<code>get</code>方法等待返回数据</li>
</ol>
</li>
<li>Netty</li>
</ol>
</li>
<li>异常<ol>
<li><code>Error</code>：程序无法处理的系统错误，编译器不做检查</li>
<li><code>Exception</code>：程序可以处理的异常，捕获后可能恢复<ol>
<li><code>!RuntimeException</code>：编译期异常，在编译时必须处理的异常</li>
<li><code>RuntimeException</code>：运行时异常</li>
</ol>
</li>
<li>抛出异常：创建异常对象交给运行时系统处理</li>
<li>捕获异常：寻找合适的异常处理器处理异常，否则终止运行</li>
<li><code>finally</code>优于<code>catch</code>块中的<code>return</code>执行，如果<code>finally</code>和<code>catch</code>都有<code>return</code>，则<code>catch</code>中的<code>return</code>会覆盖掉<code>finally</code>中的<code>return</code>值</li>
<li>异常处理规则<ol>
<li>具体明确：抛出的异常应能通过异常类名和<code>message</code>准说明异常的类型和异常产生的原因</li>
<li>提早抛出：尽可能早的发现并抛出异常，便于精确定位问题</li>
<li>延迟捕获：异常的捕获和处理尽可能的延迟，让掌握更多信息的作用域来处理异常</li>
</ol>
</li>
<li>异常梳理设计原则<ol>
<li>创建一个异常类继承自<code>RuntimeException</code>异常来统一处理</li>
<li>其余异常统一转为<code>AppException</code></li>
<li>在<code>catch</code>后，抛出自定义异常的子类，并提供足以定位的信息</li>
<li>由前端接收<code>AppException</code>做统一处理</li>
</ol>
</li>
<li>异常处理消耗性能的地方<ol>
<li><code>try-catch</code>块影响<code>JVM</code>优化</li>
<li>异常对象实例需要保存栈快照等信息，开销较大</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="2-Java集合-容器"><a href="#2-Java集合-容器" class="headerlink" title="2. Java集合(容器)"></a>2. Java集合(容器)</h2><ol>
<li><code>List</code>:<ol>
<li>特点<ol>
<li>有序可重复</li>
<li>可以通过索引值来操作元素</li>
</ol>
</li>
<li>实现类<ol>
<li><code>ArrayList</code><ol>
<li>底层是数组，利用数组的下标进行元素访问</li>
<li>初始大小为<font color="#FFFF00">10</font> ，扩容为原来的<font color="#FFFF00">0.5</font>倍，扩容是基于数组的复制，比较耗费内存</li>
<li>查询快，增删慢</li>
</ol>
</li>
<li><code>LinkedList</code><ol>
<li>底层是双向链表，链表存储指向前后节点的引用和元素</li>
<li>增删快，查询慢</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><code>Map</code><ol>
<li>特点<br>1. </li>
<li>实现类<ol>
<li><code>HashMap</code><ol>
<li>底层原理<ol>
<li>1.8之前底层是数组+链表，1.8之后是数组+链表+红黑树</li>
<li>链表的出现就是解决Hash值相同，由<code>HashCode</code>值决定存放的位置</li>
<li>链表转为红黑树—当数组长度大于<font color="#FFFF00">64</font>且链表长度大于<font color="#FFFF00">8</font>时会将链表转为红黑树</li>
<li>初始值为<font color="#FFFF00">16</font>，当负载因子达到<font color="#FFFF00">0.75</font>时，就会扩容为原来的<font color="#FFFF00">2</font>倍</li>
<li>一般用于单线程环境</li>
</ol>
</li>
<li><code>put</code>流程<ol>
<li>如果<code>HashMap</code>未被初始化，则先进行初始化</li>
<li>对<code>key</code>求<code>hash</code>值，然后通过<code>hashcode</code>方法计算下标值</li>
<li>如果没有<code>hash</code>碰撞，直接放入桶中</li>
<li>如果有<code>hash</code>碰撞，以链表的方式链接到后面</li>
<li>如果链表的长度超过<font color="#FFFF00">8</font>时，就把链表转为红黑树</li>
<li>如果链表的长度小于<font color="#FFFF00">6</font>时，就把红黑树转为链表</li>
<li>如果节点满了，则进行扩容，扩容为原来的<font color="#FFFF00">2</font>倍后进行重排</li>
</ol>
</li>
<li>减少<code>hash</code>碰撞<ol>
<li>扰动函数：使元素分布均匀，减少碰撞几率</li>
<li>使用<code>final</code>对象，这些对象已经重写<code>equals</code>和<code>hashcode</code>方法</li>
</ol>
</li>
<li>扩容<ol>
<li>基础容量为<font color="#FFFF00">16</font>，负载因子达到<font color="#FFFF00">0.75</font>时扩容为原来的<font color="#FFFF00">2</font>倍</li>
<li>多线程环境下，调整大小会存在条件竞争，容易造成死锁</li>
<li><code>rehashing</code>是比较耗时的过程</li>
</ol>
</li>
<li>解决线程不安全<ol>
<li>调用<code>Collections</code>的<code>synchronizedMap</code>为<code>HashMap</code>实例对象加锁</li>
<li><code>synchronizedMap</code>方法为<code>hashMap</code>实例对象加<code>synchronized</code>锁，锁是<code>mutex</code>互斥锁</li>
</ol>
</li>
</ol>
</li>
<li><code>LinkedHashMap</code></li>
<li><code>TreeMap</code></li>
<li><code>HashTable</code>：线程安全，有同步锁</li>
</ol>
</li>
</ol>
</li>
<li><code>Queue</code></li>
<li><code>Set</code><ol>
<li>特点<ol>
<li>无序，不可重复，但<code>TreeSet</code>有序</li>
</ol>
</li>
<li>实现类<ol>
<li><code>HashSet</code>：底层是<code>HashMap</code>，由<code>Hashcode</code>和<code>equals</code>方法保证元素唯一性</li>
<li><code>TreeSet</code>：底层是<code>TreeMap</code>，元素有序<ol>
<li>自然排序：让所属对象的方法实现<code>comparable</code>接口的无参构造</li>
<li>比较器排序：<code>comparator</code>带参构造</li>
</ol>
</li>
<li><code>LinkedHashSet</code></li>
</ol>
</li>
</ol>
</li>
<li><code>JUC</code><ol>
<li><code>CAS</code>是<code>JUC</code>的基础</li>
<li><code>AQS</code>是<code>JUC</code>的<code>locks</code>包的基础</li>
<li>包的分类<ol>
<li>线程执行器<code>executor</code></li>
<li>锁<code>locks</code></li>
<li>原子变量<code>atomic</code></li>
<li>并发工具类<code>tools</code><ol>
<li>闭锁<code>CountDownLatch</code>：让主线程等待一组事件发生后继续执行</li>
<li>栅栏<code>CyclicBarrier</code>：阻塞当前线程，等待其他线程</li>
<li>信号量<code>Semaphore</code>：控制某个资源可被同时访问的线程个数</li>
<li>交换器<code>Exchanger</code>：两个线程达到同步点后，相互交换数据</li>
</ol>
</li>
<li>并发集合<code>Collections</code><ol>
<li><code>BlockingQueue</code>：提供可阻塞的入队和出队操作(都是线程安全的)<ol>
<li>主要用于生产者-消费者模式：将任务的生产和消费进行隔离</li>
<li><code>ArrayBlockingQueue</code>：一个由数组结构组成的有界阻塞队列</li>
<li><code>LinkedBlockingQueue</code>：一个由链表结构组成的有/无界阻塞队列</li>
<li><code>PriorityBlockingQueue</code>：一个支持优先级排序的无界阻塞队列</li>
<li><code>DealyQueue</code>：一个使用优先级队列实现的无界阻塞队列</li>
<li><code>SynchronousQueue</code>：一个不存储元素的阻塞队列</li>
<li><code>LinkedTransferQueue</code>：一个由链表结构组成的无界阻塞队列</li>
<li><code>LinkedBlockingDeque</code>：一个由链表结构组成的双向阻塞队列</li>
<li><code>ConcurrentHashMap</code><ol>
<li>JDK8以前：使用更细粒度的锁，由一个<code>Segmen</code>t数组和多个<code>HashEntry</code>组成，实现了锁分离，即每个元素的锁是不一样的</li>
<li>JDK8之后：使用<code>CAS+synchronized</code>使锁更细化</li>
<li>存在于JUC包下，不允许存储null键值</li>
<li>put逻辑<ol>
<li>判断<code>Node[]</code>数组是否初始化，没有就先初始化</li>
<li>通过<code>hash</code>定位数组的索引坐标，是否有<code>node</code>节点，如果没有则使用<code>CAS</code>进行添加(链表的头结点)，添加失败则进入下次循环</li>
<li>检查内部正在扩容，就帮助它一块扩容</li>
<li>如果<code>f!=null</code>，则使用<code>synchronized</code>锁住元素(锁是链表/红黑树的头元素)<ol>
<li>如果<code>Node</code>(链表结构)则执行链表的添加操作</li>
<li>如果<code>Node</code>(树结构)则执行树的添加操作</li>
</ol>
</li>
<li>判断链表的长度是否达到临界值<font color="#FFFF00">8</font>(可修改的默认值)，达到8就将链表转为红黑树</li>
</ol>
</li>
<li>锁<ol>
<li>首先使用无锁操作<code>CAS</code>插入头节点，失败就循环重试</li>
<li>若已有头节点，则尝试获取头节点的同步锁，再进行操作</li>
</ol>
</li>
<li><code>Size</code>方法和<code>MappingCount</code>方法异同</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="3-多线程"><a href="#3-多线程" class="headerlink" title="3. 多线程"></a>3. 多线程</h2><ol>
<li>进程和线程<ol>
<li>进程<ol>
<li>是资源分配时的最小单元(独占一块内存，相互之间互不干扰)</li>
<li>可以看做是独立应用，线程只是进程的不同执行路径</li>
</ol>
</li>
<li>线程<ol>
<li>是<code>CPU</code>调度的最小单元(共享进程的内存资源，可以更细粒度的控制任务)</li>
</ol>
</li>
<li>进程和线程的关系<ol>
<li>运行一个程序会产生一个进程，进程至少包含一个线程</li>
<li>每个进程对应一个<code>JVM</code>实例，多线程共享<code>JVM</code>里的堆</li>
<li><code>Java</code>采用单线程编程模型，程序会自动创建主线程</li>
<li>主线程可以创建子线程，在子线程之后完成执行</li>
</ol>
</li>
</ol>
</li>
<li><code>start</code>和<code>run</code>方法<ol>
<li><code>start</code>用于启动线程，而<code>run</code>用于运行线程</li>
<li><code>start</code>方法会创建子线程并启动，而<code>run</code>方法是线程的一个普通方法调用</li>
</ol>
</li>
<li>实现线程<ol>
<li>继承<code>Thread</code>类，而<code>Thread</code>类底层也是实现了<code>Runnable</code>接口</li>
<li>直接实现<code>Runnable</code>接口，重写<code>run</code>方法</li>
<li>实现<code>Callable</code>接口，重写<code>call</code>方法</li>
<li>处理线程的返回值<ol>
<li>主线程等待法</li>
<li>使用线程的<code>join</code>方法用以阻塞等待子线程处理完毕</li>
<li>实现<code>Callable</code>接口，获取<code>call</code>方法的返回值</li>
<li>通过线程池来获取返回值</li>
</ol>
</li>
</ol>
</li>
<li>线程状态<ol>
<li>新建：创建后还没有启动的线程</li>
<li>运行：包含正在运行和等待运行的线程</li>
<li>无限等待：不会被分配<code>CPU</code>执行，需要显示被唤醒</li>
<li>限期等待：在一定时间后会由系统自动唤醒</li>
<li>阻塞：等待获取排他锁</li>
<li>结束：已终止线程的状态，执行结束</li>
</ol>
</li>
<li>等待线程和唤醒线程<ol>
<li>等待线程<ol>
<li><code>wait</code><ol>
<li>是<code>Object</code>类中的方法</li>
<li>只能在<code>synchronized</code>方法或<code>synchronized</code>块中使用</li>
<li>不仅释放<code>CPU</code>，而且会释放已经占有的同步资源锁</li>
</ol>
</li>
<li><code>sleep</code><ol>
<li>是线程类特有的方法</li>
<li>可以在任何地方调用</li>
<li>只会让出<code>cpu</code>，不会导致锁行为的改变</li>
</ol>
</li>
</ol>
</li>
<li>唤醒线程<ol>
<li>池<ol>
<li>锁池<code>EntryList</code>：等待获取锁的池</li>
<li>等待池<code>WaitSet</code>：等待线程的池</li>
</ol>
</li>
<li><code>notify</code><ol>
<li>只会随机选取一个处于等待池中的线程进入锁池中去竞争获取锁</li>
</ol>
</li>
<li><code>notifyAll</code><ol>
<li>会让所有处于等待池中的线程全部进入锁池去竞争获取锁</li>
</ol>
</li>
</ol>
</li>
<li>函数<ol>
<li><code>yield</code><ol>
<li>告知线程调度器当前(调用者)线程愿意让出<code>CPU</code>的暗示，但是线程调度器会忽略这个暗示</li>
<li>不会影响锁的行为(不会使当前线程让出已经占用的锁)</li>
</ol>
</li>
<li><code>interrupt</code><ol>
<li>停止线程：<code>stop</code>方法，<code>suspend</code>方法，<code>resume</code>方法</li>
<li>调用<code>interrupt</code>如果线程处于阻塞状态，那么线程立即退出阻塞状态，抛出<code>InterruptedException</code>异常</li>
<li>调用<code>interrupt</code>如果线程处于正常运行，那么会将其中断标志位设置为<code>true</code>，被中断标识的线程仍可以正常运行</li>
<li>需要被调用<code>interrupt</code>的线程配合中断</li>
</ol>
</li>
</ol>
</li>
<li>锁—解决多线程操作共享数据带来的数据不安全<ol>
<li>互斥锁<ol>
<li>互斥性：在同一时刻只允许一个线程持有某个对象锁</li>
<li>可见性：确保在锁被释放前，对共享变量的修改是对后面线程是可见的</li>
</ol>
</li>
<li>同步锁<ol>
<li>获取对象锁<ol>
<li>同步代码块，锁 是<code>this</code></li>
<li>同步非静态方法，锁是当前对象的实例对象</li>
</ol>
</li>
<li>获取类锁<ol>
<li>同步代码块，锁是类的字节码文件</li>
<li>同步静态方法，锁是当前对象的类对象</li>
</ol>
</li>
<li>原理<ol>
<li>基于<code>Java</code>对象头和<code>Monitor</code>实现</li>
<li>对象在内存中的布局<ol>
<li>对象头：<code>Mark Word</code>和<code>Class Metadata Address</code>组成<ol>
<li><code>Mark Word</code>：存储对象的运行时数据，默认存储对象的<code>HashCode</code>，分代年龄，锁类型，锁标志位等</li>
<li><code>Class Metadata Address</code>：是指针，指向对象的类元数据</li>
</ol>
</li>
<li><code>Monitor</code><ol>
<li>每个<code>Java</code>对象自身存在的内部锁—<code>java</code>对象可以作为锁的原因</li>
<li>重入：一个线程试图获取自己持有对象锁的临界资源时</li>
<li>阻塞：一个线程试图获取由其他线程持有的对象锁的临界资源时</li>
</ol>
</li>
<li>实例数据</li>
<li>对齐填充</li>
</ol>
</li>
<li>早期的<code>synchronized</code>锁<ol>
<li>属于重量级锁，依赖于<code>Mutex Lock</code>实现</li>
<li>线程之间的切换需要从用户态转到核心态，开销大</li>
</ol>
</li>
<li>自旋锁：通过让线程忙于循环等待锁的释放，不让出<code>CPU</code>的执行权；若锁被其他线程长时间占用，则会带来许多性能上的开销</li>
<li>自适应自旋锁：自旋的次数由前一次在同一个锁上自旋的时间以及锁的拥有者状态来决定</li>
<li>锁消除：JIT在编译时，对运行上下文进行扫描，消除不可能存在竞争的锁</li>
<li>状态<ol>
<li>无锁</li>
<li>偏向锁：减少同一线程获取锁的代价，不适用于锁竞争比较激烈的情况</li>
<li>轻量级锁</li>
<li>重量级锁</li>
<li>锁升级：无锁—偏向锁—轻量级锁—重量级锁</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><code>ReentranLock</code>(重入锁)<ol>
<li>位于<code>Java.util.concurrent.locks</code>包下</li>
<li>和<code>CountDownLatch</code>，<code>FutureTask</code>，<code>Semaphore</code>一样基于<code>AQS</code>实现<ol>
<li><code>AQS</code>：<code>AbstractQueueSynchronizer</code></li>
</ol>
</li>
<li>实现比<code>synchronized</code>更细粒度的控制，如<code>fairness</code>(公平锁)<ol>
<li>公平锁：获取锁的顺序按先后调用<code>lock</code>方法的顺序</li>
<li>非公平锁：抢占机制，优先度高的抢到的几率大</li>
</ol>
</li>
<li>调用<code>lock</code>方法后，必须调用<code>unlock</code>释放锁</li>
<li>区分<code>synchronized</code>锁<ol>
<li><code>synchronized</code>是关键字，而<code>ReentranLock</code>是类</li>
<li><code>ReentranLock</code>可以对锁的等待时间进行设置，避免死锁</li>
<li><code>ReentranLock</code>可以获取各种锁的信息，可以灵活的实现多路通知</li>
<li><code>synchronized</code>操作的是<code>Mark Word</code>，<code>lock</code>锁操作的是<code>Unsafe</code>类的<code>park</code>方法</li>
</ol>
</li>
</ol>
</li>
<li>JMM—<code>Java Memory Model</code><ol>
<li>主内存<ol>
<li>存储<code>Java</code>实例对象</li>
<li>包括成员变量，类信息，常量，静态变量等</li>
<li>属于数据共享区域，多线程并发操作时会引发线程安全问题</li>
</ol>
</li>
<li>工作内存<ol>
<li>存储的是当前方法的所有本地变量信息，本地变量对其他线程不可见</li>
<li>字节码行号指示器，<code>Native</code>方法信息</li>
<li>属于线程私有数据区域，不存在线程安全问题</li>
</ol>
</li>
<li>区分<code>Java</code>内存划分<ol>
<li><code>JMM</code>描述的是一组规则，围绕原子性，有序性，可见性展开</li>
<li>同<code>Java</code>内存相似，都存在共享区和私有区</li>
<li>方法里的基本数据类型和本地变量直接存储在工作内存的栈帧结构中</li>
<li>引用类型的本地变量：引用存储在工作内存中，实例存储在主内存中</li>
<li>成员变量：<code>static</code>变量，类信息均会存储在主内存中</li>
</ol>
</li>
<li>指令重排序<ol>
<li>在单线程情况下不能改变程序运行的结果</li>
<li>存在数据依赖关系的不允许重排序</li>
<li>无法通过<code>Happens-before</code>原则推导出来的，才能进行指令重排序<ol>
<li><code>A</code>操作的结果需要对<code>B</code>操作可见，则<code>A</code>和<code>B</code>存在<code>happens-before</code>关系</li>
<li><code>happens-before</code>的原则<ol>
<li>程序次序规则：一个线程内，按照代码顺序，先写的代码先执行</li>
<li>锁定规则：一个<code>unLock</code>操作优先后面对同一个锁的<code>lock</code>操作</li>
<li><code>Volatile</code>变量规则：一个变量的写操作优先于后面对这个变量的读操作</li>
<li>传递规则：如果<code>A</code>操作优于<code>B</code>操作，<code>B</code>操作优于<code>C</code>操作，那么<code>A</code>操作优于<code>C</code>操作</li>
<li>线程启动规则：<code>Thread</code>对象的<code>start</code>方法优先执行在该线程的每一个动作之前</li>
<li>线程中断规则：对线程<code>interrupt</code>方法的调用优于被中断线程的代码检测到中断事件前发生</li>
<li>线程终结规则：线程中所有的操作都优于线程终止检测事件</li>
<li>对象终结规则：一个对象的初始化完成优于其<code>finalize</code>方法执行</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><code>Volatile</code><ol>
<li><code>JVM</code>提供轻量级同步机制</li>
<li>由<code>Volatile</code>修饰的共享变量对所有线程总是可见的</li>
<li>禁止指令的重排序优化<ol>
<li>内存屏障<ol>
<li>保证特定操作的执行顺序</li>
<li>保证某些变量的内存可见性</li>
</ol>
</li>
<li>通过插入内存屏障指令来禁止在内存屏障前后的指令执行重排序优化</li>
<li>强制刷出<code>CPU</code>的缓存数据，因此在<code>cpu</code>上的任何线程都能读取到这些数据的最新版本</li>
</ol>
</li>
<li>可见性分析<ol>
<li>定义一个<code>Volatile</code>变量时，<code>JMM</code>会把该线程对应的工作内存中的共享变量刷新到主内存中</li>
<li>读取一个<code>Volatile</code>变量时，<code>JMM</code>会把该线程对应的工作内存置为无效</li>
</ol>
</li>
</ol>
</li>
<li><code>Volatile</code>和<code>synchronized</code>的区别<ol>
<li><code>Volatile</code>本质是告知<code>JVM</code>当前变量在寄存器(工作内存)中的值不确定需要从主内存中读取，<code>synchronized</code>只是锁定当前变量</li>
<li><code>Volatile</code>仅用于变量级别，<code>synchronized</code>可以用在变量，方法，类上</li>
<li><code>Volatile</code>不会造成线程阻塞，<code>synchronized</code>会造成线程阻塞</li>
<li><code>Volatile</code>标记的变量不会被编译器优化，<code>synchronized</code>标记的变量会被编译器优化</li>
</ol>
</li>
</ol>
</li>
<li><code>CAS(</code>乐观所锁)—一种高效实现线程安全性的方法<ol>
<li>支持原子更新操作，适用于计数器，序列发生器等场景</li>
<li>属于乐观锁机制，号称<code>lock-free</code></li>
<li><code>CAS</code>操作失败 后开发者决定是否继续尝试，还是执行别的操作</li>
<li>包含三个操作数：内存位置，预期原值和新值</li>
<li>缺点<ol>
<li>若循环时间长，则开销大</li>
<li>只能保证一个共享变量的原子操作</li>
<li><code>ABA</code>问题—一个变量<code>A</code>改变到<code>B</code>未被检测出来，导致两次读取的值都是<code>A</code>—通过<code>AtomicStampedReference</code>类改变</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>线程池<ol>
<li><code>Executor</code>接口<ol>
<li><code>Executor</code>：运行新任务的简单接口，将任务提交和任务执行细节解耦</li>
<li><code>ExecutorService</code>：具备管理执行器和任务生命周期的方法，提交任务 机制更完善</li>
<li><code>SchduledExecutorService</code>：支持<code>Future</code>和定时任务</li>
</ol>
</li>
<li>5种不同场景的线程池创建<ol>
<li><code>newFixedThreadPool(int nThread)</code>：指定工作线程数量的线程池</li>
<li><code>newCachedThreadPool()</code>：短时间处理大量工作任务的线程池</li>
<li><code>newSingleThreadExecutor()</code>：创建唯一的工作线程来执行任务，如果该线程一结束，会有另一个线程取代它</li>
<li><code>newSingleThreadScheduledExecutor()</code>和<code>newScheduledThreadExecutor(int corePoolSize)</code>：定时或者周期性的工作调度线程池，两个的区别在于单一工作线程还是多线程</li>
<li><code>newWorkStealingPool()</code>：内部构建<code>ForkJoinPool</code>，利用<code>working-stealing</code>算法，并行的执行任务，不保证处理顺序<ol>
<li><code>Fork/Join</code>框架<ol>
<li>把大任务分割为有限的小任务执行，把每个小 任务的执行结果汇总得到大任务结果的框架</li>
</ol>
</li>
<li><code>work-stealing</code>算法：某个线程从其他队列里窃取任务来执行</li>
</ol>
</li>
<li>确定线程池的大小<ol>
<li><code>CPU</code>密集型：线程数=核数+1</li>
<li><code>IO</code>密集型：线程数=核数*（1+平均等待时间/平均工作时间）</li>
</ol>
</li>
</ol>
</li>
<li>优势<ol>
<li>降低资源的消耗</li>
<li>提高线程的可管理性</li>
</ol>
</li>
<li><code>ThreadPoolExecutor</code>构造函数<ol>
<li><code>corePoolSize</code>：核心线程数量</li>
<li><code>maximunPoolSize</code>：线程不够用时，最多可创建的线程数</li>
<li><code>workQueue</code>：任务等待队列</li>
<li><code>keepAliveTime</code>：抢占顺序不一定</li>
<li><code>ThreadFactory</code>：创建新线程</li>
<li><code>Handler</code>：线程池的饱和策略<ol>
<li><code>AbortPolicy</code>：直接抛出异常，默认策略</li>
<li><code>CallerRunsPolicy</code>：用调用者所在的线程来执行任务，并执行当前任务</li>
<li><code>DiscardOldPolicy</code>：丢弃队列中最靠前的任务，并执行当前任务</li>
<li><code>DiscardPolicy</code>：直接丢弃任务</li>
<li>通过实现<code>RejectedExecutorHandler</code>接口来自定义<code>Handler</code></li>
</ol>
</li>
</ol>
</li>
<li><code>executor</code>流程<ol>
<li>如果线程数少于<code>corePoolSize</code>，则直接创建新线程来执行任务，即使线程池中其他线程是空闲的</li>
<li>如果线程池中的线程数量大于等于<code>corePoolSize</code>而小于<code>maximumPoolSize</code>，只有当<code>workQueue</code>满时才去创建新线程处理任务</li>
<li>如果<code>corePoolSize</code>和<code>maximumPoolSize</code>值相同，则创建的线程池大小固定的，这是如果有新任务，若<code>workQueue</code>未满，则将请求放入<code>workQueue</code>中，等待有空闲的线程去从<code>workQueue</code>中取出任务并执行</li>
<li>如果运行的线程数大于等于<code>maximumPoolSize</code>，这时如果<code>workQueue</code>已满，则通过<code>Handler</code>所指定的策略来处理任务</li>
</ol>
</li>
<li>线程池的状态<ol>
<li><code>Runing</code>：能够接受新任务提交，也可以处理阻塞队列中的任务</li>
<li><code>Shutdown</code>：不在接受新提交的任务，但可以处理存量任务</li>
<li><code>Stop</code>：不在接受新提交的任务，也不处理存量任务</li>
<li><code>Tidying</code>：所有任务都已终止</li>
<li><code>Terminated：terminated</code>方法执行后进入该状态(仅作标识)</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="4-JVM"><a href="#4-JVM" class="headerlink" title="4. JVM"></a>4. JVM</h2><ol>
<li><p><code>Java</code>跨平台原理</p>
<ul>
<li>基于不同平台的<code>JVM</code>实现，即在不同平台安装对应的<code>JDK</code>就能运行<code>Java</code>程序</li>
</ul>
</li>
<li><p><code>Java</code>反射</p>
<ul>
<li>动态获取任意类，对象的属性和方法</li>
<li>这种在运行状态中动态获取信息以及调用对象方法的特性称为<code>Java</code>的反射机制</li>
<li><code>API</code>：<code>getDeclaredMethod(getMethod)</code>：接收方法名，方法名对应的字节码对象</li>
<li>本质：把<code>Java</code>类中的方法和属性映射为<code>Java</code>对象</li>
</ul>
</li>
<li><p>类加载机制</p>
<ul>
<li>虚拟机将<code>class</code>文件加载进内存的行为</li>
<li>加载流程<ul>
<li>通过<code>ClassLoader</code>加载<code>class</code>字节码文件，生成<code>class</code>对象</li>
<li>检查<code>class</code>的正确性和安全性</li>
<li>为变量分配内存空间和设置初始值</li>
<li><code>JVM</code>常量池中的符号引用转为直接引用</li>
<li>执行类变量赋值和静态代码块</li>
</ul>
</li>
<li>双亲委派机制<ul>
<li>一个类收到类加载请求时，会将请求委派给父类，如果父类不能加载才由子类去完成加载</li>
<li>避免同样的字节码文件被加载多次</li>
</ul>
</li>
<li>四种类加载器<ul>
<li>启动类加载器：用于加载<code>Java</code>的核心类库</li>
<li>扩展类加载器：用于加载<code>Java</code>的扩展库</li>
<li>系统类加载器：根据<code>Java</code>的类路径来加载<code>Java</code>类</li>
<li>用户自定义类加载器：通过继承<code>Classloader</code>类的方式实现</li>
</ul>
</li>
<li><code>LoaderClass</code>和<code>forName</code><ul>
<li>在运行时都能知道该类的属性和方法</li>
</ul>
</li>
</ul>
</li>
<li><p>内存结构 </p>
<ol>
<li>线程私有<ol>
<li>虚拟机栈，本地方法栈，程序计数器<ol>
<li>虚拟机栈<ol>
<li><code>Java</code>方法执行的基础</li>
<li>包含多个栈帧(栈帧用于存储局部变量表，操作数栈，动态链接，方法出口)</li>
</ol>
</li>
<li>本地方法栈<ol>
<li>和虚拟机栈类似，主要用于标注<code>native</code>方法</li>
</ol>
</li>
<li>程序计数器<ol>
<li>当前线程所执行的字节码行号指示器(逻辑指示器)</li>
<li>改变计数器的值来选取下一条所需执行的字节码指令</li>
<li>和线程是一对一关系(即线程有)</li>
<li>对<code>Java</code>方法计数，如果是<code>native</code>方法则计数器值<code>undefined</code></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>线程共享<ol>
<li>堆<ol>
<li>对象实例的分配区域</li>
<li><code>GC</code>管理的主要区域</li>
<li>JDK7以后常量池存在于堆中，方便<code>GC(</code>之前存在于永久代中，浪费内存)</li>
</ol>
</li>
<li>元空间(<code>MetaSpace</code>)和永久代(<code>PermGen)</code>—是方法区的实现<ol>
<li>都是用来存储<code>class</code>的相关信息</li>
<li>元空间使用的本地内存，而永久代使用的是<code>JVM</code>内存，所以元空间替代了永久代</li>
<li>字符串常量池存在于永久代中，容易出现性能问题和内存溢出</li>
<li>类和方法的信息大小难以确定，给永久代的大小指定带来困难</li>
<li>永久代为<code>GC</code>带来不必要的复杂性</li>
</ol>
</li>
<li>堆和栈的区别<ol>
<li>联系：引用对象，数组时，栈里定义变量保存在堆中的地址</li>
<li>管理方式：栈可以自动释放，堆需要<code>GC</code></li>
<li>空间：栈比堆小</li>
<li>碎片：栈内存产生的碎片远小于堆</li>
<li>分配方式：栈支持静态和动态分配，而堆仅支持动态分配</li>
<li>效率：栈的效率比堆高</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><p><code>GC</code>机制</p>
<ol>
<li>没有被其他对象引用时，就判定为垃圾</li>
<li>垃圾判定算法<ol>
<li>引用计数法<ol>
<li>通过判断对象的引用数量来决定对象是否可以被回收</li>
<li>为每个对象创建一个引用计数器，被引用的计数器值<code>+1</code>，完成引用后计数器值<code>-1</code></li>
<li>当引用计数器值为<code>0</code>时，就认定该对象为垃圾</li>
<li>优点：执行效率高，程序执行受影响小</li>
<li>缺点：无法检测出循环引用的情况，导致内存泄漏(子类和父类之间循环引用，计数器值就没有为0的情况)</li>
</ol>
</li>
<li>可达性分析算法—基于图论<ol>
<li>判断对象的引用链是否可达，不可达就认定为垃圾</li>
<li><code>GC Root</code>对象<ol>
<li>虚拟机栈中引用的对象(栈帧中的本地变量表)</li>
<li>方法区中常量引用的对象</li>
<li>方法区中静态属性引用的对象</li>
<li>本地方法栈中<code>JNI</code>(<code>native</code>方法)引用的对象</li>
<li>活跃线程引用的对象</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>垃圾回收算法<ol>
<li>标记-清除算法<ol>
<li>标记：从跟集合进行扫描，对存活的对象进行标记</li>
<li>清除：对堆内存从到尾进行线程遍历，回收不可达的对象</li>
<li>缺点：产生碎片块多</li>
</ol>
</li>
<li>复制算法<ol>
<li>分为对象面和空闲面</li>
<li>对象在对象面上创建</li>
<li>将存活的对象从对象面复制到空闲面</li>
<li>将对象面的所有对象从内存中清除</li>
<li>优点<ol>
<li>解决碎片化问题</li>
<li>顺序分配内存，简单高效</li>
<li>适用于对象存活率低的场景(如年轻代)</li>
</ol>
</li>
</ol>
</li>
<li>标记-整理算法<ol>
<li>标记：从跟集合进行扫描，对存活的对象进行标记</li>
<li>整理：移动所有存活的对象，且按照内存地址依次排序，然后将末端内存地址以后的内存全部回收</li>
</ol>
</li>
<li>分代收集算法<ol>
<li>按照对象生命周期的不同划分区域以采用不同的垃圾回收算法，提高了JVM的回收效率</li>
<li>JDK8以前分为年轻代，老年代，永久代；JDK8开始取消永久代</li>
<li><code>Minor GC</code>发生在年轻代中的收集动作，采用的是复制算法<ol>
<li>尽可能快速的收集哪些生命周期短的对象</li>
<li>主要分为<code>Eden</code>区和两个<code>Survivor</code>区(包含一个<code>from</code>区和<code>to</code>区)[<code>Eden:from:to=8:1:1</code>]</li>
<li>每次触发<code>GC</code>后存活的对象年龄值<code>+1</code>，默认是<code>15</code>岁后进入老年代</li>
</ol>
</li>
<li><code>Full GC</code><ol>
<li>经历一定次数(默认是15次)的<code>Minor GC</code>后依然存活的对象开始进入老年代</li>
<li><code>Survivor</code>区存放不下的大对象直接进入老年代</li>
<li>发生在老年代的收集动作，存放生命周期较长的对象；采用标记-清除算法和标记-整理算法</li>
<li>触发<code>Full GC</code><ol>
<li>老年代和永久代空间不足</li>
<li><code>CMS GC</code>时出现promotion failed，concurrent mode failure</li>
<li><code>Minor GC</code>升级老年代的平均大小大于老年代的剩余空间</li>
<li>调用<code>System.gc()</code>方法—只是提醒虚拟机需要在这里进行回收，具体的回收操作由虚拟机自己决定</li>
<li>通过<code>RMI</code>来进行<code>RPC</code>或管理<code>JDK</code>引用，默认每<code>1</code>小时进行一次<code>Full GC</code></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>调优参数<ol>
<li><code>-XX:SurvivorRatio</code>：设置<code>Eden</code>和<code>Survivor</code>的比值，默认是<code>8:1</code></li>
<li><code>-XX:NewRatio</code>：设置老年代和年轻代内存大小的比例</li>
<li><code>-XX:MaxTenuringThreshold</code>：对象从年轻代升级为老年代需要出发<code>Minor GC</code>的次数</li>
</ol>
</li>
<li><code>Stop_the_World</code><ol>
<li><code>JVM</code>由于要执行<code>GC</code>而停止了应用程序的执行</li>
<li>任何一种<code>GC</code>都会发生</li>
<li>通过避免减少<code>Stop_the_World</code>的发生时间来提高程序性能</li>
</ol>
</li>
<li><code>Safepoint</code>(安全点)<ol>
<li>触发<code>GC</code>的快照点</li>
<li>分析过程中对象引用关系不会产生变化的点</li>
<li><code>Safepoint</code>可能点：方法调用，循环跳转，异常跳转等</li>
<li>要确保安全点数量适中</li>
</ol>
</li>
</ol>
</li>
<li>垃圾收集器<ol>
<li>新生代垃圾收集器<ol>
<li><code>Serial</code>收集器<ol>
<li>单线程收集，进行垃圾收集时，必须暂停所有的工作线程</li>
<li>简单高效，<code>Client</code>模式下默认的年轻代收集器</li>
</ol>
</li>
<li><code>ParNew</code>收集器<ol>
<li>多线程收集器，其余和<code>Serial</code>相同</li>
<li>单线程执行效率不如<code>Serial</code>，在多核环境下才有优势</li>
</ol>
</li>
<li><code>Parallel Scavenge</code>收集器<ol>
<li>更关注系统的吞吐量</li>
<li>在多核执行才有优势，<code>Server</code>模式下默认的年轻代收集器</li>
</ol>
</li>
</ol>
</li>
<li>老年代垃圾收集器<ol>
<li><code>Serial Old</code>收集器<ol>
<li>单线程收集，进行垃圾收集时，必须暂停所有工作线程</li>
<li>简单高效，<code>Client</code>模式下默认的老年代收集器</li>
</ol>
</li>
<li><code>Parallel Old</code>收集器<ol>
<li>多线程，吞吐量优先</li>
</ol>
</li>
<li><code>CMS</code>收集器<ol>
<li>初始标记：<code>Stop_the_World</code></li>
<li>并发标记：并发追溯标记，程序不会停顿</li>
<li>并发预清理：查找执行文件并发标记阶段从年轻代晋升老年代的对象</li>
<li>重新标记：暂停虚拟机，扫描<code>CMS</code>堆中的剩余对象</li>
<li>并发清理：清理垃圾对象，程序不会停顿</li>
<li>并发重置：重置<code>CMS</code>收集器的数据结构</li>
</ol>
</li>
<li><code>Garbage First</code>收集器<ol>
<li>并发和并行</li>
<li>分代收集</li>
<li>空间整合</li>
<li>可预测的停顿</li>
<li>将<code>Java</code>堆内存划分为多个大小相等的<code>Region</code></li>
</ol>
</li>
<li><code>finalize</code>方法</li>
<li><code>Java</code>中的强引用，软引用，弱引用，虚引用<ol>
<li>强引用<ol>
<li>最普遍的引用，抛出<code>OutMemoryError</code>终止程序也不会回收具有强引用的对象</li>
<li>通过将对象置为<code>null</code>来弱化其引用，使其被回收</li>
</ol>
</li>
<li>软引用<ol>
<li>对象处于有用但非必须的状态</li>
<li>只有当空间不足时，<code>GC</code>会回收该引用对象的内存</li>
<li>用来实现高速缓存</li>
</ol>
</li>
<li>弱引用<ol>
<li>非必须引用对象，比软引用更弱一些</li>
<li><code>GC</code>触发时会被回收</li>
<li>被回收的几率不大，因为<code>GC</code>线程的优先级比较低</li>
<li>适用于偶尔使用的对象</li>
</ol>
</li>
<li>虚引用<ol>
<li>不会决定对象的生命周期</li>
<li>任何时候都可能会被<code>GC</code></li>
<li>用于跟踪垃圾回收器的回收活动，起到哨兵作用</li>
<li>必须和引用队列联合使用</li>
</ol>
</li>
<li>引用队列<ol>
<li>没有实际的存储结构，存储逻辑依赖于内部节点之间的关系来表达</li>
<li>存储关联被<code>GC</code>的软引用，弱引用，以及虚引用</li>
</ol>
</li>
<li><code>JVM</code>调优<ol>
<li>调优参数含义<ol>
<li><code>-Xss</code>：表示每个虚拟机栈(堆栈)的大小</li>
<li><code>-Xms</code>：堆的初始值</li>
<li><code>-Xmx</code>：堆能达到的最大值(一般情况下将<code>-Xms</code>和<code>-Xmx</code>值设置相同，避免扩容时的内存抖动而影响程序运行时的稳定性)</li>
</ol>
</li>
<li>内存分配策略<ol>
<li>静态存储：编译时确定每个数据目标在运行时的存储空间</li>
<li>栈式存储：数据区在编译时未知，运行时模块入口前确定</li>
<li>堆式存储：编译时或运行时模块入口都无法确定，动态分配</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><p>内存溢出</p>
<blockquote>
<p>程序在申请内存的时候，没有足够的内存供其使用</p>
</blockquote>
<ul>
<li>死循环</li>
<li>递归</li>
<li>大对象太多，<code>Java</code>中的大对象是可以直接进入老年代的</li>
</ul>
</li>
<li></li>
</ol>
<h2 id="5-数据库"><a href="#5-数据库" class="headerlink" title="5. 数据库"></a>5. 数据库</h2><h3 id="5-1-MySQL"><a href="#5-1-MySQL" class="headerlink" title="5.1 MySQL"></a>5.1 MySQL</h3><h4 id="5-1-1-基础"><a href="#5-1-1-基础" class="headerlink" title="5.1.1 基础"></a>5.1.1 基础</h4><ol>
<li>关系型数据库<ul>
<li>数据库模块<ul>
<li>存储模块—<code>OS</code>文件系统(将数据持久化存储到硬盘，磁盘中)</li>
<li>程序实例—用逻辑结构来映射物理结构<ul>
<li>存储管理</li>
<li>缓存机制</li>
<li><code>sql</code>解析模块</li>
<li>日志管理</li>
<li>权限划分</li>
<li>容灾机制</li>
<li>索引管理</li>
<li>锁管理</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>索引<ul>
<li>作用：提高查询效率</li>
<li>实例：主键，唯一键(<code>id</code>)，让数据具备一定区分性的字段等可以作为索引</li>
<li>数据结构<ul>
<li>生成索引建立二叉树进行二分查找</li>
<li>生成索引建立<code>B</code>树结构进行查找</li>
<li>生成索引建立<code>B+</code>树结构进行查找</li>
<li>生成索引，建立<code>hash</code>结构进行查找</li>
</ul>
</li>
</ul>
</li>
<li>树结构介绍<ul>
<li>二叉查找树<ul>
<li>查询效率：<code>O(logn)</code></li>
<li>左子树：左子树节点值均小于根节点值</li>
<li>右子树：右子树节点值均大于根节点值</li>
<li>注意：二叉树在有限次增删改之后会变成线性结构，此时查询效率为<code>O(n)</code></li>
<li>解决：利用树的旋转特性，将二叉树转为平衡二叉树，这样查询效率会维持在<code>O(logn)</code></li>
<li>平衡二叉树：大数据量情况下，由于每个节点只能有两个叶子节点，大大增加了树的层级和存储空间；会浪费大量的磁盘<code>IO</code></li>
</ul>
</li>
<li><code>B</code>树<ul>
<li>一种多路平衡查找树，每个节点最多有<code>M</code>个子节点，称为<code>M</code>阶<code>B</code>树，但至少有两个子节点</li>
<li>查询效率<code>O(logn)</code></li>
</ul>
</li>
<li><code>B+</code>树<ul>
<li>每个叶子节点的指针数和关键字数相同，同阶的B+树比B树能存储更多的关键字</li>
<li>优势<ul>
<li>磁盘读写代价更低</li>
<li>查询效率更为稳定</li>
<li>更有利于数据库的扫描(<code>B+</code>树只需遍历所有的叶子节点就能对全部的关键字进行扫描)</li>
</ul>
</li>
</ul>
</li>
<li><code>Hash</code>索引<ul>
<li>根据<code>Hash</code>函数计算一次便能找到所需元素</li>
<li>仅仅满足<code>=</code>，<code>in</code>等等值查询，不能使用范围查询</li>
<li>不能进行排序操作，因为经过<code>Hash</code>运算后的值和运算前的键值对应，而查找是<code>Hash</code>索引对应的值，不能匹配到</li>
<li>不能避免全表 扫描</li>
</ul>
</li>
<li><code>BitMap</code><ul>
<li>仅<code>Oracle</code>支持</li>
<li>锁的粒度较大，新增和修改操作时，在同一位图的数据操作都会被阻塞</li>
</ul>
</li>
</ul>
</li>
<li>密集索引和稀疏索引<ul>
<li>密集索引：每个搜索码值都对应一个索引值</li>
<li>稀疏索引：只为索引码的某些值建立索引项</li>
</ul>
</li>
<li><code>InnoDB</code><ul>
<li>若一个主键被定义，则该主键则作为密集索引</li>
<li>若无主键定义，则该表第一个唯一非空索引值作为密集索引</li>
<li>若无以上，<code>innodb</code>内部会生成一个隐藏主键(密集索引)</li>
<li>数据和索引是存储在一起的，<code>MyIsAM</code>数据和索引是分开的</li>
</ul>
</li>
<li>优化步骤<ol>
<li>根据慢查询日志定位慢查询<code>sql</code><ol>
<li>变量<ol>
<li>慢查询日志：<code>slow_query_log</code></li>
<li>慢查询文件路径：<code>slow_query_log_file</code></li>
<li>慢查询时间：<code>long_query_time</code></li>
<li>开启慢查询日志：<code>set global slow_query_log = on;</code></li>
</ol>
</li>
<li>状态<ol>
<li><code>slow_queries</code>：慢查询数量</li>
</ol>
</li>
</ol>
</li>
<li>使用<code>explain</code>等工具分析 <code>sql</code><ol>
<li><code>type</code>：查找数据行的方式，<code>index</code>(索引)&gt;all(全表扫描)</li>
<li><code>extra</code>：<code>Using filesort</code>和<code>Using temporary</code>意味着不走索引，应该进行优化</li>
</ol>
</li>
<li>修改<code>sql</code>或者尽量让<code>sql</code>走索引<ol>
<li>修改<code>sql</code>走索引</li>
<li>为查询字段添加索引</li>
</ol>
</li>
</ol>
</li>
<li>原则<ul>
<li>最左前缀匹配原则，<code>mysql</code>会一直向右匹配，直到范围限定，如果范围之间有索引，则只有第一个条件会走索引，其他不会走索引</li>
<li><code>=</code>和<code>in</code>查询无需考虑索引顺序</li>
</ul>
</li>
</ol>
<p>索引相当于目录在书中的地位，内容远远多于目录时才适合建立。</p>
<ol>
<li><p>锁</p>
<ul>
<li><p><code>MyIsAM</code>和<code>InnoDB</code>锁的区别</p>
<ul>
<li><code>MyIsAM</code>默认使用表级锁，不支持行级锁</li>
<li><code>InnoDB</code>默认使用行级锁，也支持表级锁</li>
</ul>
</li>
<li><p>排他锁和共享锁的区别</p>
<table>
<thead>
<tr>
<th></th>
<th>排他锁</th>
<th>共享锁</th>
</tr>
</thead>
<tbody><tr>
<td>排他锁</td>
<td>冲突</td>
<td>冲突</td>
</tr>
<tr>
<td>共享锁</td>
<td>冲突</td>
<td>兼容</td>
</tr>
</tbody></table>
</li>
<li><p>乐观锁和悲观锁</p>
</li>
<li><p><code>MyIsAM</code>和<code>InnoDB</code>使用场景</p>
<ul>
<li><code>MyIsAM</code><ul>
<li>频繁的执行全表<code>count</code>语句</li>
<li>对数据进行增删频率不高，查询频率非常高</li>
<li>没有事务</li>
</ul>
</li>
<li><code>InnoDB</code><ul>
<li>数据增删改查的频率都非常频繁</li>
<li>可靠性要求比较高，要求支持事务</li>
</ul>
</li>
</ul>
</li>
<li><p>当前读和快照读</p>
</li>
<li><p><code>RC</code>，<code>RR</code>级别下的<code>InnoDB</code>非阻塞读实现</p>
<ul>
<li><code>RR</code>避免幻读，加行锁<code>+Gap</code>锁(<code>gap</code>锁用于非唯一索引和不走索引时)</li>
</ul>
</li>
</ul>
</li>
<li><p>事务的四大特性</p>
<ul>
<li><code>ACID</code></li>
<li>原子性，一致性，隔离性，持久性</li>
<li>隔离级别<ul>
<li>读已提交(<code>RC</code>)—解决脏读：一个事物读到另一个事务未提交的数据</li>
<li>可重复读(<code>RR</code>)—解决不重复读：一个数据前后两次读到的数据不一致</li>
<li>串行化—解决幻读：一个事物读到自己未提交的事务</li>
</ul>
</li>
</ul>
</li>
<li><p>锁的分类</p>
<ol>
<li>读锁又称为共享锁</li>
<li>写锁又称为排他锁</li>
<li>共享锁和排他锁，只有两个事务都是共享锁时不冲突</li>
<li>排他锁：增删改操作</li>
<li>共享锁：查询操作</li>
<li>悲观锁：在数据处理过程中将数据锁定，排他锁就是悲观锁的体现；为数据处理的安全性提供保证，同时也增加了产生死锁的机会</li>
<li>乐观锁：认为一般不会发生冲突，只有在更新数据时才会进行检测，如果冲突就返回错误信息(时间戳或数据版本)</li>
</ol>
</li>
<li><p><code>RC</code></p>
<ol>
<li><code>Oracle</code>默认的提交方式</li>
<li>实现快照读(非阻塞读)<ol>
<li>数据行必须有<code>DB_TRX_ID</code>，<code>DB_ROLL_PTR</code>，<code>DB_ROW_ID</code>字段</li>
<li><code>undo</code>日志</li>
<li><code>read view</code></li>
</ol>
</li>
</ol>
</li>
<li><p><code>RR</code></p>
<ol>
<li><code>MySQL</code>默认的提交方式</li>
<li>行锁<code>+gap</code>锁</li>
<li><code>gap</code>锁<ol>
<li>精确查找的时候，所有记录都有对应不会加<code>gap</code>锁</li>
<li><code>where</code>条件部分命中，会加<code>gap</code>锁</li>
<li>用于非唯一索引或不走索引的当前读中</li>
</ol>
</li>
</ol>
</li>
<li><p>关键语法</p>
<ul>
<li><code>Group by</code><ul>
<li><code>Select</code>语句中的列名必须为分组用到的列或列函数</li>
<li>只能是针对同一张表的字段进行分组</li>
</ul>
</li>
<li><code>having</code><ul>
<li>通常和<code>Group By</code>一起使用，<code>where</code>过滤行，<code>having</code>过滤组</li>
<li>如果省略了<code>where</code>，<code>having</code>的作用和<code>where</code>相同</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="5-1-2-数据库读写分离"><a href="#5-1-2-数据库读写分离" class="headerlink" title="5.1.2 数据库读写分离"></a>5.1.2 数据库读写分离</h4><h4 id="5-1-3-分库分表"><a href="#5-1-3-分库分表" class="headerlink" title="5.1.3 分库分表"></a>5.1.3 分库分表</h4><h4 id="5-1-4-数据库表全局唯一主键id"><a href="#5-1-4-数据库表全局唯一主键id" class="headerlink" title="5.1.4 数据库表全局唯一主键id"></a>5.1.4 数据库表全局唯一主键id</h4><h3 id="5-2-Oracle"><a href="#5-2-Oracle" class="headerlink" title="5.2 Oracle"></a>5.2 Oracle</h3><h2 id="6-服务器-主要用于集群"><a href="#6-服务器-主要用于集群" class="headerlink" title="6. 服务器(主要用于集群)"></a>6. 服务器(主要用于集群)</h2><h3 id="6-1-网络基础"><a href="#6-1-网络基础" class="headerlink" title="6.1 网络基础"></a>6.1 网络基础</h3><h4 id="6-1-1-基础概念"><a href="#6-1-1-基础概念" class="headerlink" title="6.1.1 基础概念"></a>6.1.1 基础概念</h4><ol>
<li><p>OSI网络基础</p>
<ul>
<li><p>七层模型</p>
<ul>
<li>物理层：电子接口通信信道上的原始比特流传输</li>
<li>数据链路层：将原始比特流转为逻辑传输线路</li>
<li>网络层：控制子网的运行，分组传输，路由选择</li>
<li>传输层：保证会话层的数据段有效的到达网络层</li>
<li>会话层：建立和管理应用层的会话</li>
<li>表示层：</li>
</ul>
</li>
<li><p>TCP</p>
<ul>
<li><p>流程</p>
<ul>
<li>面向连接的，可靠的，基于字节流的传输层通信协议</li>
<li>将应用层的数据流分割为报文段并发送给目标节点的TCP层</li>
<li>数据包都有序号，对方收到则发送ACK确认，未收到则重传</li>
<li>使用校验和来检验数据在传输过程中是否有误</li>
</ul>
</li>
<li><p>标识</p>
<ul>
<li>URG：紧急指针标志</li>
<li>ACK：确认序号标志</li>
<li>PSH：push标志</li>
<li>PST：重置连接标志</li>
<li>SYN：同步序号，用于建立连接过程</li>
<li>FIN：finish标志，用于释放连接</li>
</ul>
</li>
<li><p>三次握手</p>
</li>
<li><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/01.TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E7%8A%B6%E6%80%81.png" alt="三次握手"></p>
<ul>
<li>说明<ul>
<li>建立连接时，客户端发送syn包到服务器，并进入syn_send状态，等待服务器确认。</li>
<li>服务器收到syn包，必须确认客户的syn包为接收值+1，同时自己也发送一个syn包，即syn+ack包，此时服务器进入syn_recv状态</li>
<li>客户端受到服务器的syn+ack包，向服务器发送确认包ack为接收服务的值+1，此时包发送完毕，客户端和服务器端进入restablished状态完成三次握手</li>
</ul>
</li>
</ul>
</li>
<li><p>四次挥手</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/02.TCP%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png" alt="四次挥手"></p>
<ul>
<li>说明<ul>
<li>客户端发送fin字段来请求关闭连接到服务器，客户端进入fin_wait_1状态</li>
<li>服务器端接收到fin字段后，发送ack给客户端，确认序号为收到的序号+1，此时服务器进入close_wait状态</li>
<li>服务器发送fin字段，用来关闭服务器到客户端的数据传送，服务器进入last_ack状态</li>
<li>客户端收到fin后，进入time_wait状态，向服务器发送ack确认序号为收到序号+1，服务器进入closed状态，完成四次挥手</li>
</ul>
</li>
<li>服务器出现close_wait状态的原因<ul>
<li>服务器端未进行释放资源的操作</li>
<li>处理请求的线程配置不合理</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>UDP和TCP</p>
<ol>
<li><p>UDP</p>
<ul>
<li>特点<ul>
<li>面向非连接，不维护连接状态，支持同时向多个客户端传输相同的消息</li>
<li>数据包报头只有8个字节，额外开销小</li>
<li>吞吐量只受限于数据生成的速率，传输速率以及机器性能</li>
<li>尽最大努力交付，不保证交付的可靠性，不需要维持复杂的连接状态</li>
<li>面向报文，不对应用程序提交报文信息进行拆分合并</li>
</ul>
</li>
</ul>
</li>
<li><p>TCP和UDP对比</p>
<table>
<thead>
<tr>
<th></th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>TCP</td>
<td>1. 面向连接<br>2. 传输可靠<br>3. 传输有序</td>
<td>1. 传输速度慢<br>2. 重量级传输协议</td>
</tr>
<tr>
<td>UDP</td>
<td>1. 传输速度高<br>2. 轻量级传输协议</td>
<td>1. 面向无连接<br>2. 不保证可靠性<br>3. 不保证有序性</td>
</tr>
</tbody></table>
</li>
<li><p>TCP的滑动窗口</p>
<blockquote>
<p>TCP使用滑动窗口做流量控制与乱序重排</p>
</blockquote>
<ul>
<li>保证TCP的可靠性</li>
<li>保证TCP的流控特性</li>
</ul>
</li>
</ol>
</li>
</ol>
<h4 id="6-1-2-HTTP和HTTPS"><a href="#6-1-2-HTTP和HTTPS" class="headerlink" title="6.1.2 HTTP和HTTPS"></a>6.1.2 HTTP和HTTPS</h4><ol>
<li><p>HTTP</p>
<ul>
<li><p>特点</p>
<ul>
<li>支持客户和服务器模式</li>
<li>简单快速灵活</li>
<li>无连接，无状态</li>
</ul>
</li>
<li><p>步骤</p>
<ul>
<li>根据DNS解析的域名地址访问服务器</li>
<li>和服务器之间建立TCP连接(三次握手)</li>
<li>客户端发送HTTP请求到web服务器</li>
<li>服务器接收请求并返回HTTP报文</li>
<li>浏览器解析渲染页面</li>
<li>浏览器释放连接(四次挥手)</li>
</ul>
</li>
<li><p>状态码</p>
<ul>
<li>200：请求成功</li>
<li>401：未授权</li>
<li>403：服务被拒绝</li>
<li>404：未找到资源</li>
<li>500：服务器端错误，代码异常</li>
<li>503：服务器当前不能处理请求，需要等待，常见于服务启动尚未被注册中心发现。</li>
</ul>
</li>
<li><p>get和post的区别</p>
<table>
<thead>
<tr>
<th></th>
<th>get</th>
<th>post</th>
</tr>
</thead>
<tbody><tr>
<td>HTTP报文</td>
<td>将请求信息放在URL地址栏中</td>
<td>放在报文主体中</td>
</tr>
<tr>
<td>数据库</td>
<td>符合幂等性和安全性</td>
<td>不符合</td>
</tr>
<tr>
<td>其他</td>
<td>可以被缓存，被存储</td>
<td>不可以被缓存存储</td>
</tr>
</tbody></table>
</li>
<li><p>cookie和session的区别</p>
<ul>
<li>cookie保存在客户端浏览器相对不安全，大小为4k限制 </li>
<li>session保存在服务器端相对安全，借助于cookie实现，无大小限制</li>
</ul>
</li>
</ul>
</li>
<li><p>HTTPS</p>
<ul>
<li>加密<ul>
<li>对称加密：加密和解密都使用同一个密钥</li>
<li>非对称加密：加密使用的密钥和解密使用的密钥不同</li>
<li>哈希算法：将任意长度值的信息转换为固定长度的汉字，算法不可逆，常见的是MD5</li>
<li>数字签名：证明某个消息或者文件是某人发出/认同的</li>
</ul>
</li>
<li>HTTPS流程<ul>
<li>浏览器将支持的加密算法信息发送给服务器</li>
<li>服务器选择一套浏览器支持的加密算法，以证书的形式发送给浏览器</li>
<li>浏览器验证证书的合法性，并结合证书公钥加密信息发送给服务器</li>
<li>服务器使用私钥解密信息，验证哈希，加密响应消息发送给浏览器</li>
<li>浏览器解密响应消息，并对消息验证真假，之后进行加密交互数据</li>
</ul>
</li>
</ul>
</li>
<li><p>HTTP和HTTPS区别</p>
<table>
<thead>
<tr>
<th></th>
<th>HTTP</th>
<th>HTTPS</th>
</tr>
</thead>
<tbody><tr>
<td>证书</td>
<td>不需要CA证书</td>
<td>需要到CA申请证书</td>
</tr>
<tr>
<td>传输</td>
<td>明文传输</td>
<td>密文传输<br>使用HTTP+加密+认证+完整性保护</td>
</tr>
<tr>
<td>端口</td>
<td>使用80端口</td>
<td>使用443端口</td>
</tr>
</tbody></table>
</li>
</ol>
<h4 id="6-1-3-其他"><a href="#6-1-3-其他" class="headerlink" title="6.1.3 其他"></a>6.1.3 其他</h4><ol>
<li><p><code>socket</code></p>
<blockquote>
<p>是TCP/IP协议的抽象，是操作系统对外开放的接口</p>
</blockquote>
</li>
<li><p><code>Linux</code></p>
<ol>
<li>查找指定文件：<code>find path [options] params</code></li>
<li>查找符合条件的文本：<code>grep [options] pattern file</code></li>
<li>对文件内容进行统计：<code>awk [options] cmd file</code></li>
<li>批量替换文档内容：<code>sed [options] &#39;sed command&#39; filename</code></li>
</ol>
</li>
</ol>
<h3 id="6-2-Nginx"><a href="#6-2-Nginx" class="headerlink" title="6.2 Nginx"></a>6.2 Nginx</h3><ol>
<li><p>项目规模</p>
<ol>
<li>2-3人团队，用户量100-500</li>
<li>5-10人团队，用户量1000-10000</li>
<li>20-30人团队，用户量5w-50w</li>
<li>50-100人团队，用户量百万级</li>
<li>100+人团队，用户量千万级</li>
<li>1000+人团队，用户量亿级</li>
</ol>
</li>
<li><p>单体架构</p>
<ul>
<li>优点<ul>
<li>小团队即可完成开发</li>
<li>迭代周期短，开发速度快</li>
<li>打包方便，运维简单</li>
</ul>
</li>
<li>缺点<ul>
<li>单节点宕机造成所有服务不可用</li>
<li>耦合度太高(迭代，测试，部署)</li>
<li>单节点并发能力有限</li>
</ul>
</li>
</ul>
</li>
<li><p>集群</p>
<blockquote>
<p>多服务器共同实现同一个业务</p>
</blockquote>
<ol>
<li><p>特点</p>
<ol>
<li>计算器<strong>群体</strong>构成整个业务系统</li>
<li>这个<strong>群体</strong>构成一个整体，不能独立存在</li>
<li><strong>人多力量大</strong>，群体提升并发与可用性</li>
</ol>
</li>
<li><p>优点</p>
<ol>
<li>高性能</li>
<li>高可用</li>
<li>高扩展性</li>
</ol>
</li>
<li><p>TIP</p>
<ol>
<li><p>用户会话</p>
<blockquote>
<p>多个服务器之间会话不共享，所以要使用分布式会话</p>
</blockquote>
</li>
<li><p>定时任务</p>
<blockquote>
<p>所有的计算机节点，在定时时刻做一些通用事务</p>
</blockquote>
</li>
<li><p>内网互通是保持集群的前提</p>
</li>
</ol>
</li>
</ol>
</li>
<li><p>分布式</p>
<blockquote>
<p>每一个计算机节点都实现的业务不同</p>
</blockquote>
</li>
</ol>
<h4 id="6-2-1-Nginx入门"><a href="#6-2-1-Nginx入门" class="headerlink" title="6.2.1 Nginx入门"></a>6.2.1 Nginx入门</h4><ol>
<li><p>概述</p>
<blockquote>
<p>一个高性能的HTTP和反向代理的web服务器；也提供IMAP/POP3/SMTP服务 </p>
</blockquote>
</li>
<li><p>应用</p>
<ol>
<li>主要用于反向代理</li>
<li>静态资源部署</li>
</ol>
</li>
<li><p>正向代理</p>
<ol>
<li><p>用户请求–&gt;代理服务器–&gt;目标服务器；目标服务器–&gt;用户</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/03.%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86.png" alt="正向代理"></p>
</li>
</ol>
</li>
<li><p>反向代理</p>
<blockquote>
<p>用户请求目标服务器，由反向代理服务器决定访问那个目标资源IP</p>
</blockquote>
<ol>
<li><p>示意</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/04.%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.png" alt="反向代理"></p>
</li>
<li><p>官网</p>
<blockquote>
<p>nginx.org；选择stale version进行对应系统版本下载</p>
</blockquote>
</li>
</ol>
</li>
<li><p>Nginx进程模型</p>
<ol>
<li>master进程：主进程；主要用于管理一些worker进程</li>
<li>worker进程：工作进程</li>
</ol>
</li>
<li><p>worker抢占机制</p>
<blockquote>
<p>master主进程监听80端口，由一个master主进程fork了三个worker进程；三个worker进程会抢占一个accept_mutex(互斥锁)，这个锁和Client请求对应；那个worker抢到了accept_mutex锁，那个进程去处理用户请求</p>
</blockquote>
</li>
<li><p>事件处理</p>
<ol>
<li><p>传统方式</p>
<blockquote>
<p>同步阻塞请求模型</p>
</blockquote>
</li>
<li><p>nginx事件处理</p>
<blockquote>
<p>异步非阻塞模型；即多路复用器</p>
</blockquote>
</li>
</ol>
</li>
<li><p>Nginx配置文件</p>
<ol>
<li><p>配置结构</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/05.%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%84.png" alt="配置结构"></p>
</li>
<li><p>配置文件(由指令块组成)</p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># 工作进程worker的用户名称</span>
<span class="token attr-name">user</span> <span class="token attr-value"> nobody;</span>
<span class="token comment" spellcheck="true"># worker进程数目</span>
<span class="token attr-name">worker_processes</span> <span class="token attr-value"> 1;</span>

<span class="token comment" spellcheck="true"># 默认错误日志；路径 日志级别；nginx日志级别：debug，Info，notice，warn，error，crit</span>
<span class="token attr-name">error_log</span> <span class="token attr-value"> logs/error.log;</span>
<span class="token comment" spellcheck="true"># error_log  logs/error.log  notice;</span>
<span class="token comment" spellcheck="true">#error_log  logs/error.log  info;</span>

<span class="token comment" spellcheck="true"># nginx进程号</span>
<span class="token attr-name">pid</span> <span class="token attr-value">       logs/nginx.pid;</span>

<span class="token attr-name">events</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">    # 默认使用epoll</span>
<span class="token attr-name">    use</span> <span class="token attr-value">epoll;</span>
<span class="token comment" spellcheck="true">    # 每个worker允许连接的客户端最大连接数</span>
<span class="token attr-name">    worker_connections</span> <span class="token attr-value"> 1024;</span>
}

<span class="token attr-name">http</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">    # 包含的外部文件</span>
<span class="token attr-name">    include</span> <span class="token attr-value">      mime.types;</span>
<span class="token comment" spellcheck="true">    # 默认的type类型</span>
<span class="token attr-name">    default_type</span> <span class="token attr-value"> application/octet-stream;</span>

<span class="token comment" spellcheck="true">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span>
<span class="token comment" spellcheck="true">    #                  '$status $body_bytes_sent "$http_referer" '</span>
<span class="token comment" spellcheck="true">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</span>

<span class="token comment" spellcheck="true">    #access_log  logs/access.log  main;</span>

<span class="token comment" spellcheck="true">    # 用于文件的高效传输，默认打开</span>
<span class="token attr-name">    sendfile</span> <span class="token attr-value">       on;</span>
<span class="token comment" spellcheck="true">    # 配合sendfile进行高效传输，等数据包到一定大小在进行传输</span>
<span class="token attr-name">    tcp_nopush</span> <span class="token attr-value">    on;</span>

<span class="token comment" spellcheck="true">    # 客户端连接服务器的超时时间，以s为单位；keepalive_timeout  0;</span>
<span class="token attr-name">    keepalive_timeout</span> <span class="token attr-value"> 65;</span>

<span class="token comment" spellcheck="true">    # 使用gzip技术压缩，提高传输速率，节约带宽</span>
<span class="token attr-name">    gzip</span> <span class="token attr-value"> on;</span>
<span class="token comment" spellcheck="true">    # 限制最小压缩，小于1字节的不会被压缩</span>
<span class="token attr-name">    gzip_min_length</span> <span class="token attr-value">1;</span>
<span class="token comment" spellcheck="true">    # 定义压缩级别(即压缩比，文件越大，压缩越多，但是CPU使用会越多)；取值范围1-9</span>
<span class="token attr-name">    gzip_comp_level</span> <span class="token attr-value">3;</span>
<span class="token comment" spellcheck="true">    # 定义文件压缩的类型</span>
<span class="token attr-name">    gzip_types</span> <span class="token attr-value">text/plain application/javascript application/x-javascript text/css application/xml text/javascript application//x-httpd-php image/jpg image/gif image/png application/json</span>
<span class="token comment" spellcheck="true">    # 虚拟主机</span>
<span class="token attr-name">    server</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">        # 监听端口号</span>
<span class="token attr-name">        listen</span> <span class="token attr-value">      80;</span>
<span class="token comment" spellcheck="true">        # 监听的域名</span>
<span class="token attr-name">        server_name</span> <span class="token attr-value"> localhost;</span>

<span class="token comment" spellcheck="true">        #charset koi8-r;</span>

<span class="token comment" spellcheck="true">        #access_log  logs/host.access.log  main;</span>

<span class="token comment" spellcheck="true">        # 路由</span>
<span class="token attr-name">        location</span> <span class="token attr-value">/ {</span>
<span class="token attr-name">            root</span> <span class="token attr-value">  html;</span>
<span class="token attr-name">            index</span> <span class="token attr-value"> index.html index.htm;</span>
        }

<span class="token comment" spellcheck="true">        #error_page  404              /404.html;</span>

<span class="token comment" spellcheck="true">        # redirect server error pages to the static page /50x.html</span>
<span class="token comment" spellcheck="true">        # 默认错误页面</span>
<span class="token attr-name">        error_page</span> <span class="token attr-value">  500 502 503 504  /50x.html;</span>
<span class="token attr-name">        location</span> <span class="token punctuation">=</span> <span class="token attr-value">/50x.html {</span>
<span class="token attr-name">            root</span> <span class="token attr-value">  html;</span>
        }

<span class="token comment" spellcheck="true">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>
<span class="token comment" spellcheck="true">        #</span>
<span class="token comment" spellcheck="true">        #location ~ \.php$ {</span>
<span class="token comment" spellcheck="true">        #    proxy_pass   http://127.0.0.1;</span>
<span class="token comment" spellcheck="true">        #}</span>

<span class="token comment" spellcheck="true">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>
<span class="token comment" spellcheck="true">        #</span>
<span class="token comment" spellcheck="true">        #location ~ \.php$ {</span>
<span class="token comment" spellcheck="true">        #    root           html;</span>
<span class="token comment" spellcheck="true">        #    fastcgi_pass   127.0.0.1:9000;</span>
<span class="token comment" spellcheck="true">        #    fastcgi_index  index.php;</span>
<span class="token comment" spellcheck="true">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>
<span class="token comment" spellcheck="true">        #    include        fastcgi_params;</span>
<span class="token comment" spellcheck="true">        #}</span>

<span class="token comment" spellcheck="true">        # deny access to .htaccess files, if Apache's document root</span>
<span class="token comment" spellcheck="true">        # concurs with nginx's one</span>
<span class="token comment" spellcheck="true">        #</span>
<span class="token comment" spellcheck="true">        #location ~ /\.ht {</span>
<span class="token comment" spellcheck="true">        #    deny  all;</span>
<span class="token comment" spellcheck="true">        #}</span>
    }

<span class="token comment" spellcheck="true">    # another virtual host using mix of IP-, name-, and port-based configuration</span>
<span class="token comment" spellcheck="true">    #</span>
<span class="token comment" spellcheck="true">    #server {</span>
<span class="token comment" spellcheck="true">    #    listen       8000;</span>
<span class="token comment" spellcheck="true">    #    listen       somename:8080;</span>
<span class="token comment" spellcheck="true">    #    server_name  somename  alias  another.alias;</span>

<span class="token comment" spellcheck="true">    #    location / {</span>
<span class="token comment" spellcheck="true">    #        root   html;</span>
<span class="token comment" spellcheck="true">    #        index  index.html index.htm;</span>
<span class="token comment" spellcheck="true">    #    }</span>
<span class="token comment" spellcheck="true">    #}</span>

<span class="token comment" spellcheck="true">    # HTTPS server</span>
<span class="token comment" spellcheck="true">    #</span>
<span class="token comment" spellcheck="true">    #server {</span>
<span class="token comment" spellcheck="true">    #    listen       443 ssl;</span>
<span class="token comment" spellcheck="true">    #    server_name  localhost;</span>

<span class="token comment" spellcheck="true">    #    ssl_certificate      cert.pem;</span>
<span class="token comment" spellcheck="true">    #    ssl_certificate_key  cert.key;</span>

<span class="token comment" spellcheck="true">    #    ssl_session_cache    shared:SSL:1m;</span>
<span class="token comment" spellcheck="true">    #    ssl_session_timeout  5m;</span>

<span class="token comment" spellcheck="true">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span>
<span class="token comment" spellcheck="true">    #    ssl_prefer_server_ciphers  on;</span>

<span class="token comment" spellcheck="true">    #    location / {</span>
<span class="token comment" spellcheck="true">    #        root   html;</span>
<span class="token comment" spellcheck="true">    #        index  index.html index.htm;</span>
<span class="token comment" spellcheck="true">    #    }</span>
<span class="token comment" spellcheck="true">    #}</span>
}</code></pre>
</li>
</ol>
</li>
<li><p><code>nginx</code>命令</p>
<ol>
<li><code>./nginx -s stop</code>：暴力退出，无论此时nginx是否被响应，都予停止</li>
<li><code>./nginx -s quit</code>：优雅退出，停止分发新请求，已有连接完成传输时退出；适用于http协议</li>
<li><code>./nginx -t</code>：检测配置文件修改是否正确命令，正确则显示OK</li>
<li><code>./nginx -v</code>：小v，查看<code>nginx</code>版本号</li>
<li><code>./nginx -V</code>：大V，展示版本号，gcc编译环境等具体信息</li>
<li><code>./nginx -h</code>：查看帮助信息</li>
</ol>
</li>
<li><p>日志切割</p>
<ol>
<li><p>手动—创建如下<code>shell</code>脚本(放在/usr/local/nginx/sbin/目录下)</p>
<pre class=" language-shell"><code class="language-shell">#!/bin/bash
LOG_PATH="/var/log/nginx/"
RECORD_TIME=$(date -d "yesterday" +%Y-%m-%d+%H:%M)
PID=/var/run/nginx/nginx.pid
mv ${LOG_PATH}/access.log ${LOG_PATH}/access.${RECORD_TIME}.log
mv ${LOG_PATH}/error.log ${LOG_PATH}/error.${RECORD_TIME}.log
#向Nginx主进程发送信号，用于重新打开日志文件
kill -USR1 `cat $PID`</code></pre>
</li>
<li><p>自动</p>
<ol>
<li><p>安装插件</p>
<p><code>yum install crontabs</code></p>
</li>
<li><p>使用<code>crontabs -e</code>添加任务，使用<code>crontabs -l</code>查看任务</p>
<p><code>*/1 * * * * /usr/local/nginx/sbin/cut_my_log.sh</code></p>
</li>
<li><p>重启定时任务</p>
<p><code>service crond restart</code></p>
</li>
</ol>
</li>
<li><p>常用命令</p>
<pre class=" language-shell"><code class="language-shell">service crond start # 启动服务
service crond stop # 关闭服务
service crond restart # 重启服务
service crond reload # 重新载入配置
crontab -e # 编辑任务
crontab -l # 查看任务列表</code></pre>
</li>
<li><p>Cron表达式</p>
<table>
<thead>
<tr>
<th>项目</th>
<th>分</th>
<th>时</th>
<th>日</th>
<th>月</th>
<th>星期</th>
<th>年(可选)</th>
</tr>
</thead>
<tbody><tr>
<td>取值范围</td>
<td>0-59</td>
<td>0-23</td>
<td>1-31</td>
<td>1-12</td>
<td>1-7</td>
<td>2019/2020/2021</td>
</tr>
</tbody></table>
</li>
</ol>
</li>
<li><p>location匹配规则</p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># 空格 ：默认匹配，普通匹配</span>
<span class="token attr-name">location</span> <span class="token attr-value">/ {</span>
<span class="token attr-name">    root</span> <span class="token attr-value">/home;</span>
}

<span class="token comment" spellcheck="true"># = ：精确匹配</span>
<span class="token attr-name">location</span> <span class="token punctuation">=</span> <span class="token attr-value">/imooc/img/face1.png {</span>
<span class="token attr-name">    root</span> <span class="token attr-value">/home;</span>
}

<span class="token comment" spellcheck="true"># ~* ：匹配正则表达式，不区分大小写；符合图片的显示</span>
<span class="token attr-name">location</span> <span class="token attr-value">~ \.(GIF|jpg|png|jpeg) {</span>
<span class="token attr-name">    root</span> <span class="token attr-value">/home;</span>
}

<span class="token comment" spellcheck="true"># ~ ：匹配正则表达式，区分大小写；GIF必须大写才能匹配到</span>
<span class="token attr-name">location</span> <span class="token attr-value">~ \.(GIF|jpg|png|jpeg) {</span>
<span class="token attr-name">    root</span> <span class="token attr-value">/home;</span>
}

<span class="token comment" spellcheck="true"># ^~ ：以某个字符路径开头</span>
<span class="token attr-name">location</span> <span class="token attr-value">^~ /imooc/img {</span>
<span class="token attr-name">    root</span> <span class="token attr-value">/home;</span>
}</code></pre>
</li>
<li><p>Nginx跨域</p>
<blockquote>
<p>由于浏览器的同源策略限制，不同域名之间资源不共享。</p>
</blockquote>
<ol>
<li><p>CORS跨域资源共享</p>
<ol>
<li>cross origin resource sharing</li>
<li>允许浏览器进行跨域资源访问</li>
</ol>
</li>
<li><p>实现方式</p>
<ol>
<li><p>jsonp</p>
</li>
<li><p>SpringBoot Cors</p>
</li>
<li><p>Nginx</p>
<blockquote>
<p>服务器端不存在浏览器的同源策略限制(原理)</p>
</blockquote>
<p>实现</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">server</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">    # 监听端口号</span>
<span class="token attr-name">    listen</span> <span class="token attr-value">      80;</span>
<span class="token comment" spellcheck="true">    # 监听的域名</span>
<span class="token attr-name">    server_name</span> <span class="token attr-value"> localhost;</span>
<span class="token comment" spellcheck="true">    #允许跨域请求的域，*代表所有</span>
<span class="token attr-name">    add_header</span> <span class="token attr-value">'Access-Control-Allow-Origin' *;</span>
<span class="token comment" spellcheck="true">    #允许带上cookie请求</span>
<span class="token attr-name">    add_header</span> <span class="token attr-value">'Access-Control-Allow-Credentials' 'true';</span>
<span class="token comment" spellcheck="true">    #允许请求的方法，比如 GET/POST/PUT/DELETE</span>
<span class="token attr-name">    add_header</span> <span class="token attr-value">'Access-Control-Allow-Methods' *;</span>
<span class="token comment" spellcheck="true">    #允许请求的header</span>
<span class="token attr-name">    add_header</span> <span class="token attr-value">'Access-Control-Allow-Headers' *;</span>
}</code></pre>
</li>
</ol>
</li>
</ol>
</li>
<li><p>静态资源防盗链</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">server</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">    # 监听端口号</span>
<span class="token attr-name">    listen</span> <span class="token attr-value">      80;</span>
<span class="token comment" spellcheck="true">    # 监听的域名</span>
<span class="token attr-name">    server_name</span> <span class="token attr-value"> localhost;</span>
<span class="token comment" spellcheck="true">    #对源站点验证；非mjh一级域名下的网站资源不共享</span>
<span class="token attr-name">    valid_referers</span> <span class="token attr-value">*.mjh.com;</span>
<span class="token comment" spellcheck="true">    #非法引入会进入下方判断</span>
<span class="token attr-name">    if</span> <span class="token attr-value">($invalid_referer) {</span>
<span class="token attr-name">        return</span> <span class="token attr-value">404;</span>
    }
}</code></pre>
</li>
<li><p>Nginx模块体系</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/06.Nginx%E6%A8%A1%E5%9D%97%E4%BD%93%E7%B3%BB.png" alt="Nginx模块体系"></p>
</li>
</ol>
<h4 id="6-2-2-Nginx集群与负载均衡"><a href="#6-2-2-Nginx集群与负载均衡" class="headerlink" title="6.2.2 Nginx集群与负载均衡"></a>6.2.2 Nginx集群与负载均衡</h4><ol>
<li><p>概述</p>
<blockquote>
<p>通过配置文件即可实现集群和负载均衡</p>
</blockquote>
</li>
<li><p><font color="red">负载均衡</font></p>
<ol>
<li><p>四层负载均衡</p>
<ul>
<li>F5：硬负载均衡</li>
<li>LVS：四层负载均衡</li>
<li>Haproxy：四层负载均衡</li>
<li>Nginx：四层负载均衡</li>
</ul>
</li>
<li><p>七层负载均衡</p>
<ul>
<li>Nginx：七层负载均衡</li>
<li>Haproxy：七层负载均衡</li>
<li>Apache：七层负载均衡</li>
</ul>
</li>
<li><p>DNS地域负载均衡</p>
<blockquote>
<p>通过DNS服务器处理，采取就近原则进行访问</p>
</blockquote>
</li>
</ol>
</li>
<li><p>Nginx搭建Tomcat集群</p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># 配置上游服务器</span>
<span class="token attr-name">upstream</span> <span class="token attr-value">tomcats {</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.171;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.172;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.173;</span>
}

<span class="token comment" spellcheck="true"># 配置Nginx代理</span>
<span class="token attr-name">server</span> <span class="token attr-value">{</span>
<span class="token attr-name">    listen</span> <span class="token attr-value">80;</span>
<span class="token attr-name">    server_name</span> <span class="token attr-value">www.tomcats.com;</span>

<span class="token attr-name">    location</span> <span class="token attr-value">/ {</span>
<span class="token attr-name">        proxy_pass</span> <span class="token attr-value">http://tomcats;</span>
    }
}</code></pre>
</li>
<li><p>使用JMeter测试单机和集群的并发异常率</p>
<ol>
<li><p>单机版5000次并发访问数据</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/07.%E5%8D%95%E6%9C%BA%E7%89%885000%E6%AC%A1%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE.png" alt="单机版5000次并发访问数据"></p>
</li>
<li><p>单机版2w次并发访问数据</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/08.%E5%8D%95%E6%9C%BA%E7%89%8820000%E6%AC%A1%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE.png" alt="单机版20000次并发访问数据"></p>
</li>
<li><p>集群(2台内网Tomcat)并发访问数据</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/09.%E9%9B%86%E7%BE%A4%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE.png" alt="集群并发访问数据"></p>
</li>
</ol>
</li>
<li><p>负载均衡策略</p>
<ol>
<li><p>轮询</p>
<blockquote>
<p>Tomcat集群默认的负载均衡策略：将浏览器请求平均的分配到每一台服务器上(针对服务器配置相同时)</p>
</blockquote>
<ul>
<li><p>加权轮训</p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># 配置上游服务器</span>
<span class="token attr-name">upstream</span> <span class="token attr-value">tomcats {</span>
<span class="token comment" spellcheck="true">    # weight为权值指令，默认值是1，值越大，分发的请求越多</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.171 weight=1;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.172 weight=2;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.173 weight=5;</span>
}</code></pre>
</li>
</ul>
</li>
<li><p><code>upstream</code>指令参数</p>
<ul>
<li><code>max_conns</code>：限制服务器的最大连接数；默认值是0，表示不做任何限制；最大值是10</li>
<li><code>slow_start</code>：使服务器缓慢的加入集群，体现在该服务器的权值变化(<code>0-&gt;max</code>)[商业版本才支持的参数]</li>
<li><code>down</code>：用于标识该服务器处于不可用的状态，即用户不能访问该服务器的资源</li>
<li><code>backup</code>：标识该服务器是一台备用机，集群中所有服务器都正常时不会访问该服务器；当集群中的所有服务器挂掉了，才会被用户访问到</li>
<li><code>max_fails</code>：最大的失败次数，如果达到该值，则认为该服务器宕机</li>
<li><code>fail_timeout</code>：失败的时间段，达到该时间值，则认为该服务器宕机</li>
<li><code>max_fails</code>和<code>fail_timeout</code>组合使用，在满足时间值的前提上达到指定次数，认为该服务器宕机</li>
</ul>
</li>
<li><p><code>keepalive</code></p>
<blockquote>
<p>提高吞吐量</p>
</blockquote>
<ul>
<li><p>把所有连接作为一个长连接</p>
</li>
<li><p>配置</p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># 使用keepalive配置长连接</span>
<span class="token attr-name">upstream</span> <span class="token attr-value">tomcats {</span>
<span class="token comment" spellcheck="true">    # weight为权值指令，默认值是1，值越大，分发的请求越多</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.171 weight=1;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.172 weight=2;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.173 weight=5;</span>

<span class="token attr-name">    keepalive</span> <span class="token attr-value">32;</span>
}

<span class="token attr-name">server</span> <span class="token attr-value">{</span>
<span class="token attr-name">    listen</span> <span class="token attr-value">80;</span>
<span class="token attr-name">    server_name</span> <span class="token attr-value">www.tomcats.com;</span>

<span class="token attr-name">    location</span> <span class="token attr-value">/ {</span>
<span class="token attr-name">        proxy_pass</span> <span class="token attr-value">http://tomcats;</span>

<span class="token attr-name">        proxy_http_version</span> <span class="token attr-value">1.1;</span>
<span class="token attr-name">        proxy_set_header</span> <span class="token attr-value">Connection "";</span>
    }
}</code></pre>
</li>
</ul>
</li>
<li><p><code>ip-hash</code></p>
<blockquote>
<p>根据用户请求的IP由hash函数计算一个hash值，然后根据这个值分发到特定的服务器上；保证同一用户的多次请求session是一致的(后端某个服务器和IP计算的特定hash值相同)</p>
</blockquote>
<p><strong>hash算法原理：</strong></p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/10.hash%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86.png" alt="hash算法原理"></p>
<ul>
<li>说明<ul>
<li><code>node_counts</code>：当前集群的节点总数</li>
<li><code>index</code>：服务器对应的索引值</li>
</ul>
</li>
<li>配置</li>
</ul>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># 配置上游服务器</span>
<span class="token attr-name">upstream</span> <span class="token attr-value">tomcats {</span>
    ip_hash;
<span class="token comment" spellcheck="true">    # weight为权值指令，默认值是1，值越大，分发的请求越多</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.171;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.172;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.173;</span>
}

<span class="token attr-name">server</span> <span class="token attr-value">{</span>
<span class="token attr-name">    listen</span> <span class="token attr-value">80;</span>
<span class="token attr-name">    server_name</span> <span class="token attr-value">Nginx服务器IP;</span>

<span class="token attr-name">    location</span> <span class="token attr-value">/ {</span>
<span class="token attr-name">        proxy_pass</span> <span class="token attr-value">http://tomcats;</span>
    }
}</code></pre>
<ul>
<li><p>Hash算法存在问题</p>
<blockquote>
<p>当集群中有一台服务器宕机，所有IP地址对应的Hash值都有会发生变化，进而导致Session改变</p>
</blockquote>
</li>
<li><p>解决—(一致性Hash算法)</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/11.%E4%B8%80%E8%87%B4%E6%80%A7Hash%E7%AE%97%E6%B3%95.png" alt="一致性Hash算法"></p>
</li>
<li><p>服务器宕机情况</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/12.%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%95%E6%9C%BA%E6%83%85%E5%86%B5.png" alt="服务器宕机情况"></p>
<p>只有访问在已经宕机的服务器的用户<code>Session</code>会丢失，其他用户的<code>Session</code>不受影响</p>
</li>
<li><p>集群新增服务器</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/13.%E9%9B%86%E7%BE%A4%E6%96%B0%E5%A2%9E%E6%9C%8D%E5%8A%A1%E5%99%A8.png" alt="集群新增服务器"></p>
<p>只有计算在新增服务器上的用户<code>Session</code>会发生变化，其他用户的<code>Session</code>依然不变</p>
</li>
</ul>
</li>
<li><p>负载均衡原理</p>
<ol>
<li><p>ip_hash：<code>hash(url)%node_counts = index</code></p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># 配置上游服务器</span>
<span class="token attr-name">upstream</span> <span class="token attr-value">tomcats {</span>
<span class="token attr-name">    hash</span> <span class="token attr-value">$request_uri;</span>

<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.171;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.172;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.173;</span>
}</code></pre>
</li>
<li><p>least_conn：将请求分配给集群中连接数最小的服务器</p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># 配置上游服务器</span>
<span class="token attr-name">upstream</span> <span class="token attr-value">tomcats {</span>
    least_conn;

<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.171;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.172;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.173;</span>
}</code></pre>
</li>
</ol>
</li>
</ol>
</li>
<li><p>Nginx控制浏览器缓存</p>
<ol>
<li><p>静态资源缓存策略</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/14.%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5.png" alt="静态资源缓存策略"></p>
</li>
<li><p>Nginx设置浏览器缓存过期时间</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">server</span> <span class="token attr-value">{</span>
<span class="token attr-name">    listen</span> <span class="token attr-value">80;</span>
<span class="token attr-name">    server_name</span> <span class="token attr-value">Nginx服务器IP;</span>

<span class="token attr-name">    location</span> <span class="token attr-value">/static {</span>
<span class="token comment" spellcheck="true">        # 为static资源设置别名</span>
<span class="token attr-name">        alias</span> <span class="token attr-value">/home/mjh;</span>
<span class="token comment" spellcheck="true">        # 形式一：设置浏览器的缓存过期时间，10s之后过期</span>
<span class="token attr-name">        expires</span> <span class="token attr-value">10s;</span>
<span class="token comment" spellcheck="true">        # 形式二：设置浏览器的缓存过期时间，晚上10:30之后过期</span>
<span class="token attr-name">        expires</span> <span class="token attr-value">@22h30m;</span>
    }
}</code></pre>
<table>
<thead>
<tr>
<th>项目</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>expires [time]</code></td>
<td>在该时间后过期</td>
</tr>
<tr>
<td><code>expires @[time]</code></td>
<td>在该时间点过期</td>
</tr>
<tr>
<td><code>expires -[time]</code></td>
<td>在该时间之前过期</td>
</tr>
<tr>
<td><code>expires off</code></td>
<td>关闭浏览器的默认缓存机制</td>
</tr>
<tr>
<td><code>expires max</code></td>
<td>设置缓存永不过期</td>
</tr>
</tbody></table>
<ol>
<li>Nginx缓存路径设置</li>
</ol>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># proxy_cache_path</span>
<span class="token comment" spellcheck="true">#     keys_zone 设置共享内以及占用的空间大小</span>
<span class="token comment" spellcheck="true">#     max_size 设置缓存大小</span>
<span class="token comment" spellcheck="true">#     inactive 超过此时间，则自动清理缓存</span>
<span class="token comment" spellcheck="true">#     use_temp_path 关闭临时目录</span>
<span class="token attr-name">proxy_cache_path</span> <span class="token attr-value">/usr/local/nginx/upstream_cache keys_zone=mycache:5m max_size=1g inactive=1m use_temp_path=0ff</span>

<span class="token attr-name">server</span> <span class="token attr-value">{</span>
<span class="token attr-name">    listen</span> <span class="token attr-value">80;</span>
<span class="token attr-name">    server_name</span> <span class="token attr-value">Nginx服务器IP;</span>

<span class="token comment" spellcheck="true">    # 开启并且使用缓存</span>
<span class="token attr-name">    proxy_cache</span> <span class="token attr-value">mycache;</span>
<span class="token comment" spellcheck="true">    # 设置200和304状态码的过期时间</span>
<span class="token attr-name">    procy_cache_valid</span> <span class="token attr-value">200 204 8h;</span>
}</code></pre>
</li>
</ol>
</li>
<li><p>Nginx配置https域名证书</p>
<ol>
<li><p>安装SSL模块(http_ssl_module)</p>
<ul>
<li><p>进入到nginx的解压目录： /home/software/nginx-1.16.1新增http_ssl_module模块</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">./configure</span> <span class="token attr-value">\
--prefix=/usr/local/nginx \
--pid-path=/var/run/nginx/nginx.pid \
--lock-path=/var/lock/nginx.lock \
--error-log-path=/var/log/nginx/error.log \
--http-log-path=/var/log/nginx/access.log \
--with-http_gzip_static_module \
--http-client-body-temp-path=/var/temp/nginx/client \
--http-proxy-temp-path=/var/temp/nginx/proxy \
--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \
--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \
--http-scgi-temp-path=/var/temp/nginx/scgi \
--with-http_ssl_module</span></code></pre>
</li>
<li><p>编译安装</p>
<pre class=" language-shell"><code class="language-shell">make
make install</code></pre>
</li>
<li><p>检测是否安装SSL成功</p>
<pre class=" language-shell"><code class="language-shell">../sbin/nginx/ -V
# 结果会有--with-http_ssl_module出现</code></pre>
</li>
</ul>
</li>
<li><p>配置HTTPS</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">server</span> <span class="token attr-value">{</span>
<span class="token attr-name">    listen</span> <span class="token attr-value">443;</span>
<span class="token attr-name">    server_name</span> <span class="token attr-value">www.imoocdsp.com;</span>
<span class="token comment" spellcheck="true">    # 开启ssl</span>
<span class="token attr-name">    ssl</span> <span class="token attr-value">on;</span>
<span class="token comment" spellcheck="true">    # 配置ssl证书</span>
<span class="token attr-name">    ssl_certificate</span> <span class="token attr-value">1_www.imoocdsp.com_bundle.crt;</span>
<span class="token comment" spellcheck="true">    # 配置证书秘钥</span>
<span class="token attr-name">    ssl_certificate_key</span> <span class="token attr-value">2_www.imoocdsp.com.key;</span>
<span class="token comment" spellcheck="true">    # ssl会话cache</span>
<span class="token attr-name">    ssl_session_cache</span> <span class="token attr-value">shared:SSL:1m;</span>
<span class="token comment" spellcheck="true">    # ssl会话超时时间</span>
<span class="token attr-name">    ssl_session_timeout</span> <span class="token attr-value">5m;</span>
<span class="token comment" spellcheck="true">    # 配置加密套件，写法遵循 openssl 标准</span>
<span class="token attr-name">    ssl_protocols</span> <span class="token attr-value">TLSv1 TLSv1.1 TLSv1.2;</span>
<span class="token attr-name">    ssl_ciphers</span> <span class="token attr-value">ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span>
<span class="token attr-name">    ssl_prefer_server_ciphers</span> <span class="token attr-value">on;</span>
<span class="token attr-name">    location</span> <span class="token attr-value">/ {</span>
<span class="token attr-name">        proxy_pass</span> <span class="token attr-value">http://tomcats/;</span>
<span class="token attr-name">        index</span> <span class="token attr-value">index.html index.htm;</span>
    }
}</code></pre>
</li>
</ol>
</li>
<li><p>动静分离</p>
<blockquote>
<p>本质是分布式的</p>
</blockquote>
<ul>
<li>特点<ul>
<li>前后端解耦</li>
<li>静态部署Nginx</li>
<li>接口服务化</li>
</ul>
</li>
<li>静态数据：css/js/html/image/videos/audios</li>
<li>动态数据：得到的响应会和上一次不同</li>
<li>动静分离的方式CDN(内容分发网络)</li>
<li>动静分离的方式Nginx</li>
<li>存在问题<ul>
<li>跨域资源访问异常(解决)<ul>
<li>Springboot</li>
<li>Nginx</li>
<li>jsonp</li>
</ul>
</li>
<li>分布式会话非同一个会话对象(解决)<ul>
<li>分布式缓存Redis</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="6-2-3-Nginx应用"><a href="#6-2-3-Nginx应用" class="headerlink" title="6.2.3 Nginx应用"></a>6.2.3 Nginx应用</h4><ol>
<li><p>下载安装Nginx</p>
</li>
<li><p>配置反向代理</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">upstream</span> <span class="token attr-value">api.mjhcode.com {</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.171;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.172;</span>
<span class="token attr-name">    server</span> <span class="token attr-value">192.168.1.173;</span>
}

<span class="token attr-name">server</span> <span class="token attr-value">{</span>
<span class="token attr-name">    listen</span> <span class="token attr-value">80;</span>
<span class="token attr-name">    server_name</span> <span class="token attr-value">api.mjhcode.com;</span>
<span class="token attr-name">    location</span> <span class="token attr-value">~ {</span>
<span class="token attr-name">        proxy_pass</span> <span class="token attr-value">http://api.mjhcode.com;</span>
    }
}</code></pre>
</li>
<li><p>作用</p>
<ol>
<li>负载均衡(Tomcat集群)</li>
<li>网关</li>
<li>反向代理(Tomcat集群)</li>
<li>动静分离</li>
</ol>
</li>
</ol>
<h4 id="6-2-4-Nginx高可用"><a href="#6-2-4-Nginx高可用" class="headerlink" title="6.2.4 Nginx高可用"></a>6.2.4 Nginx高可用</h4><blockquote>
<p>解决单台Nginx服务器宕机故障，用于构建Nginx集群。</p>
</blockquote>
<ol>
<li><p>Keepalived</p>
<blockquote>
<p>实现服务器端的集群控制，主要用在Nginx上</p>
</blockquote>
<ul>
<li>特点<ol>
<li>解决单点故障</li>
<li>组件免费</li>
<li>实现高可用的HA机制</li>
<li>基于VRRP协议<ul>
<li>虚拟路由冗余协议</li>
<li>解决网络单机故障的路由协议</li>
<li>构建有多个路由器master backup</li>
<li>虚拟ip-vip</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li><p>Keepalived双机主备原理</p>
<blockquote>
<p>主，备机之间的物理配置必须保持一致</p>
</blockquote>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/15.Keepalived%E5%8F%8C%E6%9C%BA%E4%B8%BB%E5%A4%87%E5%8E%9F%E7%90%86.png" alt="Keepalived双机主备原理"></p>
</li>
<li><p>keepAlived配置</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">global_defs</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">    # 路由id：当前安装keepalived的节点主机标识符，保证全局唯一(主备不同的地方)</span>
<span class="token comment" spellcheck="true">    # 虚拟ip映射的真实ip</span>
<span class="token attr-name">    router_id</span> <span class="token attr-value">keep_171</span>
}
<span class="token attr-name">vrrp_instance</span> <span class="token attr-value">VI_1 {</span>
<span class="token comment" spellcheck="true">    # 表示状态是MASTER主机还是备用机BACKUP(主备不同的地方)</span>
<span class="token attr-name">    state</span> <span class="token attr-value">MASTER</span>
<span class="token comment" spellcheck="true">    # 该实例绑定的网卡</span>
<span class="token attr-name">    interface</span> <span class="token attr-value">ens33</span>
<span class="token comment" spellcheck="true">    # 保证主备节点一致即可</span>
<span class="token attr-name">    virtual_router_id</span> <span class="token attr-value">51</span>
<span class="token comment" spellcheck="true">    # 权重，master权重一般高于backup，如果有多个，那就是选举，谁的权重高，谁就当选</span>
<span class="token comment" spellcheck="true">    # (主备不同的地方)</span>
<span class="token attr-name">    priority</span> <span class="token attr-value">100</span>
<span class="token comment" spellcheck="true">    # 主备之间同步检查时间间隔，单位秒</span>
<span class="token attr-name">    advert_int</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">    # 认证权限密码，防止非法节点进入</span>
<span class="token attr-name">    authentication</span> <span class="token attr-value">{</span>
<span class="token attr-name">        auth_type</span> <span class="token attr-value">PASS</span>
<span class="token attr-name">        auth_pass</span> <span class="token attr-value">1111</span>
    }
<span class="token comment" spellcheck="true">    # 虚拟出来的ip，可以有多个（vip）；用户访问的IP地址</span>
<span class="token attr-name">    virtual_ipaddress</span> <span class="token attr-value">{</span>
        192.168.1.161
    }
}</code></pre>
</li>
<li><p>keepAlived注册为系统服务</p>
<ol>
<li><p>进入到keepAlived解压后的目录中，再进入keepAlived目录，递进到etc目下会有两个文件<code>init.d</code>和<code>sysconfig</code></p>
</li>
<li><p>执行拷贝命令</p>
<p><code>cp init.d/keepalived etc/intit.d/</code></p>
<p><code>cp sysconfig/keepalived etc/sysconfig/</code></p>
</li>
<li><p>刷新系统配置</p>
<p><code>systemctl deamon-reload</code></p>
</li>
<li><p>操作keepAlived</p>
<pre class=" language-shell"><code class="language-shell"># 启动
systemctl start keepalived.service
# 停止
systemctl stop keepalived.service
# 重启
systemctl restart keepalived.service</code></pre>
</li>
</ol>
</li>
<li><p>配置Nginx自动重启</p>
<pre class=" language-shell"><code class="language-shell">#!/bin/bash
A=`ps -C nginx --no-header |wc -l`
# 判断nginx是否宕机，如果宕机了，尝试重启
if [ $A -eq 0 ];then
    /usr/local/nginx/sbin/nginx
    # 等待一小会再次检查nginx，如果没有启动成功，则停止keepalived，使其启动备用机
    sleep 3
    if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then
        killall keepalived
    fi
fi</code></pre>
<ul>
<li><p>增加运行权限</p>
<p><code>chmod +x /etc/keepalived/check_nginx_alive_or_not.sh</code></p>
</li>
</ul>
</li>
<li><p>为keepalived配置增加Nginx监听</p>
<pre class=" language-shell"><code class="language-shell">vrrp_script check_nginx_alive {
    script "/etc/keepalived/check_nginx_alive_or_not.sh"
    interval 2 # 每隔两秒运行上一行脚本
    weight 10 # 如果脚本运行失败，则升级权重+10
}

vrrp_instance VI_1 {
    # 监听运行vrrp_script脚本
    track_script {
        check_nginx_alive # 追踪 nginx 脚本
    }
}</code></pre>
</li>
<li><p>keepalived双主热备原理</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/16.keepalived%E5%8F%8C%E4%B8%BB%E7%83%AD%E5%A4%87%E5%8E%9F%E7%90%86.png" alt="keepalived双主热备原理"></p>
<ul>
<li><p>在多台服务器的keepalived配置文件中互相配置master和backup信息</p>
<blockquote>
<p>注意主节点和对应的备用节点的虚拟ip是相互对应的</p>
</blockquote>
</li>
</ul>
</li>
<li><p>操作流程</p>
<ol>
<li>上传keepAlived</li>
<li>进入./configure目录</li>
<li>make</li>
<li>make install</li>
<li>/etc/keepalived</li>
<li>把keepAlived注册到系统服务</li>
</ol>
</li>
</ol>
<h4 id="6-2-5-LVS-负载均衡器"><a href="#6-2-5-LVS-负载均衡器" class="headerlink" title="6.2.5 LVS(负载均衡器)"></a>6.2.5 LVS(负载均衡器)</h4><ol>
<li><p>概述(Linux Virtual Server)</p>
<blockquote>
<p>一个Linux操作系统上的虚拟服务；负载均衡项目</p>
</blockquote>
</li>
<li><p>流程图</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/17.LVS%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.png" alt="LVS负载均衡"></p>
</li>
<li><p>LVS+Nginx组合</p>
<ol>
<li>LVS基于四层，工作效率高</li>
<li>单个Nginx承受不不住压力，需要集群</li>
<li>LVS充当集群的调度者</li>
<li>Nginx接受请求来回，LVS可以只接受不响应</li>
</ol>
</li>
<li><p>LVS模式</p>
<ol>
<li><p>NAT</p>
<blockquote>
<p>基于网络地址的转发</p>
</blockquote>
</li>
<li><p>TUN</p>
<blockquote>
<p>IP隧道</p>
</blockquote>
</li>
<li><p>DR模式</p>
<blockquote>
<p>直接路由</p>
</blockquote>
</li>
</ol>
</li>
<li><p>ARP</p>
<ol>
<li>arp-ignore：ARP响应级别(处理请求)<ol>
<li><code>0</code>：只要本机配置了ip，就能响应请求</li>
<li><code>1</code>：请求的目标地址达到对应的网络接口，才会响应请求</li>
</ol>
</li>
<li>arp-announce：ARP通告行为(返回响应)<ol>
<li><code>0</code>：本机上任何网路接口都向外通告，所有的网卡都能接受到通告</li>
<li><code>1</code>：尽可能避免本网卡与不匹配的目标进行通告</li>
<li><code>2</code>：只在本网卡通告</li>
</ol>
</li>
</ol>
</li>
<li><p>使用pvsadm配置集群规则</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/18.pvsadm%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%99.png" alt="pvsadm配置集群规则"></p>
</li>
<li><p>LVS持久化机制</p>
</li>
<li><p>keepAlived+LVS+Nginx配置master</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">global_defs</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">    # 路由id：当前安装keepalived的节点主机标识符，保证全局唯一(主备不同的地方)</span>
<span class="token comment" spellcheck="true">    # 虚拟ip映射的真实ip</span>
<span class="token attr-name">    router_id</span> <span class="token attr-value">LVS_151</span>
}
<span class="token attr-name">vrrp_instance</span> <span class="token attr-value">VI_1 {</span>
<span class="token comment" spellcheck="true">    # 表示状态是MASTER主机还是备用机BACKUP(主备不同的地方)</span>
<span class="token attr-name">    state</span> <span class="token attr-value">MASTER</span>
<span class="token comment" spellcheck="true">    # 该实例绑定的网卡</span>
<span class="token attr-name">    interface</span> <span class="token attr-value">ens33</span>
<span class="token comment" spellcheck="true">    # 保证主备节点一致即可</span>
<span class="token attr-name">    virtual_router_id</span> <span class="token attr-value">51</span>
<span class="token comment" spellcheck="true">    # 权重，master权重一般高于backup，如果有多个，那就是选举，谁的权重高，谁就当选</span>
<span class="token comment" spellcheck="true">    # (主备不同的地方)</span>
<span class="token attr-name">    priority</span> <span class="token attr-value">100</span>
<span class="token comment" spellcheck="true">    # 主备之间同步检查时间间隔，单位秒</span>
<span class="token attr-name">    advert_int</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">    # 认证权限密码，防止非法节点进入</span>
<span class="token attr-name">    authentication</span> <span class="token attr-value">{</span>
<span class="token attr-name">        auth_type</span> <span class="token attr-value">PASS</span>
<span class="token attr-name">        auth_pass</span> <span class="token attr-value">1111</span>
    }
<span class="token comment" spellcheck="true">    # 虚拟出来的ip，可以有多个（vip）；用户访问的IP地址</span>
<span class="token attr-name">    virtual_ipaddress</span> <span class="token attr-value">{</span>
        192.168.1.150
    }
}

<span class="token comment" spellcheck="true"># 配置集群地址访问的IP+端口，端口和nginx保持一致，都是80</span>
<span class="token attr-name">virtual_server</span> <span class="token attr-value">192.168.1.150 80 {</span>
<span class="token comment" spellcheck="true">    # 健康检查的时间，单位：秒</span>
<span class="token attr-name">    delay_loop</span> <span class="token attr-value">6</span>
<span class="token comment" spellcheck="true">    # 配置负载均衡的算法，默认是轮询</span>
<span class="token attr-name">    lb_algo</span> <span class="token attr-value">rr</span>
<span class="token comment" spellcheck="true">    # 设置LVS的模式，NAT|TUN|DR</span>
<span class="token attr-name">    lb_kind</span> <span class="token attr-value">DR</span>
<span class="token comment" spellcheck="true">    # 设置会话持久化的时间</span>
<span class="token attr-name">    persistence_timeout</span> <span class="token attr-value">5</span>
<span class="token comment" spellcheck="true">    # 协议 -t</span>
<span class="token attr-name">    protocol</span> <span class="token attr-value">TCP</span>

<span class="token comment" spellcheck="true">    # 负载均衡的真实服务器，也就是nginx节点的具体ip地址</span>
<span class="token attr-name">    real_server</span> <span class="token attr-value">192.168.1.171 80 {</span>
<span class="token comment" spellcheck="true">        # 轮询的默认权重配比设置为1</span>
<span class="token attr-name">        weight</span> <span class="token attr-value">1</span>
<span class="token comment" spellcheck="true">        # 健康检查</span>
<span class="token attr-name">        TCP_CHECK</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">            # 检查的80端口</span>
<span class="token attr-name">            connect_port</span> <span class="token attr-value">80</span>
<span class="token comment" spellcheck="true">            # 超时时间 2s</span>
<span class="token attr-name">            connect_timeout</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">            # 重试次数 2次</span>
<span class="token attr-name">            nb_get_retry</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">            # 间隔时间 3s</span>
<span class="token attr-name">            delay_before_retry</span> <span class="token attr-value">3</span>
        }
    }

<span class="token attr-name">    real_server</span> <span class="token attr-value">192.168.1.172 80 {</span>
<span class="token attr-name">        weight</span> <span class="token attr-value">1</span>
<span class="token comment" spellcheck="true">        # 健康检查</span>
<span class="token attr-name">        TCP_CHECK</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">            # 检查的80端口</span>
<span class="token attr-name">            connect_port</span> <span class="token attr-value">80</span>
<span class="token comment" spellcheck="true">            # 超时时间 2s</span>
<span class="token attr-name">            connect_timeout</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">            # 重试次数 2次</span>
<span class="token attr-name">            nb_get_retry</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">            # 间隔时间 3s</span>
<span class="token attr-name">            delay_before_retry</span> <span class="token attr-value">3</span>
        }
    }
}</code></pre>
</li>
<li><p>keepAlived+LVS+Nginx配置backup</p>
<pre class=" language-properties"><code class="language-properties"><span class="token attr-name">global_defs</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">    # 路由id：当前安装keepalived的节点主机标识符，保证全局唯一(主备不同的地方)</span>
<span class="token comment" spellcheck="true">    # 虚拟ip映射的真实ip</span>
<span class="token attr-name">    router_id</span> <span class="token attr-value">LVS_152</span>
}
<span class="token attr-name">vrrp_instance</span> <span class="token attr-value">VI_1 {</span>
<span class="token comment" spellcheck="true">    # 表示状态是MASTER主机还是备用机BACKUP(主备不同的地方)</span>
<span class="token attr-name">    state</span> <span class="token attr-value">BACKUP</span>
<span class="token comment" spellcheck="true">    # 该实例绑定的网卡</span>
<span class="token attr-name">    interface</span> <span class="token attr-value">ens33</span>
<span class="token comment" spellcheck="true">    # 保证主备节点一致即可</span>
<span class="token attr-name">    virtual_router_id</span> <span class="token attr-value">51</span>
<span class="token comment" spellcheck="true">    # 权重，master权重一般高于backup，如果有多个，那就是选举，谁的权重高，谁就当选</span>
<span class="token comment" spellcheck="true">    # (主备不同的地方)</span>
<span class="token attr-name">    priority</span> <span class="token attr-value">50</span>
<span class="token comment" spellcheck="true">    # 主备之间同步检查时间间隔，单位秒</span>
<span class="token attr-name">    advert_int</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">    # 认证权限密码，防止非法节点进入</span>
<span class="token attr-name">    authentication</span> <span class="token attr-value">{</span>
<span class="token attr-name">        auth_type</span> <span class="token attr-value">PASS</span>
<span class="token attr-name">        auth_pass</span> <span class="token attr-value">1111</span>
    }
<span class="token comment" spellcheck="true">    # 虚拟出来的ip，可以有多个（vip）；用户访问的IP地址</span>
<span class="token attr-name">    virtual_ipaddress</span> <span class="token attr-value">{</span>
        192.168.1.150
    }
}

<span class="token comment" spellcheck="true"># 配置集群地址访问的IP+端口，端口和nginx保持一致，都是80</span>
<span class="token attr-name">virtual_server</span> <span class="token attr-value">192.168.1.150 80 {</span>
<span class="token comment" spellcheck="true">    # 健康检查的时间，单位：秒</span>
<span class="token attr-name">    delay_loop</span> <span class="token attr-value">6</span>
<span class="token comment" spellcheck="true">    # 配置负载均衡的算法，默认是轮询</span>
<span class="token attr-name">    lb_algo</span> <span class="token attr-value">rr</span>
<span class="token comment" spellcheck="true">    # 设置LVS的模式，NAT|TUN|DR</span>
<span class="token attr-name">    lb_kind</span> <span class="token attr-value">DR</span>
<span class="token comment" spellcheck="true">    # 设置会话持久化的时间</span>
<span class="token attr-name">    persistence_timeout</span> <span class="token attr-value">5</span>
<span class="token comment" spellcheck="true">    # 协议 -t</span>
<span class="token attr-name">    protocol</span> <span class="token attr-value">TCP</span>

<span class="token comment" spellcheck="true">    # 负载均衡的真实服务器，也就是nginx节点的具体ip地址</span>
<span class="token attr-name">    real_server</span> <span class="token attr-value">192.168.1.171 80 {</span>
<span class="token comment" spellcheck="true">        # 轮询的默认权重配比设置为1</span>
<span class="token attr-name">        weight</span> <span class="token attr-value">1</span>
<span class="token comment" spellcheck="true">        # 健康检查</span>
<span class="token attr-name">        TCP_CHECK</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">            # 检查的80端口</span>
<span class="token attr-name">            connect_port</span> <span class="token attr-value">80</span>
<span class="token comment" spellcheck="true">            # 超时时间 2s</span>
<span class="token attr-name">            connect_timeout</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">            # 重试次数 2次</span>
<span class="token attr-name">            nb_get_retry</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">            # 间隔时间 3s</span>
<span class="token attr-name">            delay_before_retry</span> <span class="token attr-value">3</span>
        }
    }

<span class="token attr-name">    real_server</span> <span class="token attr-value">192.168.1.172 80 {</span>
<span class="token attr-name">        weight</span> <span class="token attr-value">1</span>
<span class="token comment" spellcheck="true">        # 健康检查</span>
<span class="token attr-name">        TCP_CHECK</span> <span class="token attr-value">{</span>
<span class="token comment" spellcheck="true">            # 检查的80端口</span>
<span class="token attr-name">            connect_port</span> <span class="token attr-value">80</span>
<span class="token comment" spellcheck="true">            # 超时时间 2s</span>
<span class="token attr-name">            connect_timeout</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">            # 重试次数 2次</span>
<span class="token attr-name">            nb_get_retry</span> <span class="token attr-value">2</span>
<span class="token comment" spellcheck="true">            # 间隔时间 3s</span>
<span class="token attr-name">            delay_before_retry</span> <span class="token attr-value">3</span>
        }
    }
}</code></pre>
</li>
</ol>
<h2 id="7-分布式"><a href="#7-分布式" class="headerlink" title="7. 分布式"></a>7. 分布式</h2><h3 id="7-1-概述"><a href="#7-1-概述" class="headerlink" title="7.1 概述"></a>7.1 概述</h3><ol>
<li><p>单体架构——<font color="red">一个人做多件事</font></p>
</li>
<li><p>分布式架构—<font color="red">多个人做多件事</font></p>
</li>
<li><p>集群—<font color="red">多个人做一件事</font></p>
<blockquote>
<p>不同的业务(功能模块)分散部署在不同的服务器；每个子系统负责一个或者多个不同的业务模块；各服务之间可以交互通信，设计是对用户透明的；发展为集群分布式系统架构</p>
</blockquote>
</li>
<li><p>微服务是分布式的子集</p>
</li>
<li><p>优点</p>
<ol>
<li>业务解耦</li>
<li>系统模块化，可重用化</li>
<li>提升系统并发量</li>
<li>优化运维部署效率</li>
</ol>
</li>
<li><p>缺点</p>
<ol>
<li>架构复杂，上手难</li>
<li>部署多个子系统复杂</li>
<li>系统之间通信耗时</li>
<li>调试复杂</li>
</ol>
</li>
<li><p>设计原则</p>
<ol>
<li>异步解耦</li>
<li>幂等一致性</li>
<li>拆分原则</li>
<li>融合分布式中间件</li>
<li>容错高可用</li>
</ol>
</li>
<li><p>集群架构</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/19.%E9%9B%86%E7%BE%A4%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84.png" alt="集群高可用架构"></p>
<ul>
<li>存在问题：高访问量的时候，直接访问数据库性能低下；引入缓存来提高数据访问性能</li>
</ul>
</li>
</ol>
<h3 id="7-2-缓存中间件—Redis"><a href="#7-2-缓存中间件—Redis" class="headerlink" title="7.2 缓存中间件—Redis"></a>7.2 缓存中间件—Redis</h3><h4 id="7-2-1-概述"><a href="#7-2-1-概述" class="headerlink" title="7.2.1 概述"></a>7.2.1 概述</h4><ol>
<li><p>图示</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/codeOfMjh/picgo@main/images/MK/architect/ChapterTwo/20.%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E4%B8%AD%E9%97%B4%E4%BB%B6.png" alt="分布式缓存中间件"></p>
</li>
<li><p>NoSQL</p>
<ol>
<li>用于大数据量存储</li>
<li>水平(横向)扩展方便高效</li>
<li>高性能读写</li>
<li>高可用</li>
<li>存数据，做缓存</li>
</ol>
</li>
<li><p>NoSQL分类</p>
<ol>
<li>键值对数据库<ul>
<li><code>Memcache</code>：代码层次类似于<code>Hash</code><ul>
<li>支持简单的数据类型</li>
<li>内存使用率高</li>
<li>多核，多线程</li>
<li>不支持数据持久化存储和主从复制，以及分片</li>
</ul>
</li>
<li><code>Redis</code><ul>
<li>数据类型丰富</li>
<li>单线程，单核</li>
<li>支持数据磁盘持久化和主从复制，以及分片</li>
<li>每秒100000+QPS，QPS即每秒内查询次数</li>
</ul>
</li>
</ul>
</li>
<li>列存储数据库—Hbase，Cassandra</li>
<li>文档型数据库—MongoDB，CouchDB</li>
<li>图形数据库—Neo4J，FlockDB</li>
</ol>
</li>
<li><p>分布式缓存优势</p>
<ul>
<li>提升读写速度</li>
<li>降低数据库查询压力</li>
<li>跨服务器缓存</li>
<li>内存式缓存</li>
</ul>
</li>
<li><p>Redis</p>
<ol>
<li>非关系型，分布式，开源，可水平扩展</li>
<li>分布式缓存中间件</li>
<li>key-value存储</li>
<li>提供海量的数据存储访问</li>
<li>数据存储在内存里，读写快</li>
</ol>
</li>
</ol>
<h4 id="7-2-2-数据类型"><a href="#7-2-2-数据类型" class="headerlink" title="7.2.2 数据类型"></a>7.2.2 数据类型</h4><ol>
<li><p>String</p>
<ul>
<li>存放键值对</li>
<li>操作：get，set，del</li>
<li>设置过期时间：<code>EXPIRE age 30</code></li>
<li>累加1：<code>incr num</code>==<code>num++</code></li>
<li>累减1：<code>decr num</code>==<code>num--</code></li>
<li>获取指定范围字符串：<code>getrange key start end</code></li>
</ul>
</li>
<li><p>hash</p>
<ul>
<li>存放对象</li>
</ul>
</li>
<li><p>list</p>
<ul>
<li>一个允许存放重复数据的列表对象</li>
</ul>
</li>
<li><p>set</p>
<ul>
<li>一个不允许存放重复数据的列表对象</li>
</ul>
</li>
<li><p>zset</p>
<ul>
<li>排序set列表对象</li>
</ul>
</li>
<li><p>命令网址<code>redisdoc.com/index.html</code></p>
</li>
</ol>
<p>看到2-1</p>
<ul>
<li>为什么Redis速度快<ul>
<li>完全基于内存，没有磁盘IO操作，执行效率高</li>
<li>数据结构简单，对数据操作也简单</li>
<li>采用单线程也能处理高并发，多核也可以启动多实例</li>
<li>使用多了IO复用模型，即非阻塞式IO，采用多路复用函数</li>
</ul>
</li>
</ul>
<ol>
<li>数据类型<ul>
<li><code>String</code>：基本数据类型，二进制安全</li>
<li><code>Hash：String</code>组成的字典，适合存储对象</li>
<li><code>List</code>：列表，按照String元素插入顺序排序</li>
<li><code>Set：String</code>元素组成的无序集合，通过Hash表现，不允许重复</li>
<li><code>Sorted Set</code>：通过分数类为集合中的成员进行从小到大的排序</li>
<li><code>HyperLogLog</code>：用于支持存储地理位置信息</li>
</ul>
</li>
<li>大数据查询固定前缀的<code>key</code><ul>
<li>使用<code>scan count match key*</code></li>
</ul>
</li>
<li>分布式锁<ul>
<li>面临问题<ul>
<li>互斥性</li>
<li>安全性</li>
<li>死锁</li>
<li>容错</li>
</ul>
</li>
<li>解决<ul>
<li>使用<code>set</code>方法设置键的过期时间并给键添加一个随机字符，避免键集中过期时造成的卡顿</li>
</ul>
</li>
</ul>
</li>
<li>异步队列<ul>
<li>使用<code>List</code>做为队列，<code>RPush</code>产生消息，<code>LPop</code>消费消息<ul>
<li>缺点：没有等待队列有值就进行消费</li>
<li>解决<ol>
<li>通过应用层引入<code>Sleep</code>机制调用<code>LPop</code>重新消费</li>
<li>阻塞直到队列有消息或者超时；缺点：只能提供一个消费者消费</li>
<li>主题订阅模式；缺点：无法保证消息可达性</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>持久化方式<ul>
<li><code>RDB</code><ul>
<li>保存某个时间点的全部数据快照方式，文件小，恢复快，数据丢失风险大</li>
<li>触发<ul>
<li><code>redis.conf</code>文件配置的<code>save m n</code>定时触发</li>
<li>主从复制，主节点自动触发</li>
<li>执行<code>Debug Reload</code>时</li>
<li>执行<code>Shutdown</code>时</li>
</ul>
</li>
</ul>
</li>
<li><code>AOF</code><ul>
<li>保存到写状态，文件可读，适合保存增量数据；数据丢失风险小，但文件呢体积较大，恢复时间较长</li>
</ul>
</li>
<li>解决：混合模式—<code>RDB</code>做镜像的全量持久化，而<code>AOF</code>做增量的持久化</li>
</ul>
</li>
<li>主从同步<ul>
<li><code>Pipeline</code>：批量执行<code>Redis</code>指令，节省多次<code>IO</code>往返的时间</li>
<li>同步原理 <ul>
<li>从节点发送同步命令到主节点</li>
<li>主节点启动一个后台进程，将<code>Redis</code>中的数据快照保存到文件中</li>
<li>主节点将保存数据快照期间接收到的写命令缓存起来</li>
<li>主节点完成文件操作后，将该文件发送给从节点</li>
<li>使用新的<code>AOF</code>文件替换旧的<code>AOF</code>文件</li>
<li>主节点将这期间收集的增量命令发送给从节点</li>
</ul>
</li>
</ul>
</li>
<li>集群<ul>
<li>哨兵<ul>
<li>主从复制的基石，由哨兵们监控集群状态，主节点宕机后根据定义规则选举新的主节点，保证系统的运行</li>
</ul>
</li>
<li>流言协议：在杂乱无章中寻求一致；用于主从切换<ul>
<li>消息节点向其他节点随机发送消息，最终消息会趋于一致性</li>
</ul>
</li>
<li>原理<ul>
<li>分片：按照一定规则划分数据，分散存储在多个节点上</li>
<li>获取：一致性哈希算法，对<code>2^32</code>取模，将<code>hash</code>值空间组成虚拟环</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="7-3-分布式会话与单点登录"><a href="#7-3-分布式会话与单点登录" class="headerlink" title="7.3 分布式会话与单点登录"></a>7.3 分布式会话与单点登录</h3><h3 id="7-4-分布式搜索引擎Elasticsearch"><a href="#7-4-分布式搜索引擎Elasticsearch" class="headerlink" title="7.4 分布式搜索引擎Elasticsearch"></a>7.4 分布式搜索引擎Elasticsearch</h3><h3 id="7-5-分布式文件系统"><a href="#7-5-分布式文件系统" class="headerlink" title="7.5 分布式文件系统"></a>7.5 分布式文件系统</h3><h3 id="7-6-分布式消息队列"><a href="#7-6-分布式消息队列" class="headerlink" title="7.6 分布式消息队列"></a>7.6 分布式消息队列</h3><h3 id="7-7-分布式锁"><a href="#7-7-分布式锁" class="headerlink" title="7.7 分布式锁"></a>7.7 分布式锁</h3><h3 id="7-8-分布式事务与数据一致性"><a href="#7-8-分布式事务与数据一致性" class="headerlink" title="7.8 分布式事务与数据一致性"></a>7.8 分布式事务与数据一致性</h3><h3 id="7-9-接口幂等设计与分布式限流"><a href="#7-9-接口幂等设计与分布式限流" class="headerlink" title="7.9 接口幂等设计与分布式限流"></a>7.9 接口幂等设计与分布式限流</h3><h2 id="7-MongoDB"><a href="#7-MongoDB" class="headerlink" title="7. MongoDB"></a>7. MongoDB</h2><h2 id="8-Mybatis"><a href="#8-Mybatis" class="headerlink" title="8. Mybatis"></a>8. Mybatis</h2><h2 id="9-Spring"><a href="#9-Spring" class="headerlink" title="9. Spring"></a>9. Spring</h2><ol>
<li>IOC<ol>
<li>控制反转IOC：Spring最核心的部分，主要是用来创建对象</li>
<li>依赖注入DI：把第层类作为参数传递给上层类，实现上层对下层的”控制”<ol>
<li>是IOC的一种特殊实现</li>
<li>Setter</li>
<li>Interface</li>
<li>Constructor</li>
<li>Annotation</li>
</ol>
</li>
<li>依赖查找DL：IOC的另一种实现</li>
<li>优势<ol>
<li>避免在各处使用new来创建类，并且可以做到统一维护</li>
<li>创建实例的时候不需要了解其中的细节</li>
</ol>
</li>
<li>功能<ol>
<li>自动装配</li>
<li>支持集合</li>
<li>指定初始化方法和销毁方法</li>
<li>支持回调方法</li>
</ol>
</li>
<li>核心接口<ol>
<li>BeanDefinition：主要用来描述Bean的定义</li>
<li>BeanDefinitionRegistry：提供向IOC容器注册BeanDefinition对象的方法</li>
<li>BeanFactory：Spring最核心的接口<ol>
<li>提供IOC的配置机制</li>
<li>包含Bean的各种定义，便于实例化Bean</li>
<li>建立Bean之间的依赖关系</li>
<li>Bean生命周期的控制</li>
</ol>
</li>
<li>ApplicationContext<ol>
<li>继承BeanFactory接口，能够管理和装配Bean</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>AOP</li>
</ol>
<h2 id="10-SpringMVC"><a href="#10-SpringMVC" class="headerlink" title="10. SpringMVC"></a>10. SpringMVC</h2><h2 id="11-Dubbo-zookeeper"><a href="#11-Dubbo-zookeeper" class="headerlink" title="11. Dubbo+zookeeper"></a>11. Dubbo+zookeeper</h2><h2 id="12-SpringCloud"><a href="#12-SpringCloud" class="headerlink" title="12. SpringCloud"></a>12. SpringCloud</h2>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">mjh</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://codeOfMjh.github.com/2020/11/21/5-javainterview/">https://codeOfMjh.github.com/2020/11/21/5-javainterview/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">mjh</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Java%E5%9F%BA%E7%A1%80/">
                                    <span class="chip bg-color">Java基础</span>
                                </a>
                            
                                <a href="/tags/Java%E9%9D%A2%E8%AF%95/">
                                    <span class="chip bg-color">Java面试</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/11/21/5-leetcode/">
                    <div class="card-image">
                        
                        
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/medias/featureimages/18.jpg" class="responsive-img" alt="5.leetcode">
                        
                        <span class="card-title">5.leetcode</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            算法与数据结构1. 算法基础2. 线性表2.1 类型2.2 顺序表示实现2.3 链式表示实现3. 栈与队列3.1 类型3.2 栈的实现3.3 队列的实现3.3.1 链式表示实现3.3.2 顺序表示实现4. 串4.1 类型4.2 顺序表示实现
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-11-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E9%9D%A2%E8%AF%95/" class="post-category">
                                    面试
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/11/21/4-nginx/">
                    <div class="card-image">
                        
                        
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/medias/featureimages/8.jpg" class="responsive-img" alt="4.nginx">
                        
                        <span class="card-title">4.nginx</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-11-21
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E7%BD%91%E7%BB%9C/" class="post-category">
                                    服务器与网络
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="/about" target="_blank">mjh</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            <!-- span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span -->
            
            
            <!-- span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span -->
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:mjhcode@aliyun.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

	<!--��̬��������-->
	<!--<script type="text/javascript"
		color="122 103 238" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
	</script>-->
	
	<!-- ӣ��Ʈ�� -->
	<!--
	
	-->
	
	<!-- ѩ����Ʈ�� -->
	<!--
		<script type="text/javascript">
		//ֻ���������ҳ������Ч
		var windowWidth = $(window).width();
		if (windowWidth > 768) {
			document.write('<script type="text/javascript" src="/js/snow.js"></script>');
		}
		</script>
	-->
	<!--<script src="/js/snow.js"></script>-->
	
	<!-- ������� -->
	<!--
		<script type="text/javascript">
			//ֻ���������ҳ������Ч
			var windowWidth = $(window).width();
			if (windowWidth > 768) {
				document.write('<script type="text/javascript" src="https://apip.weatherdt.com/v2/h5.html?bg=1&md=02345&lc=accu&key=MLB1osjDcR"><\/script>');
			}
		</script>
	-->
<script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}i(),n.addEventListener("scroll",function(){var t,e;t=i,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>

</html>
